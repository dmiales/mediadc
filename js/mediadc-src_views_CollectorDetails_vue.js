"use strict";(self.webpackChunkmediadc=self.webpackChunkmediadc||[]).push([["src_views_CollectorDetails_vue"],{73352:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\n.fade-enter-active[data-v-59143620],\n.fade-leave-active[data-v-59143620] {\n\ttransition: opacity 250ms;\n}\n.fade-enter[data-v-59143620],\n.fade-leave-to[data-v-59143620] {\n\topacity: 0;\n}\n.fade-visibility-enter[data-v-59143620],\n.fade-visibility-leave-to[data-v-59143620] {\n\tvisibility: hidden;\n\topacity: 0;\n}\n.details-export-wrapper[data-v-59143620] {\n\tposition: fixed;\n\tz-index: 9998;\n\ttop: 0;\n\tleft: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n}\n.details-export[data-v-59143620] {\n\tposition: relative;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\tbox-shadow: 0 0 30px var(--color-box-shadow);\n\tpadding: 20px 20px 10px;\n\twidth: 100%;\n\tmax-width: 300px;\n\tmargin: auto;\n\tbackground-color: var(--color-main-background);\n}\n.details-export-close[data-v-59143620] {\n\tposition: absolute;\n\ttop: 10px;\n\tright: 5px;\n\tpadding: 25px;\n\tbackground: var(--icon-close-dark) no-repeat center;\n\topacity: .5;\n\tcursor: pointer;\n}\n.details-export-close[data-v-59143620]:hover {\n\topacity: 1;\n}\n.selection-container[data-v-59143620] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin: 10px auto;\n}\n@media (max-width: 540px) {\n.details-export[data-v-59143620] {\n\t\twidth: 90vw;\n\t\theight: 80vh;\n\t\toverflow-y: scroll;\n\t\ttop: calc(100% - 96vh);\n}\n}\n","",{version:3,sources:["webpack://./src/components/details/DetailsExport.vue"],names:[],mappings:";AAmFA;;CAEA,yBAAA;AACA;AAEA;;CAEA,UAAA;AACA;AAEA;;CAEA,kBAAA;CACA,UAAA;AACA;AAEA;CACA,eAAA;CACA,aAAA;CACA,MAAA;CACA,OAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,WAAA;CACA,YAAA;AAEA;AAEA;CACA,kBAAA;CACA,0CAAA;CACA,yCAAA;CACA,4CAAA;CACA,uBAAA;CACA,WAAA;CACA,gBAAA;CACA,YAAA;CACA,8CAAA;AACA;AAEA;CACA,kBAAA;CACA,SAAA;CACA,UAAA;CACA,aAAA;CACA,mDAAA;CACA,WAAA;CACA,eAAA;AACA;AAEA;CACA,UAAA;AACA;AAEA;CACA,aAAA;CACA,sBAAA;CACA,iBAAA;AACA;AAEA;AACA;EACA,WAAA;EACA,YAAA;EACA,kBAAA;EACA,sBAAA;AACA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author 2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<transition name=\"fade\">\n\t\t<div class=\"details-export-wrapper\">\n\t\t\t<div class=\"details-export\">\n\t\t\t\t<div class=\"details-export-close\" @click=\"closeExportResultsDialog()\" />\n\t\t\t\t<h2>{{ t('mediadc', 'Export task results') }}</h2>\n\t\t\t\t<div class=\"selection-container\">\n\t\t\t\t\t<label for=\"export-file-format\">{{ t('mediadc', 'Select export file format') }}</label>\n\t\t\t\t\t<select id=\"export-file-format\"\n\t\t\t\t\t\tv-model=\"exportFileFormat\">\n\t\t\t\t\t\t<option v-for=\"format in exportFormatOptions\" :key=\"format\" :value=\"format\">\n\t\t\t\t\t\t\t{{ format }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<NcButton :href=\"downloadExportUrl\">\n\t\t\t\t\t{{ t('mediadc', 'Export') }}\n\t\t\t\t</NcButton>\n\t\t\t</div>\n\t\t</div>\n\t</transition>\n</template>\n\n<script>\nimport { generateUrl } from '@nextcloud/router'\n\nimport { NcButton } from '@nextcloud/vue'\n\nexport default {\n\tname: 'DetailsExport',\n\tcomponents: {\n\t\tNcButton,\n\t},\n\tprops: {\n\t\ttask: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\texportFormatOptions: ['xml', 'json'],\n\t\t\texportFileFormat: 'xml',\n\t\t}\n\t},\n\tcomputed: {\n\t\tdownloadExportUrl() {\n\t\t\treturn generateUrl(`/apps/mediadc/api/v1/tasks/${this.task.id}/export/${this.exportFileFormat}`)\n\t\t},\n\t},\n\tmethods: {\n\t\tcloseExportResultsDialog() {\n\t\t\tthis.$emit('update:opened', false)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.fade-enter-active,\n.fade-leave-active {\n\ttransition: opacity 250ms;\n}\n\n.fade-enter,\n.fade-leave-to {\n\topacity: 0;\n}\n\n.fade-visibility-enter,\n.fade-visibility-leave-to {\n\tvisibility: hidden;\n\topacity: 0;\n}\n\n.details-export-wrapper {\n\tposition: fixed;\n\tz-index: 9998;\n\ttop: 0;\n\tleft: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n\n}\n\n.details-export {\n\tposition: relative;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\tbox-shadow: 0 0 30px var(--color-box-shadow);\n\tpadding: 20px 20px 10px;\n\twidth: 100%;\n\tmax-width: 300px;\n\tmargin: auto;\n\tbackground-color: var(--color-main-background);\n}\n\n.details-export-close {\n\tposition: absolute;\n\ttop: 10px;\n\tright: 5px;\n\tpadding: 25px;\n\tbackground: var(--icon-close-dark) no-repeat center;\n\topacity: .5;\n\tcursor: pointer;\n}\n\n.details-export-close:hover {\n\topacity: 1;\n}\n\n.selection-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin: 10px auto;\n}\n\n@media (max-width: 540px) {\n\t.details-export {\n\t\twidth: 90vw;\n\t\theight: 80vh;\n\t\toverflow-y: scroll;\n\t\ttop: calc(100% - 96vh);\n\t}\n}\n</style>\n"],sourceRoot:""}]);const o=l},5283:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\n.file.icon-loading .updating-blackout[data-v-4d8158fc] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: rgba(0, 0, 0, 0.7);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: var(--border-radius-large);\n\tz-index: 1;\n}\n.file[data-v-4d8158fc] {\n\tdisplay: flex;\n\theight: 100%;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\tborder: 1px solid var(--color-border-dark);\n\ttransition: box-shadow .3s;\n\tmargin: 10px;\n\tbackground-color: var(--color-background-dark);\n\tborder-radius: var(--border-radius-large);\n\toverflow: hidden;\n}\n.file-thumb-loaded[data-v-4d8158fc] {\n\tdisplay: flex;\n\twidth: 100%;\n\tborder-radius: var(--border-radius-large);\n}\n.file-thumb img[data-v-4d8158fc] {\n\twidth: 100%;\n\theight: auto;\n\tcursor: pointer;\n\tborder-radius: var(--border-radius-large);\n}\n.placeholder[data-v-4d8158fc] {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcursor: pointer;\n\tborder-radius: var(--border-radius-large);\n}\nbody[data-theme-dark] .placeholder[data-v-4d8158fc] {\n\tbackground-color: var(--color-loading-dark);\n}\n.file-info[data-v-4d8158fc] {\n\twidth: 100%;\n\tpadding: 5px 10px;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tbackground-color: var(--color-background-dark);\n\ttext-align: center;\n\tcolor: var(--color-main-text);\n}\n.filename[data-v-4d8158fc] {\n\twidth: 100%;\n\toverflow-x: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n.filepath[data-v-4d8158fc] {\n\twidth: 100%;\n\tline-break: anywhere;\n\tborder-bottom: 1px solid var(--color-border-dark);\n\tpadding-bottom: 5px;\n\tmargin-bottom: 5px;\n}\n","",{version:3,sources:["webpack://./src/components/details/DetailsFile.vue"],names:[],mappings:";AA8SA;CACA,kBAAA;CACA,MAAA;CACA,OAAA;CACA,QAAA;CACA,SAAA;CACA,8BAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,yCAAA;CACA,UAAA;AACA;AAEA;CACA,aAAA;CACA,YAAA;CACA,sBAAA;CACA,8BAAA;CACA,0CAAA;CACA,0BAAA;CACA,YAAA;CACA,8CAAA;CACA,yCAAA;CACA,gBAAA;AACA;AAEA;CACA,aAAA;CACA,WAAA;CACA,yCAAA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,yCAAA;AACA;AAEA;CACA,WAAA;CACA,YAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,eAAA;CACA,yCAAA;AACA;AAEA;CACA,2CAAA;AACA;AAEA;CACA,WAAA;CACA,iBAAA;CACA,aAAA;CACA,sBAAA;CACA,mBAAA;CACA,8CAAA;CACA,kBAAA;CACA,6BAAA;AACA;AAEA;CACA,WAAA;CACA,kBAAA;CACA,uBAAA;CACA,mBAAA;AACA;AAEA;CACA,WAAA;CACA,oBAAA;CACA,iDAAA;CACA,mBAAA;CACA,kBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021-2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class=\"file\" :class=\"{'icon-loading': updating}\" :style=\"'width: ' + detailsGridSize + 'px;'\">\n\t\t<div v-if=\"updating\" class=\"updating-blackout\" />\n\t\t<div class=\"file-thumb\" @click=\"openFile(file)\">\n\t\t\t<div v-show=\"loaded\"\n\t\t\t\tv-if=\"file.filempart === 'image' || (file.filempart === 'video' && file.has_preview)\"\n\t\t\t\tclass=\"file-thumb-loaded\">\n\t\t\t\t<img v-show=\"loaded\"\n\t\t\t\t\t:key=\"file.filepath\"\n\t\t\t\t\t:src=\"imageUrl\"\n\t\t\t\t\t:alt=\"file.filename\"\n\t\t\t\t\t:title=\"file.filepath\"\n\t\t\t\t\t@load=\"onLoad\">\n\t\t\t</div>\n\t\t\t<div v-show=\"!loaded && file.filempart === 'video'\"\n\t\t\t\tclass=\"placeholder\"\n\t\t\t\t:style=\"'min-height: ' + detailsGridSize + 'px'\"\n\t\t\t\t:title=\"file.filepath\">\n\t\t\t\t<svg width=\"50%\"\n\t\t\t\t\theight=\"50%\"\n\t\t\t\t\tversion=\"1.1\"\n\t\t\t\t\tviewBox=\"-31 0 512 512\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t<path d=\"m440.59 206.68h-341.17l327.7-94.93c2.5469-0.73828 4.6953-2.4609 5.9766-4.7812 1.2812-2.3242 1.5859-5.0586 0.84766-7.6055l-17.148-59.199c-6.8516-23.645-28.867-40.16-53.539-40.16-5.1992 0-10.379 0.73828-15.402 2.1914l-307.68 89.129c-14.23 4.1211-26.023 13.582-33.215 26.633-7.1875 13.051-8.875 28.078-4.7539 42.305l16.754 57.836v238.25c0 30.688 24.965 55.652 55.648 55.652h120.16c5.5234 0 10-4.4766 10-10s-4.4766-10-10-10h-120.16c-19.66 0-35.652-15.992-35.652-35.652v-136.09h391.63v136.09c2.1e-4 19.66-15.992 35.652-35.652 35.652h-120.16c-5.5195 0-10 4.4766-10 10s4.4805 10 10 10h120.16c30.688 0 55.652-24.965 55.652-55.652v-239.67c0-5.5234-4.4766-10-10-10zm-176.33 93.586 42.488-73.586h55.262l-42.484 73.586zm-78.359 0 42.488-73.586h55.262l-42.484 73.586zm-78.355 0 42.484-73.586h55.266l-42.488 73.586zm37.18-129.46-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543l71.148 68.336-53.309 15.441c-0.375-0.54688-0.81641-1.0664-1.3125-1.543zm134-125.84 71.148 68.336-53.309 15.441c-0.375-0.54688-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543zm-75.266 21.805 71.148 68.332-53.309 15.445c-0.375-0.54687-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.37891 0.54297 0.81641 1.0625 1.3125 1.543zm149.96-45.367c3.2109-0.92969 6.5195-1.4023 9.8359-1.4023 15.824 0 29.938 10.578 34.328 25.727l14.367 49.59-40.121 11.621c-0.3789-0.54688-0.8164-1.0625-1.3164-1.543l-71.145-68.332zm-328.94 106.2c4.6094-8.3711 12.16-14.434 21.262-17.07l5.875-1.7031c0.37891 0.54688 0.81641 1.0664 1.3125 1.543l71.148 68.336-88.293 25.578-14.367-49.59c-2.6367-9.0976-1.5469-18.719 3.0625-27.094zm14.48 99.074h87.973l-42.484 73.586h-45.488zm303.66 73.586 42.484-73.586h45.488v73.586z\" />\n\t\t\t\t\t<path d=\"m303.92 405.11c0-3.5742-1.9062-6.875-5-8.6602l-87.855-50.723c-3.0938-1.7852-6.9062-1.7852-10 0-3.0938 1.7852-5 5.0859-5 8.6602v101.45c0 3.5703 1.9062 6.8711 5 8.6562 1.5469 0.89453 3.2734 1.3438 5 1.3438 1.7266 0 3.4531-0.44922 5-1.3438l87.855-50.719c3.0938-1.7852 5-5.0859 5-8.6602zm-87.855 33.402v-66.805l57.855 33.402z\" />\n\t\t\t\t\t<path d=\"m234.77 492c-5.5078 0-10 4.4922-10 10s4.4922 10 10 10c5.5117 0 10-4.4922 10-10s-4.4883-10-10-10z\" />\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t\t<div v-show=\"!loaded && file.filempart === 'image'\"\n\t\t\t\tclass=\"placeholder\"\n\t\t\t\t:style=\"'min-height: ' + detailsGridSize + 'px'\"\n\t\t\t\t:title=\"file.filepath\">\n\t\t\t\t<svg width=\"50%\"\n\t\t\t\t\tenable-background=\"new 0 0 512 512\"\n\t\t\t\t\tversion=\"1.1\"\n\t\t\t\t\tviewBox=\"0 0 512 512\"\n\t\t\t\t\txml:space=\"preserve\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t<path d=\"m446.58 0h-381.15c-36.076 0-65.425 29.35-65.425 65.426v381.15c0 36.075 29.349 65.425 65.425 65.425h381.15c36.076 0 65.425-29.35 65.425-65.426v-381.15c0-36.076-29.349-65.426-65.425-65.426zm35.267 446.58c0 19.447-15.821 35.267-35.267 35.267h-381.15c-19.447 0-35.268-15.821-35.268-35.267v-55.007l99.255-84.451c3.622-3.082 8.906-3.111 12.562-0.075l62.174 51.628c5.995 4.977 14.795 4.569 20.304-0.946l147.73-147.95c2.67-2.675 5.783-2.935 7.408-2.852 1.62 0.083 4.695 0.661 7.078 3.596l95.176 117.19v118.87zm0-166.71-71.766-88.366c-7.117-8.764-17.666-14.122-28.942-14.701-11.268-0.57-22.317 3.672-30.294 11.662l-138.01 138.22-51.59-42.839c-14.959-12.422-36.563-12.293-51.373 0.308l-79.712 67.822v-286.55c0-19.447 15.821-35.268 35.268-35.268h381.15c19.447 0 35.267 15.821 35.267 35.268v214.44z\" />\n\t\t\t\t\t<path d=\"m161.17 62.995c-40.095 0-72.713 32.62-72.713 72.713 0 40.094 32.619 72.713 72.713 72.713s72.713-32.619 72.713-72.713-32.618-72.713-72.713-72.713zm0 115.27c-23.466 0-42.556-19.091-42.556-42.556 0-23.466 19.09-42.556 42.556-42.556s42.556 19.091 42.556 42.556-19.09 42.556-42.556 42.556z\" />\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"file-info\">\n\t\t\t<span :class=\"{ filename: !showFullFilePath, filepath: showFullFilePath }\" :title=\"file.filepath\">{{ !showFullFilePath ? file.filename : file.filepath }}</span>\n\t\t\t<span class=\"owner\">{{ file.fileowner }}</span>\n\t\t\t<span class=\"size\" :title=\"file.filesize + ' B'\">{{ formatBytes(Number(file.filesize)) }}</span>\n\t\t\t<div class=\"actions\" style=\"display: flex;\">\n\t\t\t\t<NcCheckboxRadioSwitch v-tooltip=\"{ content: t('mediadc', 'Select file'), placement: 'top' }\"\n\t\t\t\t\tclass=\"mediadc-checkbox-only\"\n\t\t\t\t\t:checked.sync=\"checked\" />\n\t\t\t\t<NcButton v-tooltip=\"{ content: t('mediadc', 'Delete file'), placement: 'top' }\"\n\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t:aria-label=\"t('mediadc', 'Delete file')\"\n\t\t\t\t\t@click=\"deleteGroupFile(file)\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<span class=\"icon-delete\" />\n\t\t\t\t\t</template>\n\t\t\t\t</NcButton>\n\t\t\t\t<NcButton v-tooltip=\"{ content: t('mediadc', 'Remove file (mark resolved)'), placement: 'top' }\"\n\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t:aria-label=\"t('mediadc', 'Remove file (mark resolved)')\"\n\t\t\t\t\t@click=\"removeGroupFile(file)\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<span class=\"icon-close\" />\n\t\t\t\t\t</template>\n\t\t\t\t</NcButton>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { emit, subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport { showError, showMessage, showWarning } from '@nextcloud/dialogs'\nimport { generateRemoteUrl, generateUrl } from '@nextcloud/router'\n\nimport { NcButton, NcCheckboxRadioSwitch } from '@nextcloud/vue'\n\nimport { mapGetters } from 'vuex'\n\nimport Formats from '../../mixins/Formats.js'\n\nexport default {\n\tname: 'DetailsFile',\n\tcomponents: {\n\t\tNcButton,\n\t\tNcCheckboxRadioSwitch,\n\t},\n\tmixins: [Formats],\n\tprops: {\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tallFiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcheckedFiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tdetail: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tloaded: false,\n\t\t\tchecked: false,\n\t\t\tupdating: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'detailsGridSize',\n\t\t\t'deleteFileConfirmation',\n\t\t\t'showFullFilePath',\n\t\t\t'details',\n\t\t]),\n\t\timageUrl() {\n\t\t\tif (this.file.has_preview) {\n\t\t\t\treturn generateUrl(`/core/preview?fileId=${this.file.fileid}&x=${this.detailsGridSize}&y=${this.detailsGridSize}$forceIcon=0`)\n\t\t\t} else {\n\t\t\t\treturn generateRemoteUrl(`dav/files${this.file.filepath.replace('files/', '')}`)\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tchecked() {\n\t\t\tconst newCheckedFiles = this.checkedFiles\n\t\t\tconst fileIndex = newCheckedFiles.findIndex(f => f.fileid === this.file.fileid)\n\t\t\tif (this.checked) {\n\t\t\t\tif (fileIndex === -1) {\n\t\t\t\t\tnewCheckedFiles.push(this.file)\n\t\t\t\t}\n\t\t\t} else if (fileIndex !== -1) {\n\t\t\t\tnewCheckedFiles.splice(fileIndex, 1)\n\t\t\t}\n\t\t\tthis.$emit('update:checkedFiles', newCheckedFiles)\n\t\t},\n\t\tcheckedFiles() {\n\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === this.file.fileid)\n\t\t\tif (!this.checked && fileIndex !== -1) {\n\t\t\t\tthis.checked = true\n\t\t\t}\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tconst fileIndexChecked = this.checkedFiles.findIndex(f => f.fileid === this.file.fileid)\n\t\tthis.checked = fileIndexChecked !== -1\n\t\tsubscribe('deselectFiles', this.deselect)\n\t},\n\tbeforeDestroy() {\n\t\tunsubscribe('deselectFiles', this.deselect)\n\t},\n\tmethods: {\n\t\topenFile(file) {\n\t\t\tconst filesList = this.files.map(file => ({\n\t\t\t\tbasename: file.filename,\n\t\t\t\tfileid: file.fileid,\n\t\t\t\tfilename: file.filepath.replace(`/${getCurrentUser().uid}/files`, '').replace('files/', '/'),\n\t\t\t\tgetcontentlength: file.filesize,\n\t\t\t\tgetcontenttype: file.filemtype,\n\t\t\t\tmime: file.filemtype,\n\t\t\t\tsize: file.filesize,\n\t\t\t}))\n\t\t\tOCA.Viewer.open({\n\t\t\t\tpath: file.filepath.replace(`/${getCurrentUser().uid}/files`, '').replace('files/', '/'),\n\t\t\t\tlist: filesList.map(file => ({\n\t\t\t\t\t...file,\n\t\t\t\t\tlist: filesList,\n\t\t\t\t})),\n\t\t\t})\n\t\t},\n\t\tonLoad() {\n\t\t\tthis.loaded = true\n\t\t},\n\t\tdeleteGroupFile(file) {\n\t\t\tif (this.deleteFileConfirmation) {\n\t\t\t\tconst self = this\n\t\t\t\tOC.dialogs.confirm(this.t('mediadc', 'Are you sure you want to delete this file?'),\n\t\t\t\t\tthis.t('mediadc', 'Confirm file deletion'), function(success) {\n\t\t\t\t\t\tif (success) {\n\t\t\t\t\t\t\tself._deleteGroupFile(file)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._deleteGroupFile(file)\n\t\t\t}\n\t\t},\n\t\t_deleteGroupFile(file) {\n\t\t\tthis.updating = true\n\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.group_id}/${file.fileid}`))\n\t\t\t\t.then(res => {\n\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\tconst files = this.files\n\t\t\t\t\t\tif (this.allFiles.length === 2) { // Remove detail when 1 file left\n\t\t\t\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t\t\t\tthis.$store.commit('deleteDetail', this.detail)\n\t\t\t\t\t\t\tshowMessage(this.t('mediadc', 'Group successfully removed (1 file left)'))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst fileidIndex = files.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\t\tfiles.splice(fileidIndex, 1)\n\t\t\t\t\t\tconst checkedIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\t\tif (this.checked && checkedIndex !== -1) {\n\t\t\t\t\t\t\tconst newCheckedFiles = this.checkedFiles\n\t\t\t\t\t\t\tnewCheckedFiles.splice(checkedIndex, 1)\n\t\t\t\t\t\t\tthis.$emit('update:checkedFiles', newCheckedFiles)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.$emit('update:files', files)\n\t\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\t\tthis.$store.commit('setTask', res.data.task)\n\t\t\t\t\t\temit('updateGroupFilesPagination', this.file)\n\t\t\t\t\t} else if ('locked' in res.data && res.data.locked) {\n\t\t\t\t\t\tshowWarning(this.t('mediadc', 'Wait until file has been loaded before deleting it'))\n\t\t\t\t\t} else if ('not_permitted' in res.data && res.data.not_permited) {\n\t\t\t\t\t\tshowError(this.t('mediadc', 'Not enough permissions to delete the file'))\n\t\t\t\t\t} else if ('not_found' in res.data && res.data.not_found) {\n\t\t\t\t\t\tshowError(this.t('mediadc', 'File not found. Probably it\\'s has been already deleted'))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowError(this.t('mediadc', 'An error occurred while deleting the file'))\n\t\t\t\t\t}\n\t\t\t\t\tthis.updating = false\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tconsole.debug(err)\n\t\t\t\t\tshowError(this.t('mediadc', 'An error occurred while deleting the file'))\n\t\t\t\t\tthis.updating = false\n\t\t\t\t})\n\t\t},\n\t\tremoveGroupFile(file) {\n\t\t\tthis.updating = true\n\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.group_id}/remove`), { fileIds: [file.fileid] }).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\tconst files = this.files\n\t\t\t\t\tif (this.allFiles.length === 2) { // Remove detail when 1 file left\n\t\t\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t\t\tthis.$store.commit('deleteDetail', this.detail)\n\t\t\t\t\t\tshowMessage(this.t('mediadc', 'Group successfully removed (1 file left)'))\n\t\t\t\t\t}\n\t\t\t\t\tconst fileidIndex = files.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\tfiles.splice(fileidIndex, 1)\n\t\t\t\t\tconst checkedIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\tif (this.checked && checkedIndex !== -1) {\n\t\t\t\t\t\tconst newCheckedFiles = this.checkedFiles\n\t\t\t\t\t\tnewCheckedFiles.splice(checkedIndex, 1)\n\t\t\t\t\t\tthis.$emit('update:checkedFiles', newCheckedFiles)\n\t\t\t\t\t}\n\t\t\t\t\tthis.$emit('update:files', files)\n\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\temit('updateGroupFilesPagination', this.file)\n\t\t\t\t\tthis.updating = false\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.debug(err)\n\t\t\t\tshowError(this.t('mediadc', 'A server error occurred'))\n\t\t\t\tthis.updating = false\n\t\t\t})\n\t\t},\n\t\tdeselect(filesToDeselect) {\n\t\t\tif (this.checked && filesToDeselect.map(f => f.fileid).includes(this.file.fileid)) {\n\t\t\t\tthis.checked = false\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.file.icon-loading .updating-blackout {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: rgba(0, 0, 0, 0.7);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: var(--border-radius-large);\n\tz-index: 1;\n}\n\n.file {\n\tdisplay: flex;\n\theight: 100%;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\tborder: 1px solid var(--color-border-dark);\n\ttransition: box-shadow .3s;\n\tmargin: 10px;\n\tbackground-color: var(--color-background-dark);\n\tborder-radius: var(--border-radius-large);\n\toverflow: hidden;\n}\n\n.file-thumb-loaded {\n\tdisplay: flex;\n\twidth: 100%;\n\tborder-radius: var(--border-radius-large);\n}\n\n.file-thumb img {\n\twidth: 100%;\n\theight: auto;\n\tcursor: pointer;\n\tborder-radius: var(--border-radius-large);\n}\n\n.placeholder {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcursor: pointer;\n\tborder-radius: var(--border-radius-large);\n}\n\nbody[data-theme-dark] .placeholder {\n\tbackground-color: var(--color-loading-dark);\n}\n\n.file-info {\n\twidth: 100%;\n\tpadding: 5px 10px;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tbackground-color: var(--color-background-dark);\n\ttext-align: center;\n\tcolor: var(--color-main-text);\n}\n\n.filename {\n\twidth: 100%;\n\toverflow-x: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n.filepath {\n\twidth: 100%;\n\tline-break: anywhere;\n\tborder-bottom: 1px solid var(--color-border-dark);\n\tpadding-bottom: 5px;\n\tmargin-bottom: 5px;\n}\n</style>\n"],sourceRoot:""}]);const o=l},45326:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\n.details-group[data-v-3ed04696] {\n\twidth: 100%;\n\tborder-top: 1px solid var(--color-border-dark);\n\tborder-bottom: 1px solid var(--color-border-dark);\n\tmargin: 10px 0;\n}\n.details-group-files[data-v-3ed04696] {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: center;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n}\n@media (max-width: 540px) {\n.file[data-v-3ed04696] {\n\t\tmax-width: 192px;\n}\n.filters[data-v-3ed04696] {\n\t\tflex-direction: column;\n}\n}\n.file[data-v-3ed04696]:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .25);\n}\n.filters[data-v-3ed04696] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 10px;\n\tmargin: 10px 0;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n}\n.search[data-v-3ed04696] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.sorting[data-v-3ed04696] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.batch-editing[data-v-3ed04696] {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.batch-actions-menu-button[data-v-3ed04696] {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n","",{version:3,sources:["webpack://./src/components/details/DetailsGroupList.vue"],names:[],mappings:";AA4UA;CACA,WAAA;CACA,8CAAA;CACA,iDAAA;CACA,cAAA;AACA;AAEA;CACA,aAAA;CACA,eAAA;CACA,uBAAA;CACA,iBAAA;CACA,kBAAA;AACA;AAEA;AACA;EACA,gBAAA;AACA;AAEA;EACA,sBAAA;AACA;AACA;AAEA;CACA,yCAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,iBAAA;CACA,cAAA;CACA,0CAAA;CACA,yCAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;AACA;AAEA;CACA,kBAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;AACA;AAEA;CACA,aAAA;CACA,kBAAA;CACA,eAAA;CACA,iBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021-2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div v-if=\"!loadingFiles\" class=\"details-group\">\n\t\t<div class=\"filters\">\n\t\t\t<div class=\"sorting\">\n\t\t\t\t{{ t('mediadc', 'Files size sorting') }}\n\t\t\t\t<NcButton type=\"tertiary\"\n\t\t\t\t\t:aria-label=\"t('mediadc', 'Toggle files size sorting')\"\n\t\t\t\t\tstyle=\"margin: 0 10px;\"\n\t\t\t\t\t@click=\"updateFileSorting\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<span :class=\"filesAscending ? 'icon-triangle-s sorting-group-files-btn' : 'icon-triangle-n sorting-group-files-btn'\" />\n\t\t\t\t\t</template>\n\t\t\t\t</NcButton>\n\t\t\t</div>\n\t\t\t<div class=\"search\">\n\t\t\t\t<label for=\"filename-filter\">\n\t\t\t\t\t{{ t('mediadc', 'Filter by filename: ') }}\n\t\t\t\t\t<input id=\"filename-filter\"\n\t\t\t\t\t\tv-model=\"filterFileName\"\n\t\t\t\t\t\ttype=\"search\"\n\t\t\t\t\t\tname=\"filename-filter\"\n\t\t\t\t\t\t:placeholder=\"t('mediadc', 'Filename or part')\"\n\t\t\t\t\t\t@input=\"filterByFileName\">\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div v-if=\"checkedFiles.length > 0\" class=\"batch-editing\">\n\t\t\t\t{{ n('mediadc', 'Batch actions for %n file', 'Batch actions for %n files', checkedFiles.length) }}\n\t\t\t\t<NcActions placement=\"left\" style=\"margin-left: 5px;\">\n\t\t\t\t\t<NcActionButton v-tooltip=\"{content: t('mediadc', 'Select all files in a group'), placement: 'left'}\"\n\t\t\t\t\t\ticon=\"icon-checkmark\"\n\t\t\t\t\t\t@click=\"selectAllFiles\">\n\t\t\t\t\t\t{{ checkedFiles.length === allFiles.length ? t('mediadc', 'Deselect all') : t('mediadc', 'Select all') }}\n\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t<NcActionButton v-if=\"detail.files.length > groupItemsPerPage\"\n\t\t\t\t\t\ticon=\"icon-checkmark\"\n\t\t\t\t\t\t@click=\"selectAllFilesOnPage\">\n\t\t\t\t\t\t{{ checkedFilesIntersect.length === files.length ? t('mediadc', 'Deselect all on page') : t('mediadc', 'Select all on page') }}\n\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t<NcActionButton v-tooltip=\"{content: t('mediadc', 'Mark as resolved without deleting'), placement: 'left'}\"\n\t\t\t\t\t\ticon=\"icon-close\"\n\t\t\t\t\t\t@click=\"removeCheckedFiles\">\n\t\t\t\t\t\t{{ n('mediadc', 'Remove file', 'Remove files', checkedFiles.length) }}\n\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t<NcActionButton v-tooltip=\"{content: n('mediadc', 'Delete selected file', 'Delete selected files', checkedFiles.length), placement: 'left'}\"\n\t\t\t\t\t\ticon=\"icon-delete\"\n\t\t\t\t\t\t@click=\"deleteCheckedFiles\">\n\t\t\t\t\t\t{{ n('mediadc', 'Delete file', 'Delete files', checkedFiles.length) }}\n\t\t\t\t\t</NcActionButton>\n\t\t\t\t</NcActions>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"!filesFiltered\" class=\"details-group-files\">\n\t\t\t<DetailsFile v-for=\"file in files\"\n\t\t\t\t:key=\"file.fileid\"\n\t\t\t\t:file=\"file\"\n\t\t\t\t:files=\"files\"\n\t\t\t\t:all-files=\"allFiles\"\n\t\t\t\t:checked-files.sync=\"checkedFiles\"\n\t\t\t\t:detail=\"detail\" />\n\t\t</div>\n\t\t<div v-else-if=\"filteredFiles.length > 0\" class=\"details-group-files\">\n\t\t\t<DetailsFile v-for=\"file in filteredFiles\"\n\t\t\t\t:key=\"file.fileid\"\n\t\t\t\t:file=\"file\"\n\t\t\t\t:files=\"files\"\n\t\t\t\t:all-files=\"allFiles\"\n\t\t\t\t:checked-files.sync=\"checkedFiles\"\n\t\t\t\t:detail=\"detail\" />\n\t\t</div>\n\t\t<div v-else class=\"details-group-files\">\n\t\t\t<p style=\"margin: 0 0 10px;\">\n\t\t\t\t{{ t('mediadc', 'No matches on this page') }}\n\t\t\t</p>\n\t\t</div>\n\t</div>\n\t<div v-else>\n\t\t<span class=\"icon-loading\" style=\"width: 20px; height: 20px; display: flex; margin: 20px auto;\" />\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { mapGetters } from 'vuex'\nimport { showError, showMessage, showSuccess, showWarning } from '@nextcloud/dialogs'\nimport { generateUrl } from '@nextcloud/router'\nimport { emit } from '@nextcloud/event-bus'\n\nimport { NcActions, NcActionButton, NcButton } from '@nextcloud/vue'\n\nimport Formats from '../../mixins/Formats.js'\nimport DetailsFile from './DetailsFile.vue'\n\nexport default {\n\tname: 'DetailsGroupList',\n\tcomponents: {\n\t\tDetailsFile,\n\t\tNcActions,\n\t\tNcActionButton,\n\t\tNcButton,\n\t},\n\tmixins: [Formats],\n\tprops: {\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tallFiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tdetail: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tloadingFiles: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tupdating: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tfilesAscending: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tcheckedFiles: [],\n\t\t\tbatchActionsOpened: false,\n\t\t\tfilesFiltered: false,\n\t\t\tfilterFileName: '',\n\t\t\tfilteredFiles: [],\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'detailsGridSize',\n\t\t\t'groupItemsPerPage',\n\t\t\t'details',\n\t\t]),\n\t\tcheckedFilesIntersect() {\n\t\t\tconst a = new Set(this.files)\n\t\t\tconst b = new Set(this.checkedFiles)\n\t\t\tconst intersect = new Set([...a].filter(i => b.has(i)))\n\t\t\treturn Array.from(intersect)\n\t\t},\n\t},\n\twatch: {\n\t\tfiles() {\n\t\t\tthis.filterByFileName()\n\t\t},\n\t},\n\tmethods: {\n\t\topenBatchActionsPopup() {\n\t\t\tdocument.addEventListener('click', this.toggleBatchActionsPopup)\n\t\t},\n\t\ttoggleBatchActionsPopup() {\n\t\t\tif (this.batchActionsOpened) {\n\t\t\t\tdocument.removeEventListener('click', this.toggleBatchActionsPopup)\n\t\t\t}\n\t\t\tthis.batchActionsOpened = !this.batchActionsOpened\n\t\t},\n\t\tselectAllFiles() {\n\t\t\tif (this.checkedFiles.length === this.allFiles.length) { // Deselect files\n\t\t\t\temit('deselectFiles', this.checkedFiles)\n\t\t\t\tfor (const file of this.allFiles) {\n\t\t\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\tif (fileIndex !== -1) {\n\t\t\t\t\t\tthis.checkedFiles.splice(fileIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const file of this.allFiles) {\n\t\t\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\tif (fileIndex === -1) {\n\t\t\t\t\t\tthis.checkedFiles.push(file)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tselectAllFilesOnPage() {\n\t\t\tif (this.files.length === this.checkedFilesIntersect.length) {\n\t\t\t\tconst filesToDeselect = this.checkedFilesIntersect\n\t\t\t\temit('deselectFiles', filesToDeselect)\n\t\t\t\tfor (const fileid of filesToDeselect.map(f => f.fileid)) {\n\t\t\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\t\tif (fileIndex !== -1) {\n\t\t\t\t\t\tthis.checkedFiles.splice(fileIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const file of this.files) {\n\t\t\t\t\tconst fileIndex = this.checkedFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\t\tif (fileIndex === -1) {\n\t\t\t\t\t\tthis.checkedFiles.push(file)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tremoveCheckedFiles() {\n\t\t\tthis.$emit('update:updating', true)\n\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.group_id}/remove`), { fileIds: this.checkedFiles.map(f => f.fileid) }).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\tconst allFiles = this.allFiles\n\t\t\t\t\tif ((this.allFiles.length - this.checkedFiles.length) <= 1) {\n\t\t\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t\t\t// Remove detail\n\t\t\t\t\t\tthis.$store.commit('deleteDetail', this.detail)\n\t\t\t\t\t\tif ((this.allFiles.length - this.checkedFiles.length) === 1) {\n\t\t\t\t\t\t\tshowMessage(this.t('mediadc', 'Group successfully removed (1 file left)'))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const fileid of res.data.removedFileIds) {\n\t\t\t\t\t\tconst fileidIndex = allFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\t\t\tallFiles.splice(fileidIndex, 1)\n\t\t\t\t\t\tconst checkedFileIdIndex = this.checkedFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\t\t\tif (checkedFileIdIndex !== -1) {\n\t\t\t\t\t\t\tthis.checkedFiles.splice(checkedFileIdIndex, 1)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\tthis.$emit('update:allFiles', allFiles)\n\t\t\t\t\temit('updateGroupFilesPagination')\n\t\t\t\t\tthis.$emit('update:updating', false)\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Checked files successfully removed'))\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.debug(err)\n\t\t\t\tshowError(this.t('mediadc', 'A server error occurred'))\n\t\t\t\tthis.$emit('update:updating', false)\n\t\t\t})\n\t\t},\n\t\tdeleteCheckedFiles() {\n\t\t\tif (this.allFiles.length === this.checkedFiles.length) {\n\t\t\t\tif (confirm(this.t('mediadc', 'Are you sure you want to delete all files'))) {\n\t\t\t\t\tthis._deleteCheckedFiles()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._deleteCheckedFiles()\n\t\t\t}\n\t\t},\n\t\t_deleteCheckedFiles() {\n\t\t\tthis.$emit('update:updating', true)\n\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.group_id}/delete`), { fileIds: this.checkedFiles.map(f => f.fileid) }).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\tthis._updateDeletedFiles(res)\n\t\t\t\t\tthis.$store.commit('setTask', res.data.task)\n\t\t\t\t} else if (!res.data.success && res.data.deletedFileIds.length > 0) {\n\t\t\t\t\tshowWarning(this.t('mediadc', 'Not all files deleted'))\n\t\t\t\t\tthis._updateDeletedFiles(res)\n\t\t\t\t} else {\n\t\t\t\t\tconsole.debug(res.data.errors)\n\t\t\t\t\tshowError(this.t('mediadc', 'A server error occurred. Files not deleted'))\n\t\t\t\t\tthis.$emit('update:updating', false)\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.debug(err)\n\t\t\t\tshowError(this.t('mediadc', 'A server error occurred'))\n\t\t\t\tthis.$emit('update:updating', false)\n\t\t\t})\n\t\t},\n\t\t_updateDeletedFiles(res) {\n\t\t\tconst allFiles = this.allFiles\n\t\t\tif ((this.allFiles.length - this.checkedFiles.length) <= 1 && res.data.deletedFileIds.length === this.checkedFiles.length) {\n\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t// Remove detail\n\t\t\t\tthis.$store.commit('deleteDetail', this.detail)\n\t\t\t\tif ((this.allFiles.length - this.checkedFiles.length) === 1) {\n\t\t\t\t\tshowMessage(this.t('mediadc', 'Group successfully removed (1 file left)'))\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const fileid of res.data.deletedFileIds) {\n\t\t\t\tconst fileidIndex = allFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\tallFiles.splice(fileidIndex, 1)\n\t\t\t\tconst checkedFileIdIndex = this.checkedFiles.findIndex(f => f.fileid === fileid)\n\t\t\t\tif (checkedFileIdIndex !== -1) {\n\t\t\t\t\tthis.checkedFiles.splice(checkedFileIdIndex, 1)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\temit('updateTaskInfo')\n\t\t\tthis.$emit('update:allFiles', allFiles)\n\t\t\temit('updateGroupFilesPagination')\n\t\t\tthis.$emit('update:updating', false)\n\t\t\tshowSuccess(this.t('mediadc', 'Checked files successfully deleted'))\n\t\t},\n\t\tfilterByFileName() {\n\t\t\tif (this.filterFileName !== '') {\n\t\t\t\tthis.filesFiltered = true\n\t\t\t\tthis.filteredFiles = this.files.filter(f => f.filename.toLowerCase().includes(this.filterFileName.toLowerCase()))\n\t\t\t} else {\n\t\t\t\tthis.filesFiltered = false\n\t\t\t\tthis.filteredFiles = []\n\t\t\t}\n\t\t},\n\t\tupdateFileSorting() {\n\t\t\tthis.$emit('update:filesAscending', !this.filesAscending)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.details-group {\n\twidth: 100%;\n\tborder-top: 1px solid var(--color-border-dark);\n\tborder-bottom: 1px solid var(--color-border-dark);\n\tmargin: 10px 0;\n}\n\n.details-group-files {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: center;\n\tmax-height: 100vh;\n\toverflow-y: scroll;\n}\n\n@media (max-width: 540px) {\n\t.file {\n\t\tmax-width: 192px;\n\t}\n\n\t.filters {\n\t\tflex-direction: column;\n\t}\n}\n\n.file:hover {\n\tbox-shadow: 0 0 10px 0 rgba(0, 0, 0, .25);\n}\n\n.filters {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 10px;\n\tmargin: 10px 0;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n}\n\n.search {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.sorting {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.batch-editing {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n\n.batch-actions-menu-button {\n\tpadding: 20px;\n\tborder-radius: 50%;\n\tcursor: pointer;\n\tuser-select: none;\n}\n</style>\n"],sourceRoot:""}]);const o=l},11003:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\n.task-details[data-v-14ad58d6] {\n\twidth: 100%;\n\tpadding: 20px 10px 20px 20px;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\toverflow-y: scroll;\n\tmargin: 0 auto 20px;\n}\n.task-details-heading[data-v-14ad58d6] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n.task-details-heading h3[data-v-14ad58d6] {\n\tmargin: 0;\n}\n@media (max-width: 540px) {\n.task-details[data-v-14ad58d6] {\n\t\tpadding: 15px 0px 10px 10px;\n}\n.task-details-heading[data-v-14ad58d6] {\n\t\tflex-direction: column;\n\t\ttext-align: center;\n}\n.pagination-wrapper[data-v-14ad58d6] {\n\t\tflex-direction: column;\n}\n}\n.pagination-wrapper[data-v-14ad58d6], .pagination-sorting[data-v-14ad58d6], .pagination[data-v-14ad58d6] {\n\tdisplay: flex;\n\talign-items: center;\n}\n.pagination-button[data-v-14ad58d6] {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n.task-details-row[data-v-14ad58d6] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\tmargin-bottom: 5px;\n\ttransition: height .3s;\n}\n.filters[data-v-14ad58d6] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 10px;\n\tmargin: 10px 0;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n}\ninput#group-id-filter[data-v-14ad58d6] {\n\twidth: fit-content;\n\tborder-color: var(--color-border-dark);\n}\nbody[data-theme-dark] .task-details-row[data-v-14ad58d6], body[data-theme-dark] .filters[data-v-14ad58d6] {\n\tborder-color: var(--color-border-dark);\n}\n@media (max-width: 540px) {\n.filters[data-v-14ad58d6] {\n\t\tflex-direction: column;\n}\n}\n.batch-editing[data-v-14ad58d6] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n","",{version:3,sources:["webpack://./src/components/details/DetailsList.vue"],names:[],mappings:";AA4dA;CACA,WAAA;CACA,4BAAA;CACA,0CAAA;CACA,yCAAA;CACA,kBAAA;CACA,mBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;AACA;AAEA;CACA,SAAA;AACA;AAEA;AACA;EACA,2BAAA;AACA;AAEA;EACA,sBAAA;EACA,kBAAA;AACA;AAEA;EACA,sBAAA;AACA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;CACA,aAAA;CACA,aAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,kBAAA;CACA,iBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,0CAAA;CACA,yCAAA;CACA,kBAAA;CACA,sBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,iBAAA;CACA,cAAA;CACA,0CAAA;CACA,yCAAA;AACA;AAEA;CACA,kBAAA;CACA,sCAAA;AACA;AAEA;CACA,sCAAA;AACA;AAEA;AACA;EACA,sBAAA;AACA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021-2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class=\"task-details\">\n\t\t<div class=\"task-details-heading\">\n\t\t\t<h3>\n\t\t\t\t{{ t('mediadc', 'Duplicates list') }}\n\t\t\t\t<span v-if=\"getStatusBadge(task) === 'finished'\">\n\t\t\t\t\t- {{ details.length }} {{ n('mediadc', 'group ', 'groups', details.length) }}\n\t\t\t\t</span>\n\t\t\t\t<span v-if=\"detailsInfo.filestotal !== -1 && detailsInfo.filessize !== -1\">\n\t\t\t\t\t({{ detailsInfo.filestotal }} {{ n('mediadc', 'file', 'files', detailsInfo.filestotal) }} - {{ formatBytes(detailsInfo.filessize) }})\n\t\t\t\t</span>\n\t\t\t</h3>\n\t\t\t<div class=\"pagination-wrapper\">\n\t\t\t\t<div class=\"pagination-sorting\">\n\t\t\t\t\t<NcCheckboxRadioSwitch :checked.sync=\"sortGroups\" style=\"margin-right: 20px;\">\n\t\t\t\t\t\t{{ t('mediadc', 'Sort groups') }}\n\t\t\t\t\t</NcCheckboxRadioSwitch>\n\t\t\t\t\t<NcButton v-tooltip=\"t('mediadc', 'Sorting details by files count')\"\n\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Sorting details by files count')\"\n\t\t\t\t\t\t@click=\"toggleSorting\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<span :class=\"!sorted ? 'icon-triangle-s toggle-sorting-button' : 'icon-triangle-n toggle-sorting-button'\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t</div>\n\t\t\t\t<Pagination :details=\"(!filtered) ? details : detailsFiltered\"\n\t\t\t\t\t:prev-groups-page=\"prevGroupsPage\"\n\t\t\t\t\t:next-groups-page=\"nextGroupsPage\"\n\t\t\t\t\t:page.sync=\"page\" />\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-if=\"details.length > 0\">\n\t\t\t<div class=\"filters\">\n\t\t\t\t<label for=\"group-id-filter\">\n\t\t\t\t\t{{ t('mediadc', 'Filter by duplicate group id: ') }}\n\t\t\t\t\t<input id=\"group-id-filter\"\n\t\t\t\t\t\tv-model=\"filterId\"\n\t\t\t\t\t\tv-tooltip=\"t('mediadc', 'Filter by id or range of ids (1-10)')\"\n\t\t\t\t\t\ttype=\"search\"\n\t\t\t\t\t\tname=\"group-id-filter\"\n\t\t\t\t\t\tplaceholder=\"#id\"\n\t\t\t\t\t\tstyle=\"max-width: 33%;\"\n\t\t\t\t\t\t@input=\"filterByGroupId\">\n\t\t\t\t</label>\n\t\t\t\t<div class=\"batch-actions\" style=\"display: flex;\">\n\t\t\t\t\t<NcButton v-tooltip=\"t('mediadc', 'Toggle duplicate groups')\"\n\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Toggle duplicate groups')\"\n\t\t\t\t\t\tstyle=\"margin-right: 10px;\"\n\t\t\t\t\t\t@click=\"toggleGroups\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<span class=\"icon-category-organization\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t\t{{ t('mediadc', 'Toggle groups') }}\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t\t<div v-if=\"checkedDetailGroups.length > 0\" class=\"batch-editing\">\n\t\t\t\t\t\t{{ n('mediadc', 'Batch actions for %n group', 'Batch actions for %n groups', checkedDetailGroups.length) }}\n\t\t\t\t\t\t<NcActions placement=\"top\" style=\"margin-left: 5px;\">\n\t\t\t\t\t\t\t<template v-if=\"!filtered\">\n\t\t\t\t\t\t\t\t<NcActionButton @click=\"selectAllGroups\">\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<CheckAll :size=\"20\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t{{ checkedDetailGroups.length === details.length ? t('mediadc', 'Deselect all') : t('mediadc', 'Select all') }}\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t\t<NcActionButton v-if=\"details.length > itemsPerPage\" @click=\"selectAllGroupsOnPage\">\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<CheckUnderline :size=\"20\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t{{ checkedDetailGroupsIntersect.length === paginatedDetails[page].length || checkedDetailGroupsIntersect.length === paginatedSortedDetails[page].length ? t('mediadc', 'Deselect all on page') : t('mediadc', 'Select all on page') }}\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<NcActionButton @click=\"selectAllGroups\">\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<CheckAll :size=\"20\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t{{ checkedDetailGroups.length === detailsFiltered.length ? t('mediadc', 'Deselect all') : t('mediadc', 'Select all') }}\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t\t<NcActionButton v-if=\"detailsFiltered.length > itemsPerPage\" @click=\"selectAllGroupsOnPage\">\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<CheckUnderline :size=\"20\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t{{ checkedDetailGroupsIntersect.length === paginatedDetailsFiltered[page].length ? t('mediadc', 'Deselect all on page') : t('mediadc', 'Select all on page') }}\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<NcActionButton v-if=\"checkedDetailGroups.length > 0\" @click=\"_deselectAllGroups((!filtered) ? details : detailsFiltered)\">\n\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t<MinusBoxOutline :size=\"20\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t{{ t('mediadc', 'Uncheck selected') }}\n\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t<NcActionButton v-tooltip=\"{content: t('mediadc', 'Mark all files in group as resolved'), placement: 'left'}\"\n\t\t\t\t\t\t\t\ticon=\"icon-close\"\n\t\t\t\t\t\t\t\t@click=\"removeCheckedGroups\">\n\t\t\t\t\t\t\t\t{{ n('mediadc', 'Remove group', 'Remove groups', checkedDetailGroups.length) }}\n\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t<NcActionButton v-tooltip=\"{content: t('mediadc', 'Delete all files except the largest one'), placement: 'left'}\"\n\t\t\t\t\t\t\t\ticon=\"icon-delete\"\n\t\t\t\t\t\t\t\t:disabled=\"batchDeleting\"\n\t\t\t\t\t\t\t\t@click=\"deleteCheckedGroupsFiles\">\n\t\t\t\t\t\t\t\t<template v-if=\"!batchDeleting\" #icon>\n\t\t\t\t\t\t\t\t\t<span class=\"icon-delete material-design-icon\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else #icon>\n\t\t\t\t\t\t\t\t\t<NcLoadingIcon :size=\"20\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t{{ t('mediadc', 'Delete files') }}\n\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t</NcActions>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"!filtered\">\n\t\t\t\t<template v-if=\"sortGroups\">\n\t\t\t\t\t<div v-for=\"detail in paginatedSortedDetails[page]\"\n\t\t\t\t\t\tv-show=\"detail.files.length > 1\"\n\t\t\t\t\t\t:key=\"detail.group_id\"\n\t\t\t\t\t\tclass=\"task-details-row\">\n\t\t\t\t\t\t<DetailsListItem :detail=\"detail\" :checked-detail-groups.sync=\"checkedDetailGroups\" />\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div v-for=\"detail in paginatedDetails[page]\"\n\t\t\t\t\t\tv-show=\"detail.files.length > 1\"\n\t\t\t\t\t\t:key=\"detail.group_id\"\n\t\t\t\t\t\tclass=\"task-details-row\">\n\t\t\t\t\t\t<DetailsListItem :detail=\"detail\" :checked-detail-groups.sync=\"checkedDetailGroups\" />\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div v-else-if=\"detailsFiltered.length > 0 && filtered\">\n\t\t\t\t<template v-if=\"!sortGroups\">\n\t\t\t\t\t<div v-for=\"detail in paginatedDetailsFiltered[page]\"\n\t\t\t\t\t\tv-show=\"detail.files.length > 1\"\n\t\t\t\t\t\t:key=\"detail.group_id\"\n\t\t\t\t\t\tclass=\"task-details-row\">\n\t\t\t\t\t\t<DetailsListItem :detail=\"detail\" :checked-detail-groups.sync=\"checkedDetailGroups\" />\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<div v-for=\"detail in paginatedDetailsFilteredSorted[page]\"\n\t\t\t\t\t\tv-show=\"detail.files.length > 1\"\n\t\t\t\t\t\t:key=\"detail.group_id\"\n\t\t\t\t\t\tclass=\"task-details-row\">\n\t\t\t\t\t\t<DetailsListItem :detail=\"detail\" :checked-detail-groups.sync=\"checkedDetailGroups\" />\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<p style=\"text-align: center; font-weight: bold;\">\n\t\t\t\t\t{{ t('mediadc', 'No matchings found') }}\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else style=\"margin-top: 10px;\">\n\t\t\t<strong>{{ t('mediadc', 'No duplicates found.') }}</strong>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport { showError, showSuccess, showWarning } from '@nextcloud/dialogs'\nimport { subscribe, unsubscribe, emit } from '@nextcloud/event-bus'\nimport {\n\tNcCheckboxRadioSwitch,\n\tNcButton,\n\tNcActions,\n\tNcActionButton,\n\tNcLoadingIcon,\n} from '@nextcloud/vue'\nimport MinusBoxOutline from 'vue-material-design-icons/MinusBoxOutline.vue'\nimport CheckAll from 'vue-material-design-icons/CheckAll.vue'\nimport CheckUnderline from 'vue-material-design-icons/CheckUnderline.vue'\n\nimport { mapGetters } from 'vuex'\n\nimport Formats from '../../mixins/Formats.js'\n\nimport DetailsListItem from './DetailsListItem.vue'\nimport Pagination from './Pagination.vue'\n\nexport default {\n\tname: 'DetailsList',\n\tcomponents: {\n\t\tDetailsListItem,\n\t\tNcCheckboxRadioSwitch,\n\t\tNcButton,\n\t\tNcActions,\n\t\tNcActionButton,\n\t\tPagination,\n\t\tMinusBoxOutline,\n\t\tCheckAll,\n\t\tCheckUnderline,\n\t\tNcLoadingIcon,\n\t},\n\tmixins: [Formats],\n\tdata() {\n\t\treturn {\n\t\t\tpage: 0,\n\t\t\tfilterId: null,\n\t\t\tcheckedDetailGroups: [],\n\t\t\tbatchActionsOpened: false,\n\t\t\tsortGroups: true,\n\t\t\tbatchDeleting: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'taskInfo',\n\t\t\t'details',\n\t\t\t'detailsInfo',\n\t\t\t'sortedDetails',\n\t\t\t'sorted',\n\t\t\t'paginatedDetails',\n\t\t\t'paginatedSortedDetails',\n\t\t\t'paginatedDetailsFiltered',\n\t\t\t'paginatedDetailsFilteredSorted',\n\t\t\t'itemsPerPage',\n\t\t\t'detailsFiltered',\n\t\t\t'detailsFilteredSorted',\n\t\t\t'autoOpenNextGroup',\n\t\t]),\n\t\tfiltered() {\n\t\t\treturn this.filterId !== '' && this.filterId !== null\n\t\t},\n\t\tcheckedDetailGroupsIntersect() {\n\t\t\tlet a = []\n\t\t\tif (!this.sortGroups) {\n\t\t\t\tif (this.filtered) {\n\t\t\t\t\ta = new Set(this.paginatedDetailsFiltered[this.page].map(d => d.group_id))\n\t\t\t\t} else {\n\t\t\t\t\ta = new Set(this.paginatedDetails[this.page].map(d => d.group_id))\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.filtered) {\n\t\t\t\t\ta = new Set(this.paginatedDetailsFilteredSorted[this.page].map(d => d.group_id))\n\t\t\t\t} else {\n\t\t\t\t\ta = new Set(this.paginatedSortedDetails[this.page].map(d => d.group_id))\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst b = new Set(this.checkedDetailGroups.map(d => d.group_id))\n\t\t\tconst intersect = new Set([...a].filter(i => b.has(i)))\n\t\t\treturn Array.from(intersect)\n\t\t},\n\t\tpagesRange() {\n\t\t\tif (this.filterId === null) {\n\t\t\t\treturn Array.from({ length: Math.ceil(this.details.length / this.itemsPerPage) }, (_, i) => i)\n\t\t\t} else {\n\t\t\t\treturn Array.from({ length: Math.ceil(this.detailsFiltered.length / this.itemsPerPage) }, (_, i) => i)\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\titemsPerPage(newItemsPerPage) {\n\t\t\tif (this.page >= Math.ceil(this.details.length / newItemsPerPage)) {\n\t\t\t\tthis.page = Math.ceil(this.details.length / newItemsPerPage) - 1\n\t\t\t}\n\t\t},\n\t\tdetails(newDetails) {\n\t\t\tif (this.page >= Math.ceil(newDetails.length / this.itemsPerPage)) {\n\t\t\t\tthis.page = Math.ceil(newDetails.length / this.itemsPerPage) - 1\n\t\t\t}\n\t\t},\n\t\tsortGroups() {\n\t\t\twindow.localStorage.setItem('mediadc_details_sort_groups', this.sortGroups)\n\t\t\tthis.$store.commit('setSortGroups', this.sortGroups)\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tthis.$emit('update:loading', false)\n\t\tconst sortGroups = window.localStorage.getItem('mediadc_details_sort_groups')\n\t\tthis.sortGroups = sortGroups !== null ? JSON.parse(sortGroups) === true : true\n\t\tthis.$store.commit('setSortGroups', sortGroups !== null ? JSON.parse(sortGroups) === true : true)\n\t\tsubscribe('openNextDetailGroup', this.openNextDetailGroup)\n\t},\n\tbeforeDestroy() {\n\t\tunsubscribe('openNextDetailGroup', this.openNextDetailGroup)\n\t},\n\tmethods: {\n\t\tprevGroupsPage() {\n\t\t\tif (this.page > 0) {\n\t\t\t\tthis.page -= 1\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'First page reached!'))\n\t\t\t}\n\t\t},\n\t\tnextGroupsPage() {\n\t\t\tif (!this.filtered && this.page < Math.ceil(this.details.length / this.itemsPerPage) - 1) {\n\t\t\t\tthis.page += 1\n\t\t\t} else if (this.page < Math.ceil(this.detailsFiltered.length / this.itemsPerPage) - 1) {\n\t\t\t\tthis.page += 1\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'Last page reached!'))\n\t\t\t}\n\t\t},\n\t\ttoggleSorting() {\n\t\t\tthis.$store.commit('setSorted', !this.sorted)\n\t\t},\n\t\tfilterByGroupId() {\n\t\t\tif (this.filterId !== null && this.filterId !== '') {\n\t\t\t\tconst singleIdRegex = /^[1-9]$/s\n\t\t\t\tconst rangeIdsRegex = /^\\d+-\\d+$/s // TODO: /(^\\d+-\\d+)(, ?\\d+-\\d+)*$/s\n\t\t\t\tthis.page = 0\n\n\t\t\t\tif (singleIdRegex.test(this.filterId)) {\n\t\t\t\t\tthis.$store.commit('setDetailsFiltered', this.details.filter(d => d.group_id.toString().includes(this.filterId)))\n\t\t\t\t} else if (rangeIdsRegex.test(this.filterId)) {\n\t\t\t\t\tconst beginRange = this.filterId.split('-')[0]\n\t\t\t\t\tconst endRange = this.filterId.split('-')[1]\n\t\t\t\t\tthis.$store.commit('setDetailsFiltered', this.details.filter(d => Number(d.group_id) >= beginRange && Number(d.group_id) <= endRange))\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.$store.commit('setDetailsFiltered', [])\n\t\t\t}\n\t\t},\n\t\topenBatchActionsPopup() {\n\t\t\tdocument.addEventListener('click', this.toggleBatchActionsPopup)\n\t\t},\n\t\ttoggleBatchActionsPopup() {\n\t\t\tif (this.batchActionsOpened) {\n\t\t\t\tdocument.removeEventListener('click', this.toggleBatchActionsPopup)\n\t\t\t}\n\t\t\tthis.batchActionsOpened = !this.batchActionsOpened\n\t\t},\n\t\tremoveCheckedGroups() {\n\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${this.task.id}/details/remove`), { groupIds: this.checkedDetailGroups.map(d => d.group_id) }).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\temit('openNextDetailGroup', this.checkedDetailGroups[this.checkedDetailGroups.length - 1])\n\t\t\t\t\tconst updatedDetails = [...this.details]\n\t\t\t\t\tfor (const removedGroupId of res.data.removedGroupIds) {\n\t\t\t\t\t\tconst checkedIndex = this.checkedDetailGroups.findIndex(d => Number(d.group_id) === removedGroupId)\n\t\t\t\t\t\tif (checkedIndex !== -1) {\n\t\t\t\t\t\t\tthis.checkedDetailGroups.splice(checkedIndex, 1)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst removedDetailIndex = updatedDetails.findIndex(d => Number(d.group_id) === removedGroupId)\n\t\t\t\t\t\tupdatedDetails.splice(removedDetailIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\tthis.$store.commit('setDetails', updatedDetails)\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Selected groups successfully removed'))\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tshowError(this.t('mediadc', 'A server error occurred'))\n\t\t\t\tconsole.debug(err)\n\t\t\t})\n\t\t},\n\t\t_deselectAllGroups(_details) {\n\t\t\temit('deselectGroups', this.checkedDetailGroups.map(d => d.group_id))\n\t\t\tfor (const detail of this.details) {\n\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\tif (detailIndex !== -1) {\n\t\t\t\t\tthis.checkedDetailGroups.splice(detailIndex, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tdeleteCheckedGroupsFiles() {\n\t\t\tthis.batchDeleting = true\n\t\t\taxios.post(generateUrl(`/apps/mediadc/api/v1/tasks/${this.task.id}/details/delete`), { groupIds: this.checkedDetailGroups.map(d => d.group_id) }).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\temit('openNextDetailGroup', this.checkedDetailGroups[this.checkedDetailGroups.length - 1])\n\t\t\t\t\tconst updatedDetails = [...this.details]\n\t\t\t\t\tfor (const removedGroupId of res.data.removedGroupIds) {\n\t\t\t\t\t\tconst checkedIndex = this.checkedDetailGroups.findIndex(d => Number(d.group_id) === removedGroupId)\n\t\t\t\t\t\tif (checkedIndex !== -1) {\n\t\t\t\t\t\t\tthis.checkedDetailGroups.splice(checkedIndex, 1)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst removedDetailIndex = updatedDetails.findIndex(d => Number(d.group_id) === removedGroupId)\n\t\t\t\t\t\tupdatedDetails.splice(removedDetailIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\tthis.$store.commit('setDetails', updatedDetails)\n\t\t\t\t\tthis.$store.commit('setTask', res.data.task)\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Selected group files successfully deleted'))\n\t\t\t\t} else if (res.data.removedGroupIds.length !== 0) {\n\t\t\t\t\tshowWarning(this.t('mediadc', 'Not all selected group files deleted'))\n\t\t\t\t} else {\n\t\t\t\t\tshowError(this.t('mediadc', 'Failed to delete selected group files'))\n\t\t\t\t}\n\t\t\t\tthis.batchDeleting = false\n\t\t\t}).catch(err => {\n\t\t\t\tshowError(this.t('mediadc', 'A server error occurred'))\n\t\t\t\tconsole.debug(err)\n\t\t\t\tthis.batchDeleting = false\n\t\t\t})\n\t\t},\n\t\tselectAllGroups() {\n\t\t\tconst _details = (!this.filtered) ? this.details : this.detailsFiltered\n\t\t\tif (this.checkedDetailGroups.length === _details.length) {\n\t\t\t\tthis._deselectAllGroups(_details)\n\t\t\t} else {\n\t\t\t\tfor (const detail of _details) {\n\t\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\t\tif (detailIndex === -1) {\n\t\t\t\t\t\tthis.checkedDetailGroups.push(detail)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tselectAllGroupsOnPage() {\n\t\t\tconst _details = (!this.filtered)\n\t\t\t\t? ((!this.sortGroups) ? this.paginatedDetails : this.paginatedSortedDetails)\n\t\t\t\t: ((!this.sortGroups) ? this.paginatedDetailsFiltered : this.paginatedDetailsFilteredSorted)\n\t\t\tif (_details[this.page].length === this.checkedDetailGroupsIntersect.length) {\n\t\t\t\tconst groupsToDeselect = this.checkedDetailGroupsIntersect\n\t\t\t\temit('deselectGroups', groupsToDeselect)\n\t\t\t\tfor (const detail of groupsToDeselect) {\n\t\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\t\tif (detailIndex !== -1) {\n\t\t\t\t\t\tthis.checkedDetailGroups.splice(detailIndex, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const detail of _details[this.page]) {\n\t\t\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\t\tif (detailIndex === -1) {\n\t\t\t\t\t\tthis.checkedDetailGroups.push(detail)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\topenNextDetailGroup(detail) {\n\t\t\tif (this.autoOpenNextGroup) {\n\t\t\t\tconst detailIndex = this.details.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\tif (detailIndex !== -1) {\n\t\t\t\t\tif (detailIndex !== this.details.length - 1) {\n\t\t\t\t\t\temit('openGroup', this.details[detailIndex + 1])\n\t\t\t\t\t} else if (detailIndex === this.details.length - 1 && this.details.length >= 2) {\n\t\t\t\t\t\temit('openGroup', this.details[detailIndex - 1])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\ttoggleGroups() {\n\t\t\tconst _details = (!this.filtered)\n\t\t\t\t? ((!this.sortGroups) ? this.paginatedDetails[this.page] : this.paginatedSortedDetails[this.page])\n\t\t\t\t: ((!this.sortGroups) ? this.paginatedDetailsFiltered[this.page] : this.paginatedDetailsFilteredSorted[this.page])\n\t\t\tfor (const detail of _details) {\n\t\t\t\temit('toggleGroup', detail)\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.task-details {\n\twidth: 100%;\n\tpadding: 20px 10px 20px 20px;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\toverflow-y: scroll;\n\tmargin: 0 auto 20px;\n}\n\n.task-details-heading {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.task-details-heading h3 {\n\tmargin: 0;\n}\n\n@media (max-width: 540px) {\n\t.task-details {\n\t\tpadding: 15px 0px 10px 10px;\n\t}\n\n\t.task-details-heading {\n\t\tflex-direction: column;\n\t\ttext-align: center;\n\t}\n\n\t.pagination-wrapper {\n\t\tflex-direction: column;\n\t}\n}\n\n.pagination-wrapper, .pagination-sorting, .pagination {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.pagination-button {\n\tpadding: 20px;\n\tmargin: 0 5px;\n\twidth: 16px;\n\theight: 16px;\n\tcursor: pointer;\n\tborder-radius: 50%;\n\tuser-select: none;\n}\n\n.task-details-row {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\tmargin-bottom: 5px;\n\ttransition: height .3s;\n}\n\n.filters {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tpadding: 5px 10px;\n\tmargin: 10px 0;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n}\n\ninput#group-id-filter {\n\twidth: fit-content;\n\tborder-color: var(--color-border-dark);\n}\n\nbody[data-theme-dark] .task-details-row, body[data-theme-dark] .filters {\n\tborder-color: var(--color-border-dark);\n}\n\n@media (max-width: 540px) {\n\t.filters {\n\t\tflex-direction: column;\n\t}\n}\n\n.batch-editing {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n</style>\n"],sourceRoot:""}]);const o=l},61283:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\n.open-details-btn .button-vue__text {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n","",{version:3,sources:["webpack://./src/components/details/DetailsListItem.vue"],names:[],mappings:";AA2XA;CACA,oBAAA;CACA,mBAAA;CACA,uBAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021-2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div :id=\"'detail-' + detail.task_id + '-' + detail.group_id\"\n\t\tclass=\"details-list-item\"\n\t\t:class=\"{'icon-loading': updating}\">\n\t\t<div class=\"details-list-item-title\">\n\t\t\t<NcCheckboxRadioSwitch v-tooltip=\"{content: t('mediadc', 'Select group'), placement: 'top'}\"\n\t\t\t\tclass=\"mediadc-checkbox-only batch-checkbox\"\n\t\t\t\t:checked.sync=\"checked\" />\n\t\t\t<NcButton type=\"tertiary\"\n\t\t\t\tclass=\"open-details-btn\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Open duplicate group')\"\n\t\t\t\t@click=\"openDetailFiles(detail)\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class=\"icon-projects\" />\n\t\t\t\t</template>\n\t\t\t\t<template #default>\n\t\t\t\t\t{{ t('mediadc', 'Duplicate group') }} #{{ detail.group_id }} ({{ groupFilesTotal }}\n\t\t\t\t\t{{ n('mediadc', 'file', 'files', groupFilesTotal) }}{{ ' - ' + formatBytes(groupFilesSize) }})\n\t\t\t\t\t<span :class=\"!opened ? 'icon-triangle-s' : 'icon-triangle-n'\"\n\t\t\t\t\t\tstyle=\"display: inline-flex; margin: 0 0 0 5px;\" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t\t<NcActions>\n\t\t\t\t<NcActionButton icon=\"icon-delete delete-group-btn\" @click=\"removeTaskDetail(detail)\">\n\t\t\t\t\t{{ t('mediadc', 'Remove group without deleting files') }}\n\t\t\t\t</NcActionButton>\n\t\t\t</NcActions>\n\t\t</div>\n\t\t<div v-if=\"opened && groupFilesTotal > groupItemsPerPage\" class=\"pagination\">\n\t\t\t<NcButton type=\"tertiary\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Previous duplicate group files page')\"\n\t\t\t\tstyle=\"margin-right: 5px;\"\n\t\t\t\t@click=\"openPrevDetailFiles(detail)\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class=\"icon-view-previous\" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t\t<span>{{ t('mediadc', 'Page:') }}&nbsp;</span>\n\t\t\t<span>{{ page + 1 }}/{{ Math.ceil(groupFilesTotal / groupItemsPerPage) }}</span>\n\t\t\t<NcButton type=\"tertiary\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Next duplicate group files page')\"\n\t\t\t\tstyle=\"margin-left: 5px;\"\n\t\t\t\t@click=\"openNextDetailFiles(detail)\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class=\"icon-view-next\" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t\t<input id=\"go_to_page\"\n\t\t\t\tv-model=\"goToPage\"\n\t\t\t\ttype=\"number\"\n\t\t\t\tstyle=\"width: fit-content;\"\n\t\t\t\t:min=\"1\"\n\t\t\t\t:max=\"pagesRange[pagesRange.length - 1] + 1\"\n\t\t\t\tname=\"go_to_page\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Page to navigate to')\"\n\t\t\t\t@keyup.enter=\"navigateToPage\">\n\t\t\t<NcButton v-if=\"detail.files.length > groupItemsPerPage\"\n\t\t\t\tv-tooltip=\"t('mediadc', 'Go to page')\"\n\t\t\t\ttype=\"tertiary\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Navigate to duplicate list page')\"\n\t\t\t\t@click=\"navigateToPage\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class=\"icon-confirm\" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t</div>\n\t\t<DetailsGroupList v-if=\"opened\"\n\t\t\t:detail=\"detail\"\n\t\t\t:files=\"files\"\n\t\t\t:all-files=\"allFiles\"\n\t\t\t:loading-files.sync=\"loadingFiles\"\n\t\t\t:updating.sync=\"updating\"\n\t\t\t:files-ascending.sync=\"filesAscending\" />\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport { showError, showSuccess, showWarning } from '@nextcloud/dialogs'\nimport { subscribe, unsubscribe, emit } from '@nextcloud/event-bus'\nimport {\n\tNcCheckboxRadioSwitch,\n\tNcActions,\n\tNcActionButton,\n\tNcButton,\n} from '@nextcloud/vue'\n\nimport { mapGetters } from 'vuex'\n\nimport Formats from '../../mixins/Formats.js'\nimport DetailsGroupList from './DetailsGroupList.vue'\n\nexport default {\n\tname: 'DetailsListItem',\n\tcomponents: {\n\t\tNcActions,\n\t\tNcActionButton,\n\t\tNcButton,\n\t\tNcCheckboxRadioSwitch,\n\t\tDetailsGroupList,\n\t},\n\tmixins: [Formats],\n\tprops: {\n\t\tdetail: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcheckedDetailGroups: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\topened: false,\n\t\t\tpage: 0,\n\t\t\ttotalPages: 0,\n\t\t\tloadingFiles: false,\n\t\t\tfiles: [],\n\t\t\tallFiles: [],\n\t\t\tpaginatedFiles: {},\n\t\t\tchecked: false,\n\t\t\tfilesAscending: false,\n\t\t\tupdating: false,\n\t\t\tgoToPage: 1,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'details',\n\t\t\t'groupItemsPerPage',\n\t\t\t'deleteFileConfirmation',\n\t\t]),\n\t\tgroupFilesSize() {\n\t\t\treturn this.allFiles.length === 0 ? this.detail.files.reduce((sum, file) => sum + Number(file.filesize), 0) : this.allFiles.reduce((sum, file) => sum + Number(file.filesize), 0)\n\t\t},\n\t\tgroupFilesTotal() {\n\t\t\treturn this.allFiles.length === 0 ? this.detail.files.length : this.allFiles.length\n\t\t},\n\t\tpagesRange() {\n\t\t\treturn Array.from({ length: Math.ceil(this.detail.files.length / this.groupItemsPerPage) }, (_, i) => i)\n\t\t},\n\t},\n\twatch: {\n\t\tchecked() {\n\t\t\tconst newCheckedDetailGroups = this.checkedDetailGroups\n\t\t\tconst detailIndex = newCheckedDetailGroups.findIndex(d => d.group_id === this.detail.group_id)\n\t\t\tif (this.checked) {\n\t\t\t\tif (detailIndex === -1) {\n\t\t\t\t\tnewCheckedDetailGroups.push(this.detail)\n\t\t\t\t}\n\t\t\t} else if (detailIndex !== -1) {\n\t\t\t\tnewCheckedDetailGroups.splice(detailIndex, 1)\n\t\t\t}\n\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t},\n\t\tfilesAscending() {\n\t\t\tthis.sortFiles(this.filesAscending)\n\t\t},\n\t\tcheckedDetailGroups() {\n\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.group_id === this.detail.group_id)\n\t\t\tif (!this.checked && detailIndex !== -1) {\n\t\t\t\tthis.checked = true\n\t\t\t}\n\t\t},\n\t\tgroupItemsPerPage(newGroupItemsPerPage) {\n\t\t\tif (this.opened) {\n\t\t\t\tif (this.page >= Math.ceil(this.detail.files.length / newGroupItemsPerPage)) {\n\t\t\t\t\tthis.page = Math.ceil(this.detail.files.length / newGroupItemsPerPage) - 1\n\t\t\t\t}\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\tif (this.goToPage >= Math.ceil(this.detail.files.length / newGroupItemsPerPage)) {\n\t\t\t\t\tthis.goToPage = Math.ceil(this.detail.files.length / newGroupItemsPerPage)\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tallFiles(newAllFiles) {\n\t\t\tif (this.page >= Math.ceil(newAllFiles.length / this.groupItemsPerPage)) {\n\t\t\t\tthis.page = Math.ceil(newAllFiles.length / this.groupItemsPerPage) - 1\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t}\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tconst detailCheckedIndex = this.checkedDetailGroups.findIndex(d => d.group_id === this.detail.group_id)\n\t\tthis.checked = detailCheckedIndex !== -1\n\t\tsubscribe('updateGroupFilesPagination', this.updateFilesPagination)\n\t\tsubscribe('deselectGroups', this.deselect)\n\t\tsubscribe('openGroup', this.openGroup)\n\t\tsubscribe('toggleGroup', this.toggleGroup)\n\t},\n\tbeforeDestroy() {\n\t\tunsubscribe('updateGroupFilesPagination', this.updateFilesPagination)\n\t\tunsubscribe('deselectGroups', this.deselect)\n\t\tunsubscribe('openGroup', this.openGroup)\n\t\tunsubscribe('toggleGroup', this.toggleGroup)\n\t},\n\tmethods: {\n\t\topenDetailFiles(detail) {\n\t\t\tif (!this.opened) {\n\t\t\t\tif (this.files === undefined || this.files.length === 0) {\n\t\t\t\t\tconst taskId = detail.task_id\n\t\t\t\t\tconst detailId = detail.group_id\n\t\t\t\t\tthis.loadingFiles = true\n\t\t\t\t\tthis.opened = true\n\t\t\t\t\tif (this.allFiles.length === 0) {\n\t\t\t\t\t\tthis.loadAllFilesInfo(taskId, detailId)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\t\t\tthis.loadingFiles = false\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.opened = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.opened = false\n\t\t\t}\n\t\t},\n\t\topenNextDetailFiles(detail) {\n\t\t\tif (this.page < Math.ceil(detail.files.length / this.groupItemsPerPage) - 1) {\n\t\t\t\tthis.page += 1\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'Last page reached!'))\n\t\t\t}\n\t\t},\n\t\topenPrevDetailFiles(detail) {\n\t\t\tif (this.page > 0) {\n\t\t\t\tthis.page -= 1\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'First page reached!'))\n\t\t\t}\n\t\t},\n\t\tloadAllFilesInfo(taskId, detailId) {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${taskId}/files/${detailId}/all`)).then(res => {\n\t\t\t\tthis.allFiles = res.data.files\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\tthis.loadingFiles = false\n\t\t\t})\n\t\t},\n\t\tpaginateFiles(files) {\n\t\t\tconst paginatedFiles = []\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\tconst last = paginatedFiles[paginatedFiles.length - 1]\n\t\t\t\tif (!last || last.length === this.groupItemsPerPage) {\n\t\t\t\t\tpaginatedFiles.push([Object.freeze(files[i])])\n\t\t\t\t} else {\n\t\t\t\t\tlast.push(Object.freeze(files[i]))\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn paginatedFiles\n\t\t},\n\t\tremoveTaskDetail(detail) {\n\t\t\tif (this.deleteFileConfirmation) {\n\t\t\t\tconst self = this\n\t\t\t\tOC.dialogs.confirm(this.t('mediadc', 'Are you sure you want to remove this group without deleting files?'),\n\t\t\t\t\tthis.t('mediadc', 'Confirm group removal'), function(success) {\n\t\t\t\t\t\tif (success) {\n\t\t\t\t\t\t\tself._removeTaskDetail(detail)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._removeTaskDetail(detail)\n\t\t\t}\n\t\t},\n\t\t_removeTaskDetail(detail) {\n\t\t\tthis.updating = true\n\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${detail.task_id}/detail/${detail.group_id}`)).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t\tconst updatedDetails = [...this.details]\n\t\t\t\t\tconst removedDetailIndex = updatedDetails.findIndex(d => d.group_id === this.detail.group_id)\n\t\t\t\t\tupdatedDetails.splice(removedDetailIndex, 1)\n\t\t\t\t\tconst checkedIndex = this.checkedDetailGroups.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\t\tconst newCheckedDetailGroups = [...this.checkedDetailGroups]\n\t\t\t\t\tif (this.checked && checkedIndex !== -1) {\n\t\t\t\t\t\tnewCheckedDetailGroups.splice(checkedIndex, 1)\n\t\t\t\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t\t\t\t}\n\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\tthis.$store.commit('setDetails', updatedDetails)\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Duplicate group succesffully removed'))\n\t\t\t\t\tconst detailCheckedIndex = this.checkedDetailGroups.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\t\tif (detailCheckedIndex !== -1) {\n\t\t\t\t\t\tconst newCheckedDetailGroups = this.checkedDetailGroups\n\t\t\t\t\t\tnewCheckedDetailGroups.splice(detailCheckedIndex, 1)\n\t\t\t\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t\t\t\t}\n\t\t\t\t\tthis.updating = false\n\t\t\t\t} else {\n\t\t\t\t\tshowError(this.t('mediadc', 'An error occurred while deleting duplicate group'))\n\t\t\t\t\tthis.updating = false\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.debug(err)\n\t\t\t\tshowError(this.t('mediadc', 'An error occurred while deleting duplicate group'))\n\t\t\t\tthis.updating = false\n\t\t\t})\n\t\t},\n\t\tsortFiles(ascending) {\n\t\t\tthis.allFiles.sort((a, b) => (ascending) ? a.filesize - b.filesize : b.filesize - a.filesize)\n\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t},\n\t\tupdateFilesPagination(file) {\n\t\t\tif (file) {\n\t\t\t\tconst deletedFileIndex = this.allFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\tif (deletedFileIndex !== -1) {\n\t\t\t\t\tthis.allFiles.splice(deletedFileIndex, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t},\n\t\tdeselect(groupsToDeselect) {\n\t\t\tif (this.checked && groupsToDeselect.includes(this.detail.group_id)) {\n\t\t\t\tthis.checked = false\n\t\t\t}\n\t\t},\n\t\topenGroup(detail) {\n\t\t\tif (this.detail.group_id === detail.group_id && !this.opened) {\n\t\t\t\tthis.openDetailFiles(detail)\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst target = document.getElementById(`detail-${detail.task_id}-${detail.group_id}`)\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\ttarget.scrollIntoView({ behavior: 'smooth' })\n\t\t\t\t\t}\n\t\t\t\t}, 500) // wait for the details to open and render files\n\t\t\t}\n\t\t},\n\t\ttoggleGroup(detail) {\n\t\t\tif (this.detail.group_id === detail.group_id) {\n\t\t\t\tthis.openDetailFiles(detail)\n\t\t\t}\n\t\t},\n\t\tnavigateToPage() {\n\t\t\tif (this.goToPage > this.pagesRange.length) {\n\t\t\t\tthis.goToPage = this.pagesRange.length\n\t\t\t} else if (this.goToPage <= 0) {\n\t\t\t\tthis.goToPage = 1\n\t\t\t}\n\t\t\tthis.page = this.goToPage - 1\n\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t},\n\t},\n}\n<\/script>\n\n<style>\n.open-details-btn .button-vue__text {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n</style>\n\n<style scoped>\n.details-list-item {\n\twidth: 100%;\n\tpadding: 10px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tflex-direction: column;\n\tposition: relative;\n}\n\n.details-list-item-title {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.pagination {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.group-info {\n\tdisplay: flex;\n\talign-items: center;\n\tuser-select: none;\n}\n\n.delete-group-btn {\n\tvisibility: hidden;\n}\n\n.details-list-item:hover .delete-group-btn {\n\tvisibility: visible;\n}\n\n.batch-checkbox {\n\tvisibility: hidden;\n\tmargin-right: 14px;\n}\n\n.batch-checkbox .checkbox-radio-switch__icon {\n\tmargin-right: 0;\n\tcolor: #000;\n}\n\n.batch-checkbox.checkbox-radio-switch--checked {\n\tvisibility: visible;\n}\n\n.details-list-item:hover .batch-checkbox {\n\tvisibility: visible;\n}\n\n@media (max-width: 540px) {\n\t.delete-group-btn {\n\t\tvisibility: visible;\n\t}\n\n\t.batch-checkbox {\n\t\tvisibility: visible;\n\t\tmargin-right: 10px;\n\t}\n}\n</style>\n"],sourceRoot:""}]);const o=l},67243:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\n.details-list-item[data-v-d2859054] {\n\twidth: 100%;\n\tpadding: 10px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tflex-direction: column;\n\tposition: relative;\n}\n.details-list-item-title[data-v-d2859054] {\n\tdisplay: flex;\n\talign-items: center;\n}\n.pagination[data-v-d2859054] {\n\tdisplay: flex;\n\talign-items: center;\n}\n.group-info[data-v-d2859054] {\n\tdisplay: flex;\n\talign-items: center;\n\tuser-select: none;\n}\n.delete-group-btn[data-v-d2859054] {\n\tvisibility: hidden;\n}\n.details-list-item:hover .delete-group-btn[data-v-d2859054] {\n\tvisibility: visible;\n}\n.batch-checkbox[data-v-d2859054] {\n\tvisibility: hidden;\n\tmargin-right: 14px;\n}\n.batch-checkbox .checkbox-radio-switch__icon[data-v-d2859054] {\n\tmargin-right: 0;\n\tcolor: #000;\n}\n.batch-checkbox.checkbox-radio-switch--checked[data-v-d2859054] {\n\tvisibility: visible;\n}\n.details-list-item:hover .batch-checkbox[data-v-d2859054] {\n\tvisibility: visible;\n}\n@media (max-width: 540px) {\n.delete-group-btn[data-v-d2859054] {\n\t\tvisibility: visible;\n}\n.batch-checkbox[data-v-d2859054] {\n\t\tvisibility: visible;\n\t\tmargin-right: 10px;\n}\n}\n","",{version:3,sources:["webpack://./src/components/details/DetailsListItem.vue"],names:[],mappings:";AAmYA;CACA,WAAA;CACA,aAAA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,sBAAA;CACA,kBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,iBAAA;AACA;AAEA;CACA,kBAAA;AACA;AAEA;CACA,mBAAA;AACA;AAEA;CACA,kBAAA;CACA,kBAAA;AACA;AAEA;CACA,eAAA;CACA,WAAA;AACA;AAEA;CACA,mBAAA;AACA;AAEA;CACA,mBAAA;AACA;AAEA;AACA;EACA,mBAAA;AACA;AAEA;EACA,mBAAA;EACA,kBAAA;AACA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021-2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div :id=\"'detail-' + detail.task_id + '-' + detail.group_id\"\n\t\tclass=\"details-list-item\"\n\t\t:class=\"{'icon-loading': updating}\">\n\t\t<div class=\"details-list-item-title\">\n\t\t\t<NcCheckboxRadioSwitch v-tooltip=\"{content: t('mediadc', 'Select group'), placement: 'top'}\"\n\t\t\t\tclass=\"mediadc-checkbox-only batch-checkbox\"\n\t\t\t\t:checked.sync=\"checked\" />\n\t\t\t<NcButton type=\"tertiary\"\n\t\t\t\tclass=\"open-details-btn\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Open duplicate group')\"\n\t\t\t\t@click=\"openDetailFiles(detail)\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class=\"icon-projects\" />\n\t\t\t\t</template>\n\t\t\t\t<template #default>\n\t\t\t\t\t{{ t('mediadc', 'Duplicate group') }} #{{ detail.group_id }} ({{ groupFilesTotal }}\n\t\t\t\t\t{{ n('mediadc', 'file', 'files', groupFilesTotal) }}{{ ' - ' + formatBytes(groupFilesSize) }})\n\t\t\t\t\t<span :class=\"!opened ? 'icon-triangle-s' : 'icon-triangle-n'\"\n\t\t\t\t\t\tstyle=\"display: inline-flex; margin: 0 0 0 5px;\" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t\t<NcActions>\n\t\t\t\t<NcActionButton icon=\"icon-delete delete-group-btn\" @click=\"removeTaskDetail(detail)\">\n\t\t\t\t\t{{ t('mediadc', 'Remove group without deleting files') }}\n\t\t\t\t</NcActionButton>\n\t\t\t</NcActions>\n\t\t</div>\n\t\t<div v-if=\"opened && groupFilesTotal > groupItemsPerPage\" class=\"pagination\">\n\t\t\t<NcButton type=\"tertiary\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Previous duplicate group files page')\"\n\t\t\t\tstyle=\"margin-right: 5px;\"\n\t\t\t\t@click=\"openPrevDetailFiles(detail)\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class=\"icon-view-previous\" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t\t<span>{{ t('mediadc', 'Page:') }}&nbsp;</span>\n\t\t\t<span>{{ page + 1 }}/{{ Math.ceil(groupFilesTotal / groupItemsPerPage) }}</span>\n\t\t\t<NcButton type=\"tertiary\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Next duplicate group files page')\"\n\t\t\t\tstyle=\"margin-left: 5px;\"\n\t\t\t\t@click=\"openNextDetailFiles(detail)\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class=\"icon-view-next\" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t\t<input id=\"go_to_page\"\n\t\t\t\tv-model=\"goToPage\"\n\t\t\t\ttype=\"number\"\n\t\t\t\tstyle=\"width: fit-content;\"\n\t\t\t\t:min=\"1\"\n\t\t\t\t:max=\"pagesRange[pagesRange.length - 1] + 1\"\n\t\t\t\tname=\"go_to_page\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Page to navigate to')\"\n\t\t\t\t@keyup.enter=\"navigateToPage\">\n\t\t\t<NcButton v-if=\"detail.files.length > groupItemsPerPage\"\n\t\t\t\tv-tooltip=\"t('mediadc', 'Go to page')\"\n\t\t\t\ttype=\"tertiary\"\n\t\t\t\t:aria-label=\"t('mediadc', 'Navigate to duplicate list page')\"\n\t\t\t\t@click=\"navigateToPage\">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class=\"icon-confirm\" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t</div>\n\t\t<DetailsGroupList v-if=\"opened\"\n\t\t\t:detail=\"detail\"\n\t\t\t:files=\"files\"\n\t\t\t:all-files=\"allFiles\"\n\t\t\t:loading-files.sync=\"loadingFiles\"\n\t\t\t:updating.sync=\"updating\"\n\t\t\t:files-ascending.sync=\"filesAscending\" />\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport { showError, showSuccess, showWarning } from '@nextcloud/dialogs'\nimport { subscribe, unsubscribe, emit } from '@nextcloud/event-bus'\nimport {\n\tNcCheckboxRadioSwitch,\n\tNcActions,\n\tNcActionButton,\n\tNcButton,\n} from '@nextcloud/vue'\n\nimport { mapGetters } from 'vuex'\n\nimport Formats from '../../mixins/Formats.js'\nimport DetailsGroupList from './DetailsGroupList.vue'\n\nexport default {\n\tname: 'DetailsListItem',\n\tcomponents: {\n\t\tNcActions,\n\t\tNcActionButton,\n\t\tNcButton,\n\t\tNcCheckboxRadioSwitch,\n\t\tDetailsGroupList,\n\t},\n\tmixins: [Formats],\n\tprops: {\n\t\tdetail: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcheckedDetailGroups: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\topened: false,\n\t\t\tpage: 0,\n\t\t\ttotalPages: 0,\n\t\t\tloadingFiles: false,\n\t\t\tfiles: [],\n\t\t\tallFiles: [],\n\t\t\tpaginatedFiles: {},\n\t\t\tchecked: false,\n\t\t\tfilesAscending: false,\n\t\t\tupdating: false,\n\t\t\tgoToPage: 1,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'details',\n\t\t\t'groupItemsPerPage',\n\t\t\t'deleteFileConfirmation',\n\t\t]),\n\t\tgroupFilesSize() {\n\t\t\treturn this.allFiles.length === 0 ? this.detail.files.reduce((sum, file) => sum + Number(file.filesize), 0) : this.allFiles.reduce((sum, file) => sum + Number(file.filesize), 0)\n\t\t},\n\t\tgroupFilesTotal() {\n\t\t\treturn this.allFiles.length === 0 ? this.detail.files.length : this.allFiles.length\n\t\t},\n\t\tpagesRange() {\n\t\t\treturn Array.from({ length: Math.ceil(this.detail.files.length / this.groupItemsPerPage) }, (_, i) => i)\n\t\t},\n\t},\n\twatch: {\n\t\tchecked() {\n\t\t\tconst newCheckedDetailGroups = this.checkedDetailGroups\n\t\t\tconst detailIndex = newCheckedDetailGroups.findIndex(d => d.group_id === this.detail.group_id)\n\t\t\tif (this.checked) {\n\t\t\t\tif (detailIndex === -1) {\n\t\t\t\t\tnewCheckedDetailGroups.push(this.detail)\n\t\t\t\t}\n\t\t\t} else if (detailIndex !== -1) {\n\t\t\t\tnewCheckedDetailGroups.splice(detailIndex, 1)\n\t\t\t}\n\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t},\n\t\tfilesAscending() {\n\t\t\tthis.sortFiles(this.filesAscending)\n\t\t},\n\t\tcheckedDetailGroups() {\n\t\t\tconst detailIndex = this.checkedDetailGroups.findIndex(d => d.group_id === this.detail.group_id)\n\t\t\tif (!this.checked && detailIndex !== -1) {\n\t\t\t\tthis.checked = true\n\t\t\t}\n\t\t},\n\t\tgroupItemsPerPage(newGroupItemsPerPage) {\n\t\t\tif (this.opened) {\n\t\t\t\tif (this.page >= Math.ceil(this.detail.files.length / newGroupItemsPerPage)) {\n\t\t\t\t\tthis.page = Math.ceil(this.detail.files.length / newGroupItemsPerPage) - 1\n\t\t\t\t}\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\tif (this.goToPage >= Math.ceil(this.detail.files.length / newGroupItemsPerPage)) {\n\t\t\t\t\tthis.goToPage = Math.ceil(this.detail.files.length / newGroupItemsPerPage)\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tallFiles(newAllFiles) {\n\t\t\tif (this.page >= Math.ceil(newAllFiles.length / this.groupItemsPerPage)) {\n\t\t\t\tthis.page = Math.ceil(newAllFiles.length / this.groupItemsPerPage) - 1\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t}\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tconst detailCheckedIndex = this.checkedDetailGroups.findIndex(d => d.group_id === this.detail.group_id)\n\t\tthis.checked = detailCheckedIndex !== -1\n\t\tsubscribe('updateGroupFilesPagination', this.updateFilesPagination)\n\t\tsubscribe('deselectGroups', this.deselect)\n\t\tsubscribe('openGroup', this.openGroup)\n\t\tsubscribe('toggleGroup', this.toggleGroup)\n\t},\n\tbeforeDestroy() {\n\t\tunsubscribe('updateGroupFilesPagination', this.updateFilesPagination)\n\t\tunsubscribe('deselectGroups', this.deselect)\n\t\tunsubscribe('openGroup', this.openGroup)\n\t\tunsubscribe('toggleGroup', this.toggleGroup)\n\t},\n\tmethods: {\n\t\topenDetailFiles(detail) {\n\t\t\tif (!this.opened) {\n\t\t\t\tif (this.files === undefined || this.files.length === 0) {\n\t\t\t\t\tconst taskId = detail.task_id\n\t\t\t\t\tconst detailId = detail.group_id\n\t\t\t\t\tthis.loadingFiles = true\n\t\t\t\t\tthis.opened = true\n\t\t\t\t\tif (this.allFiles.length === 0) {\n\t\t\t\t\t\tthis.loadAllFilesInfo(taskId, detailId)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\t\t\tthis.loadingFiles = false\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.opened = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.opened = false\n\t\t\t}\n\t\t},\n\t\topenNextDetailFiles(detail) {\n\t\t\tif (this.page < Math.ceil(detail.files.length / this.groupItemsPerPage) - 1) {\n\t\t\t\tthis.page += 1\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'Last page reached!'))\n\t\t\t}\n\t\t},\n\t\topenPrevDetailFiles(detail) {\n\t\t\tif (this.page > 0) {\n\t\t\t\tthis.page -= 1\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'First page reached!'))\n\t\t\t}\n\t\t},\n\t\tloadAllFilesInfo(taskId, detailId) {\n\t\t\taxios.get(generateUrl(`/apps/mediadc/api/v1/tasks/${taskId}/files/${detailId}/all`)).then(res => {\n\t\t\t\tthis.allFiles = res.data.files\n\t\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t\t\tthis.loadingFiles = false\n\t\t\t})\n\t\t},\n\t\tpaginateFiles(files) {\n\t\t\tconst paginatedFiles = []\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\tconst last = paginatedFiles[paginatedFiles.length - 1]\n\t\t\t\tif (!last || last.length === this.groupItemsPerPage) {\n\t\t\t\t\tpaginatedFiles.push([Object.freeze(files[i])])\n\t\t\t\t} else {\n\t\t\t\t\tlast.push(Object.freeze(files[i]))\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn paginatedFiles\n\t\t},\n\t\tremoveTaskDetail(detail) {\n\t\t\tif (this.deleteFileConfirmation) {\n\t\t\t\tconst self = this\n\t\t\t\tOC.dialogs.confirm(this.t('mediadc', 'Are you sure you want to remove this group without deleting files?'),\n\t\t\t\t\tthis.t('mediadc', 'Confirm group removal'), function(success) {\n\t\t\t\t\t\tif (success) {\n\t\t\t\t\t\t\tself._removeTaskDetail(detail)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._removeTaskDetail(detail)\n\t\t\t}\n\t\t},\n\t\t_removeTaskDetail(detail) {\n\t\t\tthis.updating = true\n\t\t\taxios.delete(generateUrl(`/apps/mediadc/api/v1/tasks/${detail.task_id}/detail/${detail.group_id}`)).then(res => {\n\t\t\t\tif (res.data.success) {\n\t\t\t\t\temit('openNextDetailGroup', this.detail)\n\t\t\t\t\tconst updatedDetails = [...this.details]\n\t\t\t\t\tconst removedDetailIndex = updatedDetails.findIndex(d => d.group_id === this.detail.group_id)\n\t\t\t\t\tupdatedDetails.splice(removedDetailIndex, 1)\n\t\t\t\t\tconst checkedIndex = this.checkedDetailGroups.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\t\tconst newCheckedDetailGroups = [...this.checkedDetailGroups]\n\t\t\t\t\tif (this.checked && checkedIndex !== -1) {\n\t\t\t\t\t\tnewCheckedDetailGroups.splice(checkedIndex, 1)\n\t\t\t\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t\t\t\t}\n\t\t\t\t\temit('updateTaskInfo')\n\t\t\t\t\tthis.$store.commit('setDetails', updatedDetails)\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Duplicate group succesffully removed'))\n\t\t\t\t\tconst detailCheckedIndex = this.checkedDetailGroups.findIndex(d => d.group_id === detail.group_id)\n\t\t\t\t\tif (detailCheckedIndex !== -1) {\n\t\t\t\t\t\tconst newCheckedDetailGroups = this.checkedDetailGroups\n\t\t\t\t\t\tnewCheckedDetailGroups.splice(detailCheckedIndex, 1)\n\t\t\t\t\t\tthis.$emit('update:checkedDetailGroups', newCheckedDetailGroups)\n\t\t\t\t\t}\n\t\t\t\t\tthis.updating = false\n\t\t\t\t} else {\n\t\t\t\t\tshowError(this.t('mediadc', 'An error occurred while deleting duplicate group'))\n\t\t\t\t\tthis.updating = false\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.debug(err)\n\t\t\t\tshowError(this.t('mediadc', 'An error occurred while deleting duplicate group'))\n\t\t\t\tthis.updating = false\n\t\t\t})\n\t\t},\n\t\tsortFiles(ascending) {\n\t\t\tthis.allFiles.sort((a, b) => (ascending) ? a.filesize - b.filesize : b.filesize - a.filesize)\n\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t},\n\t\tupdateFilesPagination(file) {\n\t\t\tif (file) {\n\t\t\t\tconst deletedFileIndex = this.allFiles.findIndex(f => f.fileid === file.fileid)\n\t\t\t\tif (deletedFileIndex !== -1) {\n\t\t\t\t\tthis.allFiles.splice(deletedFileIndex, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.paginatedFiles = this.paginateFiles(this.allFiles)\n\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t},\n\t\tdeselect(groupsToDeselect) {\n\t\t\tif (this.checked && groupsToDeselect.includes(this.detail.group_id)) {\n\t\t\t\tthis.checked = false\n\t\t\t}\n\t\t},\n\t\topenGroup(detail) {\n\t\t\tif (this.detail.group_id === detail.group_id && !this.opened) {\n\t\t\t\tthis.openDetailFiles(detail)\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst target = document.getElementById(`detail-${detail.task_id}-${detail.group_id}`)\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\ttarget.scrollIntoView({ behavior: 'smooth' })\n\t\t\t\t\t}\n\t\t\t\t}, 500) // wait for the details to open and render files\n\t\t\t}\n\t\t},\n\t\ttoggleGroup(detail) {\n\t\t\tif (this.detail.group_id === detail.group_id) {\n\t\t\t\tthis.openDetailFiles(detail)\n\t\t\t}\n\t\t},\n\t\tnavigateToPage() {\n\t\t\tif (this.goToPage > this.pagesRange.length) {\n\t\t\t\tthis.goToPage = this.pagesRange.length\n\t\t\t} else if (this.goToPage <= 0) {\n\t\t\t\tthis.goToPage = 1\n\t\t\t}\n\t\t\tthis.page = this.goToPage - 1\n\t\t\tthis.files = this.paginatedFiles[this.page]\n\t\t},\n\t},\n}\n<\/script>\n\n<style>\n.open-details-btn .button-vue__text {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n</style>\n\n<style scoped>\n.details-list-item {\n\twidth: 100%;\n\tpadding: 10px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tflex-direction: column;\n\tposition: relative;\n}\n\n.details-list-item-title {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.pagination {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.group-info {\n\tdisplay: flex;\n\talign-items: center;\n\tuser-select: none;\n}\n\n.delete-group-btn {\n\tvisibility: hidden;\n}\n\n.details-list-item:hover .delete-group-btn {\n\tvisibility: visible;\n}\n\n.batch-checkbox {\n\tvisibility: hidden;\n\tmargin-right: 14px;\n}\n\n.batch-checkbox .checkbox-radio-switch__icon {\n\tmargin-right: 0;\n\tcolor: #000;\n}\n\n.batch-checkbox.checkbox-radio-switch--checked {\n\tvisibility: visible;\n}\n\n.details-list-item:hover .batch-checkbox {\n\tvisibility: visible;\n}\n\n@media (max-width: 540px) {\n\t.delete-group-btn {\n\t\tvisibility: visible;\n\t}\n\n\t.batch-checkbox {\n\t\tvisibility: visible;\n\t\tmargin-right: 10px;\n\t}\n}\n</style>\n"],sourceRoot:""}]);const o=l},31280:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\ninput#go_to_page[data-v-07add7c2] {\n\twidth: fit-content;\n\tborder-color: var(--color-border-dark);\n}\n","",{version:3,sources:["webpack://./src/components/details/Pagination.vue"],names:[],mappings:";AAuHA;CACA,kBAAA;CACA,sCAAA;AACA",sourcesContent:['\x3c!--\n - @copyright Copyright (c) 2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author 2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div class="pagination">\n\t\t<NcButton v-if="details.length > itemsPerPage"\n\t\t\ttype="tertiary"\n\t\t\t:aria-label="t(\'mediadc\', \'Previous duplicate list page\')"\n\t\t\t@click="prevGroupsPage">\n\t\t\t<template #icon>\n\t\t\t\t<span class="icon-view-previous pagination-button" />\n\t\t\t</template>\n\t\t</NcButton>\n\t\t<span v-if="details.length > itemsPerPage" style="margin-left: 5px;">{{ t(\'mediadc\', \'Page:\') }}&nbsp;</span>\n\t\t<span v-if="details.length > itemsPerPage" style="margin-right: 5px;">{{ page + 1 }}/{{ Math.ceil(details.length / itemsPerPage) }}</span>\n\t\t<NcButton v-if="details.length > itemsPerPage"\n\t\t\ttype="tertiary"\n\t\t\t:aria-label="t(\'mediadc\', \'Next duplicate list page\')"\n\t\t\t@click="nextGroupsPage">\n\t\t\t<template #icon>\n\t\t\t\t<span class="icon-view-next pagination-button" />\n\t\t\t</template>\n\t\t</NcButton>\n\t\t<template v-if="details.length > itemsPerPage">\n\t\t\t<input id="go_to_page"\n\t\t\t\tv-model="goToPage"\n\t\t\t\ttype="number"\n\t\t\t\t:min="1"\n\t\t\t\t:max="pagesRange[pagesRange.length - 1] + 1"\n\t\t\t\tname="go_to_page"\n\t\t\t\t:aria-label="t(\'mediadc\', \'Page to navigate to\')"\n\t\t\t\t@keyup.enter="navigateToPage">\n\t\t\t<NcButton v-tooltip="t(\'mediadc\', \'Go to page\')"\n\t\t\t\ttype="tertiary"\n\t\t\t\t:aria-label="t(\'mediadc\', \'Navigate to duplicate list page\')"\n\t\t\t\t@click="navigateToPage">\n\t\t\t\t<template #icon>\n\t\t\t\t\t<span class="icon-confirm" />\n\t\t\t\t</template>\n\t\t\t</NcButton>\n\t\t</template>\n\t</div>\n</template>\n\n<script>\nimport { NcButton } from \'@nextcloud/vue\'\nimport { mapGetters } from \'vuex\'\n\nexport default {\n\tname: \'Pagination\',\n\tcomponents: {\n\t\tNcButton,\n\t},\n\tprops: {\n\t\tdetails: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tprevGroupsPage: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tnextGroupsPage: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tpage: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tgoToPage: 1,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t\'itemsPerPage\',\n\t\t]),\n\t\tpagesRange() {\n\t\t\treturn Array.from({ length: Math.ceil(this.details.length / this.itemsPerPage) }, (_, i) => i)\n\t\t},\n\t},\n\tmethods: {\n\t\tnavigateToPage() {\n\t\t\tif (this.goToPage > this.pagesRange.length) {\n\t\t\t\tthis.goToPage = this.pagesRange.length\n\t\t\t} else if (this.goToPage <= 0) {\n\t\t\t\tthis.goToPage = 1\n\t\t\t}\n\t\t\tthis.$emit(\'update:page\', this.goToPage - 1)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\ninput#go_to_page {\n\twidth: fit-content;\n\tborder-color: var(--color-border-dark);\n}\n</style>\n'],sourceRoot:""}]);const o=l},81150:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\n.fade-enter-active[data-v-d11ce3a6],\n.fade-leave-active[data-v-d11ce3a6] {\n\ttransition: opacity 250ms;\n}\n.fade-enter[data-v-d11ce3a6],\n.fade-leave-to[data-v-d11ce3a6] {\n\topacity: 0;\n}\n.fade-visibility-enter[data-v-d11ce3a6],\n.fade-visibility-leave-to[data-v-d11ce3a6] {\n\tvisibility: hidden;\n\topacity: 0;\n}\n.block-wrapper[data-v-d11ce3a6] {\n\tposition: fixed;\n\tz-index: 9998;\n\ttop: 0;\n\tleft: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n}\n.edit-task-block[data-v-d11ce3a6] {\n\tposition: relative;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\tbox-shadow: 0 0 30px var(--color-box-shadow);\n\tpadding: 20px 20px 10px;\n\twidth: 100%;\n\tmax-width: 600px;\n\tmargin: auto;\n\tbackground-color: var(--color-main-background);\n}\n.edit-task-close[data-v-d11ce3a6] {\n\tposition: absolute;\n\ttop: 10px;\n\tright: 5px;\n\tpadding: 25px;\n\tbackground: var(--icon-close-dark) no-repeat center;\n\topacity: .5;\n\tcursor: pointer;\n}\n.edit-task-close[data-v-d11ce3a6]:hover {\n\topacity: 1;\n}\n@media (max-width: 767px) {\n.selection-container[data-v-d11ce3a6] {\n\t\tflex-wrap: wrap;\n}\n}\n@media (max-width: 540px) {\n.edit-task-block[data-v-d11ce3a6] {\n\t\twidth: 90vw;\n\t\theight: 80vh;\n\t\toverflow-y: scroll;\n\t\ttop: calc(100% - 96vh);\n}\n}\n.delete-button[data-v-d11ce3a6] {\n\tdisplay: inline-flex;\n\twidth: 15px;\n\theight: 15px;\n\tcursor: pointer;\n\tmargin: 0 10px;\n}\n.create-task-actions[data-v-d11ce3a6] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tmargin-top: 5px;\n\tpadding: 0 10px;\n}\n","",{version:3,sources:["webpack://./src/components/tasks/TasksEdit.vue"],names:[],mappings:";AA6aA;;CAEA,yBAAA;AACA;AAEA;;CAEA,UAAA;AACA;AAEA;;CAEA,kBAAA;CACA,UAAA;AACA;AAEA;CACA,eAAA;CACA,aAAA;CACA,MAAA;CACA,OAAA;CACA,aAAA;CACA,mBAAA;CACA,uBAAA;CACA,WAAA;CACA,YAAA;AAEA;AAEA;CACA,kBAAA;CACA,0CAAA;CACA,yCAAA;CACA,4CAAA;CACA,uBAAA;CACA,WAAA;CACA,gBAAA;CACA,YAAA;CACA,8CAAA;AACA;AAEA;CACA,kBAAA;CACA,SAAA;CACA,UAAA;CACA,aAAA;CACA,mDAAA;CACA,WAAA;CACA,eAAA;AACA;AAEA;CACA,UAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;AAEA;AACA;EACA,WAAA;EACA,YAAA;EACA,kBAAA;EACA,sBAAA;AACA;AACA;AAEA;CACA,oBAAA;CACA,WAAA;CACA,YAAA;CACA,eAAA;CACA,cAAA;AACA;AAEA;CACA,aAAA;CACA,mBAAA;CACA,8BAAA;CACA,eAAA;CACA,eAAA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021-2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<transition name=\"fade\">\n\t\t<div class=\"block-wrapper\">\n\t\t\t<div class=\"edit-task-block\">\n\t\t\t\t<div class=\"edit-task-close\" @click=\"closeEditTaskDialog()\" />\n\t\t\t\t<h2>{{ t('mediadc', 'Edit task') }}</h2>\n\t\t\t\t<div class=\"selection-container\">\n\t\t\t\t\t<div class=\"block target-directories-block\">\n\t\t\t\t\t\t<h3>{{ t('mediadc', 'Target directories') }}</h3>\n\t\t\t\t\t\t<div v-if=\"targetDirectoriesIds.length > 0\">\n\t\t\t\t\t\t\t<div v-for=\"fileid in targetDirectoriesIds\" :key=\"fileid\" class=\"selected-target-directories-list\">\n\t\t\t\t\t\t\t\t<div class=\"target-directory\">\n\t\t\t\t\t\t\t\t\t<span style=\"overflow-y: scroll; white-space: nowrap;\">{{ targetDirectoriesPaths[fileid] }}</span>\n\t\t\t\t\t\t\t\t\t<NcButton v-tooltip=\"{ content: t('mediadc', 'Remove'), placement: 'left'}\"\n\t\t\t\t\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Remove selected target directory')\"\n\t\t\t\t\t\t\t\t\t\t@click=\"removeTargetDirectory(fileid)\">\n\t\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"icon-delete\" />\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Not selected') }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<NcButton :aria-label=\"t('mediadc', 'Select target directory')\"\n\t\t\t\t\t\t\t@click=\"openDirectoriesExplorer\">\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<PlusThick :size=\"16\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t{{ t('mediadc', 'Select') }}\n\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"block\">\n\t\t\t\t\t\t<h3>{{ t('mediadc', 'Exclude directories') }}</h3>\n\t\t\t\t\t\t<div v-if=\"excludeDirectoriesPaths.length > 0\">\n\t\t\t\t\t\t\t<div v-for=\"fileid in Object.keys(excludeFileIds)\" :key=\"fileid\" class=\"selected-excluded-directories-list\">\n\t\t\t\t\t\t\t\t<div class=\"target-directory\">\n\t\t\t\t\t\t\t\t\t<span style=\"overflow-y: scroll; white-space: nowrap;\">{{ excludeFileIds[fileid] }}</span>\n\t\t\t\t\t\t\t\t\t<NcButton v-tooltip=\"{ content: t('mediadc', 'Remove'), placement: 'left'}\"\n\t\t\t\t\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Remove selected exclude directory')\"\n\t\t\t\t\t\t\t\t\t\t@click=\"removeExcludeDirectory(fileid)\">\n\t\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"icon-delete\" />\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Not selected') }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<NcButton :aria-label=\"t('mediadc', 'Select exclude directory')\"\n\t\t\t\t\t\t\t@click=\"openExcludeExplorer\">\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<PlusThick :size=\"16\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t{{ t('mediadc', 'Select') }}\n\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"selection-container\">\n\t\t\t\t\t<div class=\"block\">\n\t\t\t\t\t\t<h3>{{ t('mediadc', 'Custom exclude mask') }}</h3>\n\t\t\t\t\t\t<div v-if=\"customExcludeList.length > 0\" class=\"custom-masks-list\">\n\t\t\t\t\t\t\t<div v-for=\"(mask, index) in customExcludeList\" :key=\"index\" class=\"custom-mask\">\n\t\t\t\t\t\t\t\t<span>{{ mask }}</span>\n\t\t\t\t\t\t\t\t<NcButton v-tooltip=\"{ content: t('mediadc', 'Remove'), placement: 'left'}\"\n\t\t\t\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Remove selected custom exclude mask')\"\n\t\t\t\t\t\t\t\t\t@click=\"deleteCustomMask(mask)\">\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<span class=\"icon-delete\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t\t<span>{{ t('mediadc', 'Not added') }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if=\"addingCustomMask\" style=\"display: flex; align-items: center;\">\n\t\t\t\t\t\t\t<input id=\"custom-exclude-mask\"\n\t\t\t\t\t\t\t\tref=\"customExcludeMask\"\n\t\t\t\t\t\t\t\tv-model=\"customExcludeMask\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t@keyup.enter=\"addCustomMask\"\n\t\t\t\t\t\t\t\t@keyup.esc=\"cancelAddingCustomMask\">\n\t\t\t\t\t\t\t<NcButton v-tooltip=\"t('mediadc', 'Confirm')\"\n\t\t\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Confirm adding of the custom exclude mask')\"\n\t\t\t\t\t\t\t\t@click=\"addCustomMask\">\n\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t<span class=\"icon-checkmark\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t\t\t<NcButton v-tooltip=\"t('mediadc', 'Decline')\"\n\t\t\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Cancel adding of the custom exclude mask')\"\n\t\t\t\t\t\t\t\t@click=\"cancelAddingCustomMask\">\n\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t<span class=\"icon-close\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style=\"display: flex; align-items: center; margin: 20px 0;\">\n\t\t\t\t\t\t\t<NcButton :aria-label=\"t('mediadc', 'Add custom exclude mask')\"\n\t\t\t\t\t\t\t\t@click=\"addNewMask\">\n\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t<PlusThick :size=\"16\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t\t\t\t{{ t('mediadc', 'Add mask') }}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"block\">\n\t\t\t\t\t\t<h3 style=\"margin: 5px 0;\">\n\t\t\t\t\t\t\t{{ t('mediadc', 'Target Mime Type') }}\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<select id=\"target_mtype\"\n\t\t\t\t\t\t\tv-model=\"targetMimeType\"\n\t\t\t\t\t\t\tname=\"target_mtype\">\n\t\t\t\t\t\t\t<option :value=\"0\">\n\t\t\t\t\t\t\t\t{{ t('mediadc', 'Photos') }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t<option :value=\"1\">\n\t\t\t\t\t\t\t\t{{ t('mediadc', 'Videos') }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t<option :value=\"2\">\n\t\t\t\t\t\t\t\t{{ t('mediadc', 'Photos and Videos') }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t\t<h3 style=\"margin: 5px 0;\">\n\t\t\t\t\t\t\t{{ t('mediadc', 'Similarity threshold') }}\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<input v-model=\"similarity_threshold\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tmin=\"50\"\n\t\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t\t\tstyle=\"margin: 0 0 10px;\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"create-task-actions\">\n\t\t\t\t\t<NcButton :aria-label=\"t('mediadc', 'Restart Task with changed parameters')\"\n\t\t\t\t\t\t:disabled=\"runningTask || Object.keys(targetDirectoriesPaths).length === 0\"\n\t\t\t\t\t\t@click=\"restartTask\">\n\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t\t{{ t('mediadc', 'Restart task') }}\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-if=\"runningTask\" #icon>\n\t\t\t\t\t\t\t<span class=\"icon-loading-small\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t\t<input v-model=\"taskName\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t:placeholder=\"t('mediadc', 'Task name')\">\n\t\t\t\t\t<NcCheckboxRadioSwitch :checked.sync=\"finishNotification\">\n\t\t\t\t\t\t{{ t('mediadc', 'Finish notification') }}\n\t\t\t\t\t</NcCheckboxRadioSwitch>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</transition>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { generateUrl } from '@nextcloud/router'\nimport { getFilePickerBuilder, showWarning, showSuccess, showError } from '@nextcloud/dialogs'\nimport { emit } from '@nextcloud/event-bus'\n\nimport { NcCheckboxRadioSwitch, NcButton } from '@nextcloud/vue'\nimport PlusThick from 'vue-material-design-icons/PlusThick.vue'\n\nimport { mapGetters } from 'vuex'\n\nimport { requestFileInfo, getFileId } from '../../utils/files.js'\n\nexport default {\n\tname: 'TasksEdit',\n\tcomponents: {\n\t\tNcButton,\n\t\tNcCheckboxRadioSwitch,\n\t\tPlusThick,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\ttargetDirectoriesPaths: {},\n\t\t\ttargetDirectoriesIds: [],\n\t\t\texcludeDirectoriesPaths: [],\n\t\t\texcludeFileIds: {},\n\t\t\ttargetMimeType: 0,\n\t\t\tsimilarity_threshold: 90,\n\t\t\tcustomExcludeList: [],\n\t\t\tcustomExcludeMask: '',\n\t\t\taddingCustomMask: false,\n\t\t\trunningTask: false,\n\t\t\tfinishNotification: true,\n\t\t\ttaskName: '',\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'settings',\n\t\t\t'settingByName',\n\t\t\t'tasks',\n\t\t\t'task',\n\t\t\t'taskInfo',\n\t\t]),\n\t},\n\tbeforeMount() {\n\t\tthis.similarity_threshold = this.settingByName('similarity_threshold') !== undefined\n\t\t\t? this.settingByName('similarity_threshold').value\n\t\t\t: 90\n\t\tthis.targetMimeType = JSON.parse(this.task.collector_settings).target_mtype\n\t\tthis.similarity_threshold = JSON.parse(this.task.collector_settings).similarity_threshold\n\t\tthis.finishNotification = JSON.parse(this.task.collector_settings).finish_notification\n\t\tthis.taskName = this.task.name\n\t\tthis.parseTaskSettings()\n\t},\n\tmethods: {\n\t\tparseTaskSettings() {\n\t\t\tif (this.taskInfo !== null && 'target_directories' in this.taskInfo) {\n\t\t\t\tthis.taskInfo.target_directories.forEach(dir => {\n\t\t\t\t\tthis.targetDirectoriesIds.push(dir.fileid.toString())\n\t\t\t\t\tthis.targetDirectoriesPaths[dir.fileid.toString()] = dir.filepath.replace(`/${getCurrentUser().uid}/files`, '') !== '' ? dir.filepath.replace(`/${getCurrentUser().uid}/files`, '') : '/'\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (this.taskInfo !== null && 'exclude_directories' in this.taskInfo) {\n\t\t\t\tthis.taskInfo.exclude_directories.forEach(dir => {\n\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir.filepath.replace())\n\t\t\t\t\tthis.excludeFileIds[dir.fileid.toString()] = dir.filepath.replace(`/${getCurrentUser().uid}/files`, '')\n\t\t\t\t})\n\t\t\t\tthis.customExcludeList = JSON.parse(this.task.exclude_list).user.mask\n\t\t\t}\n\t\t},\n\t\tgetDirectoriesPicker(title) {\n\t\t\treturn getFilePickerBuilder(title)\n\t\t\t\t.setMultiSelect(false)\n\t\t\t\t.addMimeTypeFilter('httpd/unix-directory')\n\t\t\t\t.setType(1)\n\t\t\t\t.allowDirectories(true)\n\t\t\t\t.build()\n\t\t},\n\t\topenDirectoriesExplorer() {\n\t\t\tthis.getDirectoriesPicker(this.t('mediadc', 'Choose target directory')).pick().then(dir => {\n\t\t\t\tif (dir.startsWith('/')) {\n\t\t\t\t\trequestFileInfo(dir).then(res => {\n\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\tif (!(fileid in this.targetDirectoriesPaths)) {\n\t\t\t\t\t\t\t\tthis.targetDirectoriesIds.push(fileid)\n\t\t\t\t\t\t\t\tthis.targetDirectoriesPaths[fileid.toString()] = dir\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tshowWarning(this.t('mediadc', 'This directory already selected'))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\trequestFileInfo('/').then(res => {\n\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\tif (!(fileid in this.targetDirectoriesPaths)) {\n\t\t\t\t\t\t\t\tthis.targetDirectoriesIds.push(fileid)\n\t\t\t\t\t\t\t\tthis.targetDirectoriesPaths[fileid.toString()] = '/'\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tshowWarning(this.t('mediadc', 'This directory already selected'))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\topenExcludeExplorer() {\n\t\t\tthis.getDirectoriesPicker(this.t('mediadc', 'Choose directory to exclude')).pick().then(dir => {\n\t\t\t\tif (Object.values(this.excludeFileIds).findIndex(targetDir => targetDir === dir) === -1) {\n\t\t\t\t\tif (dir.startsWith('/')) {\n\t\t\t\t\t\trequestFileInfo(dir).then(res => {\n\t\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir)\n\t\t\t\t\t\t\t\tthis.excludeFileIds[fileid.toString()] = dir\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\trequestFileInfo('/').then(res => {\n\t\t\t\t\t\t\tconst fileid = getFileId(res.data)\n\t\t\t\t\t\t\tif (fileid !== -1) {\n\t\t\t\t\t\t\t\tthis.excludeDirectoriesPaths.push(dir)\n\t\t\t\t\t\t\t\tthis.excludeFileIds[fileid.toString()] = '/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tshowWarning(this.t('mediadc', 'This directory already excluded'))\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\trestartTask() {\n\t\t\tthis.runningTask = true\n\t\t\tthis.$store.dispatch('getSettings').then(() => {\n\t\t\t\taxios.post(generateUrl('/apps/mediadc/api/v1/tasks/restart'), {\n\t\t\t\t\ttaskId: this.task.id,\n\t\t\t\t\ttargetDirectoryIds: JSON.stringify(this.targetDirectoriesIds),\n\t\t\t\t\texcludeList: {\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tmask: this.customExcludeList,\n\t\t\t\t\t\t\tfileid: Object.keys(this.excludeFileIds).map(item => Number(item)),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tadmin: JSON.parse(this.settingByName('exclude_list').value) || { mask: [], fileid: [] },\n\t\t\t\t\t},\n\t\t\t\t\tcollectorSettings: {\n\t\t\t\t\t\thashing_algorithm: JSON.parse(this.settingByName('hashing_algorithm').value) || 'dhash',\n\t\t\t\t\t\tsimilarity_threshold: Number(this.similarity_threshold),\n\t\t\t\t\t\thash_size: Number(this.settingByName('hash_size').value) || 16,\n\t\t\t\t\t\ttarget_mtype: this.targetMimeType,\n\t\t\t\t\t\tfinish_notification: this.finishNotification,\n\t\t\t\t\t},\n\t\t\t\t\tname: this.taskName,\n\t\t\t\t}).then(res => {\n\t\t\t\t\tthis.runningTask = false\n\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\tthis.runningTask = false\n\t\t\t\t\t\tthis.closeEditTaskDialog()\n\t\t\t\t\t\temit('restartTask')\n\t\t\t\t\t\tshowSuccess(this.t('mediadc', 'Task successfully restarted!'))\n\t\t\t\t\t} else if (res.data.limit) {\n\t\t\t\t\t\tshowWarning(this.t('mediadc', 'Running tasks limit exceeded. Try again later.'))\n\t\t\t\t\t} else if (res.data.empty) {\n\t\t\t\t\t\tshowWarning(this.n('mediadc', 'Target folder has no files or all of them excluded', 'Target folders have no files or all of them excluded', this.targetDirectoriesIds.length))\n\t\t\t\t\t} else if (res.data.php_exec_not_enabled) {\n\t\t\t\t\t\tshowError(t('mediadc', 'Task run error: PHP `exec` function is not enabled'))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowWarning(t('medaidc', 'Some error occurred while running Collector Task. Try again.'))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\t\tremoveTargetDirectory(fileid) {\n\t\t\tdelete this.targetDirectoriesPaths[fileid]\n\t\t\tconst fileidIndex = this.targetDirectoriesIds.findIndex(id => id === fileid)\n\t\t\tthis.targetDirectoriesIds.splice(fileidIndex, 1)\n\t\t},\n\t\tremoveExcludeDirectory(fileid) {\n\t\t\tif (fileid in this.excludeFileIds) {\n\t\t\t\tconst dirIndex = this.excludeDirectoriesPaths.findIndex(dir => dir === this.excludeFileIds[fileid])\n\t\t\t\tthis.excludeDirectoriesPaths.splice(dirIndex, 1)\n\t\t\t\tdelete this.excludeFileIds[fileid]\n\t\t\t}\n\t\t},\n\t\taddNewMask() {\n\t\t\tthis.addingCustomMask = true\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$refs.customExcludeMask.focus()\n\t\t\t}, 100)\n\t\t},\n\t\taddCustomMask() {\n\t\t\tif (this.customExcludeMask.length > 0) {\n\t\t\t\tif (this.customExcludeList.findIndex(mask => mask === this.customExcludeMask) === -1) {\n\t\t\t\t\tthis.customExcludeList.push(this.customExcludeMask)\n\t\t\t\t\tthis.customExcludeMask = ''\n\t\t\t\t\tthis.addingCustomMask = false\n\t\t\t\t} else {\n\t\t\t\t\tshowWarning(this.t('mediadc', 'This mask already exists!'))\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'Enter custom mask!'))\n\t\t\t}\n\t\t},\n\t\tcancelAddingCustomMask() {\n\t\t\tthis.customExcludeMask = ''\n\t\t\tthis.addingCustomMask = false\n\t\t},\n\t\tdeleteCustomMask(mask) {\n\t\t\tconst maskIndex = this.customExcludeList.findIndex(m => m === mask)\n\t\t\tthis.customExcludeList.splice(maskIndex, 1)\n\t\t},\n\t\tresetForm() {\n\t\t\tthis.targetDirectoriesPaths = {}\n\t\t\tthis.targetDirectoriesIds = []\n\t\t\tthis.excludeDirectoriesNames = []\n\t\t\tthis.excludeFileIds = {}\n\t\t\tthis.targetMimeType = 0\n\t\t\tthis.similarity_threshold = this.settingByName('similarity_threshold') !== undefined\n\t\t\t\t? this.settingByName('similarity_threshold').value\n\t\t\t\t: 90\n\t\t\tthis.customExcludeList = []\n\t\t\tthis.runningTask = false\n\t\t\tthis.finishNotification = true\n\t\t},\n\t\tcloseEditTaskDialog() {\n\t\t\tthis.$emit('update:opened', false)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.fade-enter-active,\n.fade-leave-active {\n\ttransition: opacity 250ms;\n}\n\n.fade-enter,\n.fade-leave-to {\n\topacity: 0;\n}\n\n.fade-visibility-enter,\n.fade-visibility-leave-to {\n\tvisibility: hidden;\n\topacity: 0;\n}\n\n.block-wrapper {\n\tposition: fixed;\n\tz-index: 9998;\n\ttop: 0;\n\tleft: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n\n}\n\n.edit-task-block {\n\tposition: relative;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\tbox-shadow: 0 0 30px var(--color-box-shadow);\n\tpadding: 20px 20px 10px;\n\twidth: 100%;\n\tmax-width: 600px;\n\tmargin: auto;\n\tbackground-color: var(--color-main-background);\n}\n\n.edit-task-close {\n\tposition: absolute;\n\ttop: 10px;\n\tright: 5px;\n\tpadding: 25px;\n\tbackground: var(--icon-close-dark) no-repeat center;\n\topacity: .5;\n\tcursor: pointer;\n}\n\n.edit-task-close:hover {\n\topacity: 1;\n}\n\n@media (max-width: 767px) {\n\t.selection-container {\n\t\tflex-wrap: wrap;\n\t}\n}\n\n@media (max-width: 540px) {\n\t.edit-task-block {\n\t\twidth: 90vw;\n\t\theight: 80vh;\n\t\toverflow-y: scroll;\n\t\ttop: calc(100% - 96vh);\n\t}\n}\n\n.delete-button {\n\tdisplay: inline-flex;\n\twidth: 15px;\n\theight: 15px;\n\tcursor: pointer;\n\tmargin: 0 10px;\n}\n\n.create-task-actions {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tmargin-top: 5px;\n\tpadding: 0 10px;\n}\n</style>\n"],sourceRoot:""}]);const o=l},2586:(t,e,i)=>{i.d(e,{A:()=>o});var n=i(71354),s=i.n(n),a=i(76314),l=i.n(a)()(s());l.push([t.id,"\n.fade-enter-active[data-v-a195a68e],\n.fade-leave-active[data-v-a195a68e] {\n\ttransition: opacity 0.5s ease;\n}\n.fade-enter-from[data-v-a195a68e],\n.fade-leave-to[data-v-a195a68e] {\n\topacity: 0;\n}\n.container[data-v-a195a68e] {\n\tpadding: 0 20px;\n\twidth: 100%;\n\tmax-width: 1440px;\n\tmargin: 0 auto;\n\tmax-height: 100%;\n}\n@media (min-width: 1920px) {\n.container[data-v-a195a68e] {\n\t\tmax-width: 80vw;\n}\n}\nh2[data-v-a195a68e] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\tmargin: 20px auto 10px;\n\ttext-align: center;\n\tfont-size: 24px;\n}\n.task-details-heading p[data-v-a195a68e] {\n\ttext-align: center;\n\tfont-size: 15px;\n}\n.details-row[data-v-a195a68e] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin: 0 10px 20px;\n\tposition: relative;\n}\n@media (max-width: 767px) {\n.details-row[data-v-a195a68e] {\n\t\tflex-wrap: wrap;\n}\n.task-details-heading[data-v-a195a68e] {\n\t\tflex-direction: column;\n}\n}\n.task-status-row[data-v-a195a68e] {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-wrap: wrap;\n}\n.task-status-wrapper[data-v-a195a68e] {\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: 16px;\n\toverflow: hidden;\n}\n.task-status-wrapper progress[data-v-a195a68e] {\n\tmargin-top: 5px;\n}\n.task-status[data-v-a195a68e] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tpadding: 10px\n}\n.task-info[data-v-a195a68e] {\n\tmargin: 20px 0;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\tpadding: 10px 20px;\n\theight: 100%;\n\tmin-height: 105px;\n\tmax-height: 105px;\n\tmax-width: 50%;\n\toverflow-y: scroll;\n}\n@media (max-width: 767px) {\n.details-row[data-v-a195a68e] {\n\t\tmargin: 0 0 20px;\n}\n.task-status[data-v-a195a68e] {\n\t\tflex-direction: column;\n\t\twidth: 100%;\n}\n.task-info[data-v-a195a68e] {\n\t\tmax-width: 100%;\n\t\tmargin: 0;\n}\n}\n.task-info h3[data-v-a195a68e] {\n\tmargin: 0 0 5px 0;\n\tfont-weight: bold;\n}\n.target-directory-row[data-v-a195a68e] {\n\twhite-space: nowrap;\n\tpadding: 7px 0;\n}\n@media (max-width: 540px) {\n.task-status-row[data-v-a195a68e] {\n\t\tflex-direction: column;\n\t\tmargin: 20px 0;\n}\n.badge[data-v-a195a68e] {\n\t\tmargin-right: 0;\n\t\tmargin-top: 10px;\n\t\tmargin-bottom: 10px;\n}\n}\n","",{version:3,sources:["webpack://./src/views/CollectorDetails.vue"],names:[],mappings:";AAqYA;;CAEA,6BAAA;AACA;AAEA;;CAEA,UAAA;AACA;AAEA;CACA,eAAA;CACA,WAAA;CACA,iBAAA;CACA,cAAA;CACA,gBAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;AAEA;CACA,oBAAA;CACA,mBAAA;CACA,uBAAA;CACA,WAAA;CACA,sBAAA;CACA,kBAAA;CACA,eAAA;AACA;AAEA;CACA,kBAAA;CACA,eAAA;AACA;AAEA;CACA,aAAA;CACA,sBAAA;CACA,mBAAA;CACA,kBAAA;AACA;AAEA;AACA;EACA,eAAA;AACA;AACA;EACA,sBAAA;AACA;AACA;AAEA;CACA,aAAA;CACA,uBAAA;CACA,mBAAA;CACA,eAAA;AACA;AAEA;CACA,0CAAA;CACA,mBAAA;CACA,gBAAA;AACA;AAEA;CACA,eAAA;AACA;AAEA;CACA,oBAAA;CACA,mBAAA;CACA;AACA;AAEA;CACA,cAAA;CACA,0CAAA;CACA,yCAAA;CACA,kBAAA;CACA,YAAA;CACA,iBAAA;CACA,iBAAA;CACA,cAAA;CACA,kBAAA;AACA;AAEA;AACA;EACA,gBAAA;AACA;AAEA;EACA,sBAAA;EACA,WAAA;AACA;AAEA;EACA,eAAA;EACA,SAAA;AACA;AACA;AAEA;CACA,iBAAA;CACA,iBAAA;AACA;AAEA;CACA,mBAAA;CACA,cAAA;AACA;AAEA;AACA;EACA,sBAAA;EACA,cAAA;AACA;AAEA;EACA,eAAA;EACA,gBAAA;EACA,mBAAA;AACA;AACA",sourcesContent:["\x3c!--\n - @copyright Copyright (c) 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @copyright Copyright (c) 2021-2022 Alexander Piskun <bigcat88@icloud.com>\n -\n - @author 2021-2022 Andrey Borysenko <andrey18106x@gmail.com>\n -\n - @license AGPL-3.0-or-later\n -\n - This program is free software: you can redistribute it and/or modify\n - it under the terms of the GNU Affero General Public License as\n - published by the Free Software Foundation, either version 3 of the\n - License, or (at your option) any later version.\n -\n - This program is distributed in the hope that it will be useful,\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n - GNU Affero General Public License for more details.\n -\n - You should have received a copy of the GNU Affero General Public License\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\n -\n --\x3e\n\n<template>\n\t<div v-if=\"!loading\" class=\"container\">\n\t\t<TasksEdit v-if=\"editingTask\" :opened.sync=\"editingTask\" />\n\t\t<DetailsExport v-if=\"exporting\" :opened.sync=\"exporting\" :task=\"task\" />\n\t\t<div class=\"task-details\">\n\t\t\t<div class=\"task-details-heading\">\n\t\t\t\t<h2>\n\t\t\t\t\t{{ rootTitle }}\n\t\t\t\t\t<NcButton v-if=\"isValidUser\"\n\t\t\t\t\t\tv-tooltip=\"{content: !collapsedStatus\n\t\t\t\t\t\t\t? t('mediadc', 'Collapse task status')\n\t\t\t\t\t\t\t: t('mediadc', 'Show task status'), placement: 'bottom-end'}\"\n\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Collapse task status')\"\n\t\t\t\t\t\tstyle=\"margin: 0 10px;\"\n\t\t\t\t\t\t@click=\"collapseTaskStatus\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<span :class=\"!collapsedStatus ? 'icon-triangle-n' : 'icon-triangle-s'\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t</h2>\n\t\t\t\t<Transition name=\"fade\" appear>\n\t\t\t\t\t<div v-if=\"isValidUser\" v-show=\"!collapsedStatus\" class=\"task-details-description\">\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t{{ t('mediadc', 'Here you can view task details, manage task (stop or restart), delete found duplicated photos and videos.') }}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t{{ t('mediadc', 'Deleted files are placed in the trashbin, so that they can be restored in case of need.') }}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</Transition>\n\t\t\t</div>\n\t\t\t<Transition name=\"fade\" appear>\n\t\t\t\t<div v-if=\"isValidUser\" v-show=\"!collapsedStatus\" class=\"task-status-row\">\n\t\t\t\t\t<div class=\"task-status-wrapper\" style=\"display: flex; flex-direction: column; margin: 20px;\">\n\t\t\t\t\t\t<div class=\"task-status\">\n\t\t\t\t\t\t\t<span :class=\"'badge ' + getStatusBadge(task)\">{{ getStatusBadge(task) }}</span>\n\t\t\t\t\t\t\t<div style=\"display: flex; flex-direction: column;\">\n\t\t\t\t\t\t\t\t<span v-if=\"task.name !== null && task.name !== ''\"><b>{{ task.name }}</b><br></span>\n\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t<b>{{ parseTargetMtype(task) }}</b> {{ task.files_scanned !== task.files_total ? `${task.files_scanned}/` : '' }}{{ task.files_total }} {{ n('mediadc', 'file', 'files', task.files_total) }}\n\t\t\t\t\t\t\t\t\t({{ formatBytes(Number(task.files_total_size)) }})\n\t\t\t\t\t\t\t\t\t({{ task !== null && 'collector_settings' in task ? t('mediadc', 'precision: ') + JSON.parse(task.collector_settings).similarity_threshold + '%' : '' }})\n\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t<b>{{ t('mediadc', 'Deleted: ') }} </b>\n\t\t\t\t\t\t\t\t\t{{ task.deleted_files_count }} {{ n('mediadc', 'file', 'files', task.deleted_files_count) }}\n\t\t\t\t\t\t\t\t\t({{ formatBytes(Number(task.deleted_files_size)) }})\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t{{ parseUnixTimestamp(task.created_time) }}\n\t\t\t\t\t\t\t\t\t{{ Number(task.finished_time) > 0 ? ' - ' + parseUnixTimestamp(task.finished_time) : '' }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<NcActions style=\"margin: 0 0 0 10px;\">\n\t\t\t\t\t\t\t\t<NcActionButton v-tooltip=\"{content: t('mediadc', 'Restart task with current params'), placement: 'left'}\"\n\t\t\t\t\t\t\t\t\ticon=\"icon-history\"\n\t\t\t\t\t\t\t\t\t:close-after-click=\"true\"\n\t\t\t\t\t\t\t\t\t@click=\"restartTask(task)\">\n\t\t\t\t\t\t\t\t\t{{ getStatusBadge(task) === 'duplicated' ? t('mediadc', 'Start') : t('mediadc', 'Restart') }}\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t\t<NcActionButton v-tooltip=\"{content: t('mediadc', 'Edit task params'), placement: 'left'}\"\n\t\t\t\t\t\t\t\t\ticon=\"icon-rename\"\n\t\t\t\t\t\t\t\t\t:close-after-click=\"true\"\n\t\t\t\t\t\t\t\t\t@click=\"openEditTaskDialog(task)\">\n\t\t\t\t\t\t\t\t\t{{ t('mediadc', 'Edit') }}\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t\t<NcActionButton v-tooltip=\"{content: t('mediadc', 'Terminate task execution'), placement: 'left'}\"\n\t\t\t\t\t\t\t\t\ticon=\"icon-pause\"\n\t\t\t\t\t\t\t\t\t:close-after-click=\"true\"\n\t\t\t\t\t\t\t\t\t@click=\"_terminateTask(task)\">\n\t\t\t\t\t\t\t\t\t{{ t('mediadc', 'Stop') }}\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t\t<NcActionButton v-if=\"getStatusBadge(task) === 'finished'\"\n\t\t\t\t\t\t\t\t\tv-tooltip=\"{ content: t('mediadc', 'Export task results'), placement: 'left' }\"\n\t\t\t\t\t\t\t\t\t:close-after-click=\"true\"\n\t\t\t\t\t\t\t\t\t@click=\"openExportResultsDialog(task)\">\n\t\t\t\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t\t\t\t\t{{ t('mediadc', 'Export') }}\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<FileExportOutline :size=\"18\" />\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t\t<NcActionButton v-tooltip=\"{content: t('mediadc', 'Delete task'), placement: 'left'}\"\n\t\t\t\t\t\t\t\t\ticon=\"icon-delete\"\n\t\t\t\t\t\t\t\t\t:close-after-click=\"true\"\n\t\t\t\t\t\t\t\t\t@click=\"deleteTask(task)\">\n\t\t\t\t\t\t\t\t\t{{ t('mediadc', 'Delete task') }}\n\t\t\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t\t</NcActions>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<NcProgressBar :value=\"Math.round((task.files_scanned / task.files_total) * 100)\"\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t:error=\"getStatusBadge(task) === 'error'\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"task-info\">\n\t\t\t\t\t\t<h3>{{ t('mediadc', 'Target directories') }}</h3>\n\t\t\t\t\t\t<div class=\"target-directories-list\">\n\t\t\t\t\t\t\t<div v-for=\"dir in taskInfo.target_directories\"\n\t\t\t\t\t\t\t\t:key=\"dir.fileid\"\n\t\t\t\t\t\t\t\tv-tooltip=\"{content: getDirOwnerToolip(dir), placement: 'bottom'}\"\n\t\t\t\t\t\t\t\tclass=\"target-directory-row\">\n\t\t\t\t\t\t\t\t<a :href=\"filesDirLink(dir)\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t<b>\n\t\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\t\tdir.filepath.replace(`/${dir.fileowner}/files`, '').replace(`/${currentUser}/files`, '') !== ''\n\t\t\t\t\t\t\t\t\t\t\t\t? dir.filepath.replace(`/${dir.fileowner}/files`, '').replace(`/${currentUser}/files`, '')\n\t\t\t\t\t\t\t\t\t\t\t\t: '/'\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t</b>\n\t\t\t\t\t\t\t\t\t({{ !dir.hasignoreflag ? formatBytes(dir.filesize) : t('mediadc', 'Ignored') }})\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Transition>\n\t\t\t<Transition name=\"fade\" appear>\n\t\t\t\t<div v-if=\"isValidUser\" class=\"details-row\">\n\t\t\t\t\t<DetailsList v-if=\"getStatusBadge(task) === 'finished'\" />\n\t\t\t\t</div>\n\t\t\t\t<div v-else>\n\t\t\t\t\t<p style=\"text-align: center;\">\n\t\t\t\t\t\t<b>{{ t('mediadc', 'You are not allowed to manage other user\\'s tasks.') }}</b>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</Transition>\n\t\t\t<div v-if=\"hasErrors\" class=\"errors\">\n\t\t\t\t<div class=\"errors-heading\" style=\"display: flex; align-items: center;\">\n\t\t\t\t\t<h3>{{ t('mediadc', 'Task errors' ) }}</h3>\n\t\t\t\t\t<NcButton v-tooltip=\"t('mediadc', 'Copy to clipboard')\"\n\t\t\t\t\t\ttype=\"tertiary-no-background\"\n\t\t\t\t\t\t:aria-label=\"t('mediadc', 'Copy to clipboard')\"\n\t\t\t\t\t\tstyle=\"margin: 0 10px;\"\n\t\t\t\t\t\t@click=\"copyErrorsToClipboard\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<ContentCopy :size=\"20\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t</div>\n\t\t\t\t<div v-for=\"error in task.errors.split('\\\\n')\" :key=\"error\" class=\"error-row\">\n\t\t\t\t\t{{ error }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport { showSuccess, showError, showWarning, showMessage } from '@nextcloud/dialogs'\nimport { generateUrl } from '@nextcloud/router'\nimport { mapActions, mapGetters } from 'vuex'\n\nimport DetailsList from '../components/details/DetailsList.vue'\nimport Formats from '../mixins/Formats.js'\nimport TasksEdit from '../components/tasks/TasksEdit.vue'\nimport DetailsExport from '../components/details/DetailsExport.vue'\n\nimport NcActions from '@nextcloud/vue/dist/Components/NcActions.js'\nimport NcActionButton from '@nextcloud/vue/dist/Components/NcActionButton.js'\nimport NcProgressBar from '@nextcloud/vue/dist/Components/NcProgressBar.js'\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport ContentCopy from 'vue-material-design-icons/ContentCopy.vue'\nimport FileExportOutline from 'vue-material-design-icons/FileExportOutline.vue'\n\nexport default {\n\tname: 'CollectorDetails',\n\tcomponents: {\n\t\tDetailsList,\n\t\tTasksEdit,\n\t\tDetailsExport,\n\t\tNcActions,\n\t\tNcActionButton,\n\t\tNcProgressBar,\n\t\tNcButton,\n\t\tContentCopy,\n\t\tFileExportOutline,\n\t},\n\tmixins: [Formats],\n\tprops: {\n\t\trootTitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\ttasksUpdater: null,\n\t\t\tcollapsedStatus: false,\n\t\t\teditingTask: false,\n\t\t\texporting: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\t...mapGetters([\n\t\t\t'task',\n\t\t\t'taskInfo',\n\t\t\t'details',\n\t\t\t'settingByName',\n\t\t]),\n\t\tisValidUser() {\n\t\t\treturn getCurrentUser().uid === this.task?.owner\n\t\t},\n\t\tcurrentUser() {\n\t\t\treturn getCurrentUser().uid\n\t\t},\n\t\thasErrors() {\n\t\t\treturn this.task?.errors?.length > 0\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tthis.$emit('update:loading', true)\n\t\tthis.tasksUpdater = setInterval(this._getTaskDetails, 3000)\n\t\tthis.getTaskDetails().then((res) => {\n\t\t\tif (this.getStatusBadge(res.data.collectorTask) === 'finished' || this.getStatusBadge(res.data.collectorTask) === 'duplicated') {\n\t\t\t\tclearInterval(this.tasksUpdater)\n\t\t\t}\n\t\t\tthis.$emit('update:loading', false)\n\t\t})\n\t\tthis.getTaskInfo()\n\t\tsubscribe('restartTask', this.onRestartTaskEvent)\n\t\tsubscribe('updateTaskInfo', this.getDetailFilesTotalSize)\n\t},\n\tbeforeDestroy() {\n\t\tclearInterval(this.tasksUpdater)\n\t\tunsubscribe('updateTaskInfo', this.getDetailFilesTotalSize)\n\t\tunsubscribe('restartTask', this.onRestartTaskEvent)\n\t\tthis.$store.commit('setTask', {})\n\t\tthis.$store.commit('setTaskInfo', { exclude_directories: [], target_directories: [] })\n\t\tthis.$store.commit('setDetails', [])\n\t\tthis.$store.commit('setDetailsInfo', { filestotal: 0, filessize: 0 })\n\t},\n\tmethods: {\n\t\t...mapActions([\n\t\t\t'getTaskDetails',\n\t\t\t'getTaskInfo',\n\t\t\t'getDetailFilesTotalSize',\n\t\t\t'terminateTask',\n\t\t\t'getSettings',\n\t\t]),\n\t\t_terminateTask(task) {\n\t\t\tif (this.isValidUser) {\n\t\t\t\tthis.terminateTask(task).then(() => {\n\t\t\t\t\tshowSuccess(this.t('mediadc', 'Task terminated'))\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'You are not allowed to terminate this task'))\n\t\t\t}\n\t\t},\n\t\t_getTaskDetails() {\n\t\t\tthis.getTaskDetails().then(res => {\n\t\t\t\tif (this.getStatusBadge(res.data.collectorTask) === 'finished' || this.getStatusBadge(res.data.collectorTask) === 'terminated' || this.getStatusBadge(res.data.collectorTask) === 'error') {\n\t\t\t\t\tclearInterval(this.tasksUpdater)\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\trestartTask(task) {\n\t\t\tif (this.isValidUser) {\n\t\t\t\tclearInterval(this.tasksUpdater)\n\t\t\t\tthis.getSettings().then(() => {\n\t\t\t\t\taxios.post(generateUrl('/apps/mediadc/api/v1/tasks/restart'), {\n\t\t\t\t\t\ttaskId: task.id,\n\t\t\t\t\t\ttargetDirectoryIds: task.target_directory_ids,\n\t\t\t\t\t\texcludeList: {\n\t\t\t\t\t\t\tuser: JSON.parse(task.exclude_list).user,\n\t\t\t\t\t\t\tadmin: JSON.parse(this.settingByName('exclude_list').value),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcollectorSettings: {\n\t\t\t\t\t\t\thashing_algorithm: JSON.parse(this.settingByName('hashing_algorithm').value) || 'dhash',\n\t\t\t\t\t\t\tsimilarity_threshold: Number(JSON.parse(this.task.collector_settings).similarity_threshold),\n\t\t\t\t\t\t\thash_size: Number(this.settingByName('hash_size').value) || 16,\n\t\t\t\t\t\t\ttarget_mtype: Number(JSON.parse(this.task.collector_settings).target_mtype),\n\t\t\t\t\t\t\tfinish_notification: JSON.parse(this.task.collector_settings).finish_notification,\n\t\t\t\t\t\t\texif_transpose: !this.settingByName('ignore_orientation').value || true,\n\t\t\t\t\t\t},\n\t\t\t\t\t}).then(res => {\n\t\t\t\t\t\tif (res.data.success) {\n\t\t\t\t\t\t\tthis.getTaskDetails()\n\t\t\t\t\t\t\tthis.$store.commit('setDetailsInfo', { filestotal: 0, filessize: 0 })\n\t\t\t\t\t\t\tthis.tasksUpdater = setInterval(this._getTaskDetails, 3000)\n\t\t\t\t\t\t\tshowSuccess(this.t('mediadc', 'Task successfully restarted with previous settings!'))\n\t\t\t\t\t\t} else if (res.data.limit) {\n\t\t\t\t\t\t\tshowWarning(this.t('mediadc', 'Running tasks limit exceed. Try again later.'))\n\t\t\t\t\t\t} else if (res.data.empty) {\n\t\t\t\t\t\t\tshowWarning(this.n('mediadc', 'Target folder has no files or all of them excluded', 'Target folders have no files or all of them excluded', task.target_directory_ids.length))\n\t\t\t\t\t\t} else if (res.data.php_exec_not_enabled) {\n\t\t\t\t\t\t\tshowError(t('mediadc', 'Task run error: PHP `exec` function is not enabled'))\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tshowWarning(this.t('medaidc', 'Some error occurred while running Collector Task. Try again.'))\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(err => {\n\t\t\t\t\t\tconsole.debug(err)\n\t\t\t\t\t\tshowError('Some error occurred while running Collector Task. Try again.')\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'You are not allowed to restart this task'))\n\t\t\t}\n\t\t},\n\t\tdeleteTask(task) {\n\t\t\tif (this.isValidUser) {\n\t\t\t\tconst self = this\n\t\t\t\tOC.dialogs.confirm(this.t('mediadc', 'Are sure you want to delete this task?'),\n\t\t\t\t\tthis.t('mediadc', 'Confirm task deletion'),\n\t\t\t\t\tfunction(success) {\n\t\t\t\t\t\tif (success) {\n\t\t\t\t\t\t\tself.$store.dispatch('deleteTask', task).then(() => {\n\t\t\t\t\t\t\t\tself.$router.push({ name: 'collector' })\n\t\t\t\t\t\t\t\tshowSuccess(self.t('mediadc', 'Task successfully deleted'))\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tshowWarning(this.t('mediadc', 'You are not allowed to delete this task'))\n\t\t\t}\n\t\t},\n\t\tcollapseTaskStatus() {\n\t\t\tthis.collapsedStatus = !this.collapsedStatus\n\t\t},\n\t\topenEditTaskDialog() {\n\t\t\tthis.editingTask = true\n\t\t},\n\t\topenExportResultsDialog(task) {\n\t\t\tif (this.getStatusBadge(task) === 'finished' && this.details.length > 0) {\n\t\t\t\tthis.exporting = true\n\t\t\t} else {\n\t\t\t\tshowMessage(this.t('mediadc', 'No results to export'))\n\t\t\t}\n\t\t},\n\t\tfilesDirLink(dir) {\n\t\t\tif (dir) {\n\t\t\t\tconst path = dir.filepath.replace(`/${dir.fileowner}/files`, '').replace(`/${this.currentUser}/files`, '') !== ''\n\t\t\t\t\t? dir.filepath.replace(`/${dir.fileowner}/files`, '').replace(`/${this.currentUser}/files`, '')\n\t\t\t\t\t: '/'\n\t\t\t\treturn generateUrl(`/apps/files?dir=${path}`)\n\t\t\t}\n\t\t\treturn '#'\n\t\t},\n\t\tonRestartTaskEvent() {\n\t\t\tthis.getTaskInfo()\n\t\t\tthis.getTaskDetails()\n\t\t\tthis.$store.commit('setDetailsInfo', { filestotal: 0, filessize: 0 })\n\t\t\tclearInterval(this.tasksUpdater)\n\t\t\tthis.tasksUpdater = setInterval(this._getTaskDetails, 3000)\n\t\t},\n\t\tgetDirOwnerToolip(dir) {\n\t\t\treturn `${this.t('mediadc', 'Owner:')} ${dir.fileowner}`\n\t\t},\n\t\tcopyErrorsToClipboard() {\n\t\t\tnavigator.clipboard.writeText(JSON.stringify(Object.assign(this.task.errors.split('\\\\n')), null, 2))\n\t\t\tshowSuccess(this.t('mediadc', 'Copied to clipboard'))\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n.fade-enter-active,\n.fade-leave-active {\n\ttransition: opacity 0.5s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n\topacity: 0;\n}\n\n.container {\n\tpadding: 0 20px;\n\twidth: 100%;\n\tmax-width: 1440px;\n\tmargin: 0 auto;\n\tmax-height: 100%;\n}\n\n@media (min-width: 1920px) {\n\t.container {\n\t\tmax-width: 80vw;\n\t}\n}\n\nh2 {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\tmargin: 20px auto 10px;\n\ttext-align: center;\n\tfont-size: 24px;\n}\n\n.task-details-heading p {\n\ttext-align: center;\n\tfont-size: 15px;\n}\n\n.details-row {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin: 0 10px 20px;\n\tposition: relative;\n}\n\n@media (max-width: 767px) {\n\t.details-row {\n\t\tflex-wrap: wrap;\n\t}\n\t.task-details-heading {\n\t\tflex-direction: column;\n\t}\n}\n\n.task-status-row {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-wrap: wrap;\n}\n\n.task-status-wrapper {\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: 16px;\n\toverflow: hidden;\n}\n\n.task-status-wrapper progress {\n\tmargin-top: 5px;\n}\n\n.task-status {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tpadding: 10px\n}\n\n.task-info {\n\tmargin: 20px 0;\n\tborder: 1px solid var(--color-border-dark);\n\tborder-radius: var(--border-radius-large);\n\tpadding: 10px 20px;\n\theight: 100%;\n\tmin-height: 105px;\n\tmax-height: 105px;\n\tmax-width: 50%;\n\toverflow-y: scroll;\n}\n\n@media (max-width: 767px) {\n\t.details-row {\n\t\tmargin: 0 0 20px;\n\t}\n\n\t.task-status {\n\t\tflex-direction: column;\n\t\twidth: 100%;\n\t}\n\n\t.task-info {\n\t\tmax-width: 100%;\n\t\tmargin: 0;\n\t}\n}\n\n.task-info h3 {\n\tmargin: 0 0 5px 0;\n\tfont-weight: bold;\n}\n\n.target-directory-row {\n\twhite-space: nowrap;\n\tpadding: 7px 0;\n}\n\n@media (max-width: 540px) {\n\t.task-status-row {\n\t\tflex-direction: column;\n\t\tmargin: 20px 0;\n\t}\n\n\t.badge {\n\t\tmargin-right: 0;\n\t\tmargin-top: 10px;\n\t\tmargin-bottom: 10px;\n\t}\n}\n</style>\n"],sourceRoot:""}]);const o=l},670:(t,e,i)=>{i.d(e,{A:()=>a});var n=i(53357),s=i(6584);const a=(0,i(14486).A)(s.A,n.X,n.Y,!1,null,null,null).exports},55219:(t,e,i)=>{i.d(e,{A:()=>n});const n={name:"ContentCopyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}}},60017:(t,e,i)=>{i.d(e,{A:()=>a});var n=i(81745),s=i(45519);const a=(0,i(14486).A)(s.A,n.X,n.Y,!1,null,null,null).exports},84440:(t,e,i)=>{i.d(e,{A:()=>n});const n={name:"PlusThickIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}}},74890:(e,i,n)=>{n.r(i),n.d(i,{default:()=>xt});var s=n(65043),a=n(21777),l=n(61338),o=n(85168),r=n(63814),d=n(95353),c=n(76333);const p={name:"MinusBoxOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var h=n(14486);const u=(0,h.A)(p,(function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon minus-box-outline-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M19,19V5H5V19H19M19,3A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V5C3,3.89 3.9,3 5,3H19M17,11V13H7V11H17Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])}),[],!1,null,null,null).exports;const g={name:"CheckAllIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};const m=(0,h.A)(g,(function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon check-all-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M0.41,13.41L6,19L7.41,17.58L1.83,12M22.24,5.58L11.66,16.17L7.5,12L6.07,13.41L11.66,19L23.66,7M18,7L16.59,5.58L10.24,11.93L11.66,13.34L18,7Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])}),[],!1,null,null,null).exports;const f={name:"CheckUnderlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};const A=(0,h.A)(f,(function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon check-underline-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M21,5L9,17L3.5,11.5L4.91,10.09L9,14.17L19.59,3.59L21,5M3,21V19H21V21H3Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])}),[],!1,null,null,null).exports;var k=n(56920);const v={name:"DetailsFile",components:{NcButton:c.x1,NcCheckboxRadioSwitch:c.AO},mixins:[k.A],props:{file:{type:Object,required:!0},files:{type:Array,required:!0},allFiles:{type:Array,required:!0},checkedFiles:{type:Array,required:!0},detail:{type:Object,required:!0}},data:()=>({loaded:!1,checked:!1,updating:!1}),computed:{...(0,d.L8)(["detailsGridSize","deleteFileConfirmation","showFullFilePath","details"]),imageUrl(){return this.file.has_preview?(0,r.Jv)(`/core/preview?fileId=${this.file.fileid}&x=${this.detailsGridSize}&y=${this.detailsGridSize}$forceIcon=0`):(0,r.dC)(`dav/files${this.file.filepath.replace("files/","")}`)}},watch:{checked(){const t=this.checkedFiles,e=t.findIndex((t=>t.fileid===this.file.fileid));this.checked?-1===e&&t.push(this.file):-1!==e&&t.splice(e,1),this.$emit("update:checkedFiles",t)},checkedFiles(){const t=this.checkedFiles.findIndex((t=>t.fileid===this.file.fileid));this.checked||-1===t||(this.checked=!0)}},beforeMount(){const t=this.checkedFiles.findIndex((t=>t.fileid===this.file.fileid));this.checked=-1!==t,(0,l.B1)("deselectFiles",this.deselect)},beforeDestroy(){(0,l.al)("deselectFiles",this.deselect)},methods:{openFile(t){const e=this.files.map((t=>({basename:t.filename,fileid:t.fileid,filename:t.filepath.replace(`/${(0,a.HW)().uid}/files`,"").replace("files/","/"),getcontentlength:t.filesize,getcontenttype:t.filemtype,mime:t.filemtype,size:t.filesize})));OCA.Viewer.open({path:t.filepath.replace(`/${(0,a.HW)().uid}/files`,"").replace("files/","/"),list:e.map((t=>({...t,list:e})))})},onLoad(){this.loaded=!0},deleteGroupFile(t){if(this.deleteFileConfirmation){const e=this;OC.dialogs.confirm(this.t("mediadc","Are you sure you want to delete this file?"),this.t("mediadc","Confirm file deletion"),(function(i){i&&e._deleteGroupFile(t)}))}else this._deleteGroupFile(t)},_deleteGroupFile(t){this.updating=!0,s.Ay.delete((0,r.Jv)(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.group_id}/${t.fileid}`)).then((e=>{if(e.data.success){const i=this.files;2===this.allFiles.length&&((0,l.Ic)("openNextDetailGroup",this.detail),this.$store.commit("deleteDetail",this.detail),(0,o.rG)(this.t("mediadc","Group successfully removed (1 file left)")));const n=i.findIndex((e=>e.fileid===t.fileid));i.splice(n,1);const s=this.checkedFiles.findIndex((e=>e.fileid===t.fileid));if(this.checked&&-1!==s){const t=this.checkedFiles;t.splice(s,1),this.$emit("update:checkedFiles",t)}this.$emit("update:files",i),(0,l.Ic)("updateTaskInfo"),this.$store.commit("setTask",e.data.task),(0,l.Ic)("updateGroupFilesPagination",this.file)}else"locked"in e.data&&e.data.locked?(0,o.I9)(this.t("mediadc","Wait until file has been loaded before deleting it")):"not_permitted"in e.data&&e.data.not_permited?(0,o.Qg)(this.t("mediadc","Not enough permissions to delete the file")):"not_found"in e.data&&e.data.not_found?(0,o.Qg)(this.t("mediadc","File not found. Probably it's has been already deleted")):(0,o.Qg)(this.t("mediadc","An error occurred while deleting the file"));this.updating=!1})).catch((t=>{console.debug(t),(0,o.Qg)(this.t("mediadc","An error occurred while deleting the file")),this.updating=!1}))},removeGroupFile(t){this.updating=!0,s.Ay.post((0,r.Jv)(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.group_id}/remove`),{fileIds:[t.fileid]}).then((e=>{if(e.data.success){const e=this.files;2===this.allFiles.length&&((0,l.Ic)("openNextDetailGroup",this.detail),this.$store.commit("deleteDetail",this.detail),(0,o.rG)(this.t("mediadc","Group successfully removed (1 file left)")));const i=e.findIndex((e=>e.fileid===t.fileid));e.splice(i,1);const n=this.checkedFiles.findIndex((e=>e.fileid===t.fileid));if(this.checked&&-1!==n){const t=this.checkedFiles;t.splice(n,1),this.$emit("update:checkedFiles",t)}this.$emit("update:files",e),(0,l.Ic)("updateTaskInfo"),(0,l.Ic)("updateGroupFilesPagination",this.file),this.updating=!1}})).catch((t=>{console.debug(t),(0,o.Qg)(this.t("mediadc","A server error occurred")),this.updating=!1}))},deselect(t){this.checked&&t.map((t=>t.fileid)).includes(this.file.fileid)&&(this.checked=!1)}}},x=v;var y=n(85072),C=n.n(y),b=n(97825),_=n.n(b),w=n(77659),F=n.n(w),I=n(55056),D=n.n(I),N=n(10540),T=n.n(N),P=n(41113),B=n.n(P),G=n(5283),S={};S.styleTagTransform=B(),S.setAttributes=D(),S.insert=F().bind(null,"head"),S.domAPI=_(),S.insertStyleElement=T();C()(G.A,S);G.A&&G.A.locals&&G.A.locals;const E={name:"DetailsGroupList",components:{DetailsFile:(0,h.A)(x,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"file",class:{"icon-loading":t.updating},style:"width: "+t.detailsGridSize+"px;"},[t.updating?e("div",{staticClass:"updating-blackout"}):t._e(),t._v(" "),e("div",{staticClass:"file-thumb",on:{click:function(e){return t.openFile(t.file)}}},["image"===t.file.filempart||"video"===t.file.filempart&&t.file.has_preview?e("div",{directives:[{name:"show",rawName:"v-show",value:t.loaded,expression:"loaded"}],staticClass:"file-thumb-loaded"},[e("img",{directives:[{name:"show",rawName:"v-show",value:t.loaded,expression:"loaded"}],key:t.file.filepath,attrs:{src:t.imageUrl,alt:t.file.filename,title:t.file.filepath},on:{load:t.onLoad}})]):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.loaded&&"video"===t.file.filempart,expression:"!loaded && file.filempart === 'video'"}],staticClass:"placeholder",style:"min-height: "+t.detailsGridSize+"px",attrs:{title:t.file.filepath}},[e("svg",{attrs:{width:"50%",height:"50%",version:"1.1",viewBox:"-31 0 512 512",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"m440.59 206.68h-341.17l327.7-94.93c2.5469-0.73828 4.6953-2.4609 5.9766-4.7812 1.2812-2.3242 1.5859-5.0586 0.84766-7.6055l-17.148-59.199c-6.8516-23.645-28.867-40.16-53.539-40.16-5.1992 0-10.379 0.73828-15.402 2.1914l-307.68 89.129c-14.23 4.1211-26.023 13.582-33.215 26.633-7.1875 13.051-8.875 28.078-4.7539 42.305l16.754 57.836v238.25c0 30.688 24.965 55.652 55.648 55.652h120.16c5.5234 0 10-4.4766 10-10s-4.4766-10-10-10h-120.16c-19.66 0-35.652-15.992-35.652-35.652v-136.09h391.63v136.09c2.1e-4 19.66-15.992 35.652-35.652 35.652h-120.16c-5.5195 0-10 4.4766-10 10s4.4805 10 10 10h120.16c30.688 0 55.652-24.965 55.652-55.652v-239.67c0-5.5234-4.4766-10-10-10zm-176.33 93.586 42.488-73.586h55.262l-42.484 73.586zm-78.359 0 42.488-73.586h55.262l-42.484 73.586zm-78.355 0 42.484-73.586h55.266l-42.488 73.586zm37.18-129.46-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543l71.148 68.336-53.309 15.441c-0.375-0.54688-0.81641-1.0664-1.3125-1.543zm134-125.84 71.148 68.336-53.309 15.441c-0.375-0.54688-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.375 0.54688 0.8125 1.0625 1.3125 1.543zm-75.266 21.805 71.148 68.332-53.309 15.445c-0.375-0.54687-0.8125-1.0664-1.3125-1.543l-71.148-68.336 53.309-15.441c0.37891 0.54297 0.81641 1.0625 1.3125 1.543zm149.96-45.367c3.2109-0.92969 6.5195-1.4023 9.8359-1.4023 15.824 0 29.938 10.578 34.328 25.727l14.367 49.59-40.121 11.621c-0.3789-0.54688-0.8164-1.0625-1.3164-1.543l-71.145-68.332zm-328.94 106.2c4.6094-8.3711 12.16-14.434 21.262-17.07l5.875-1.7031c0.37891 0.54688 0.81641 1.0664 1.3125 1.543l71.148 68.336-88.293 25.578-14.367-49.59c-2.6367-9.0976-1.5469-18.719 3.0625-27.094zm14.48 99.074h87.973l-42.484 73.586h-45.488zm303.66 73.586 42.484-73.586h45.488v73.586z"}}),t._v(" "),e("path",{attrs:{d:"m303.92 405.11c0-3.5742-1.9062-6.875-5-8.6602l-87.855-50.723c-3.0938-1.7852-6.9062-1.7852-10 0-3.0938 1.7852-5 5.0859-5 8.6602v101.45c0 3.5703 1.9062 6.8711 5 8.6562 1.5469 0.89453 3.2734 1.3438 5 1.3438 1.7266 0 3.4531-0.44922 5-1.3438l87.855-50.719c3.0938-1.7852 5-5.0859 5-8.6602zm-87.855 33.402v-66.805l57.855 33.402z"}}),t._v(" "),e("path",{attrs:{d:"m234.77 492c-5.5078 0-10 4.4922-10 10s4.4922 10 10 10c5.5117 0 10-4.4922 10-10s-4.4883-10-10-10z"}})])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.loaded&&"image"===t.file.filempart,expression:"!loaded && file.filempart === 'image'"}],staticClass:"placeholder",style:"min-height: "+t.detailsGridSize+"px",attrs:{title:t.file.filepath}},[e("svg",{attrs:{width:"50%","enable-background":"new 0 0 512 512",version:"1.1",viewBox:"0 0 512 512","xml:space":"preserve",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"m446.58 0h-381.15c-36.076 0-65.425 29.35-65.425 65.426v381.15c0 36.075 29.349 65.425 65.425 65.425h381.15c36.076 0 65.425-29.35 65.425-65.426v-381.15c0-36.076-29.349-65.426-65.425-65.426zm35.267 446.58c0 19.447-15.821 35.267-35.267 35.267h-381.15c-19.447 0-35.268-15.821-35.268-35.267v-55.007l99.255-84.451c3.622-3.082 8.906-3.111 12.562-0.075l62.174 51.628c5.995 4.977 14.795 4.569 20.304-0.946l147.73-147.95c2.67-2.675 5.783-2.935 7.408-2.852 1.62 0.083 4.695 0.661 7.078 3.596l95.176 117.19v118.87zm0-166.71-71.766-88.366c-7.117-8.764-17.666-14.122-28.942-14.701-11.268-0.57-22.317 3.672-30.294 11.662l-138.01 138.22-51.59-42.839c-14.959-12.422-36.563-12.293-51.373 0.308l-79.712 67.822v-286.55c0-19.447 15.821-35.268 35.268-35.268h381.15c19.447 0 35.267 15.821 35.267 35.268v214.44z"}}),t._v(" "),e("path",{attrs:{d:"m161.17 62.995c-40.095 0-72.713 32.62-72.713 72.713 0 40.094 32.619 72.713 72.713 72.713s72.713-32.619 72.713-72.713-32.618-72.713-72.713-72.713zm0 115.27c-23.466 0-42.556-19.091-42.556-42.556 0-23.466 19.09-42.556 42.556-42.556s42.556 19.091 42.556 42.556-19.09 42.556-42.556 42.556z"}})])])]),t._v(" "),e("div",{staticClass:"file-info"},[e("span",{class:{filename:!t.showFullFilePath,filepath:t.showFullFilePath},attrs:{title:t.file.filepath}},[t._v(t._s(t.showFullFilePath?t.file.filepath:t.file.filename))]),t._v(" "),e("span",{staticClass:"owner"},[t._v(t._s(t.file.fileowner))]),t._v(" "),e("span",{staticClass:"size",attrs:{title:t.file.filesize+" B"}},[t._v(t._s(t.formatBytes(Number(t.file.filesize))))]),t._v(" "),e("div",{staticClass:"actions",staticStyle:{display:"flex"}},[e("NcCheckboxRadioSwitch",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Select file"),placement:"top"},expression:"{ content: t('mediadc', 'Select file'), placement: 'top' }"}],staticClass:"mediadc-checkbox-only",attrs:{checked:t.checked},on:{"update:checked":function(e){t.checked=e}}}),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Delete file"),placement:"top"},expression:"{ content: t('mediadc', 'Delete file'), placement: 'top' }"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Delete file")},on:{click:function(e){return t.deleteGroupFile(t.file)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-delete"})]},proxy:!0}])}),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Remove file (mark resolved)"),placement:"top"},expression:"{ content: t('mediadc', 'Remove file (mark resolved)'), placement: 'top' }"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Remove file (mark resolved)")},on:{click:function(e){return t.removeGroupFile(t.file)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-close"})]},proxy:!0}])})],1)])])}),[],!1,null,"4d8158fc",null).exports,NcActions:c.B6,NcActionButton:c.Ko,NcButton:c.x1},mixins:[k.A],props:{files:{type:Array,required:!0,default:()=>[]},allFiles:{type:Array,required:!0,default:()=>[]},detail:{type:Object,required:!0},loadingFiles:{type:Boolean,required:!0},updating:{type:Boolean,required:!0},filesAscending:{type:Boolean,required:!0}},data:()=>({checkedFiles:[],batchActionsOpened:!1,filesFiltered:!1,filterFileName:"",filteredFiles:[]}),computed:{...(0,d.L8)(["detailsGridSize","groupItemsPerPage","details"]),checkedFilesIntersect(){const t=new Set(this.files),e=new Set(this.checkedFiles),i=new Set([...t].filter((t=>e.has(t))));return Array.from(i)}},watch:{files(){this.filterByFileName()}},methods:{openBatchActionsPopup(){document.addEventListener("click",this.toggleBatchActionsPopup)},toggleBatchActionsPopup(){this.batchActionsOpened&&document.removeEventListener("click",this.toggleBatchActionsPopup),this.batchActionsOpened=!this.batchActionsOpened},selectAllFiles(){if(this.checkedFiles.length===this.allFiles.length){(0,l.Ic)("deselectFiles",this.checkedFiles);for(const t of this.allFiles){const e=this.checkedFiles.findIndex((e=>e.fileid===t.fileid));-1!==e&&this.checkedFiles.splice(e,1)}}else for(const t of this.allFiles){-1===this.checkedFiles.findIndex((e=>e.fileid===t.fileid))&&this.checkedFiles.push(t)}},selectAllFilesOnPage(){if(this.files.length===this.checkedFilesIntersect.length){const t=this.checkedFilesIntersect;(0,l.Ic)("deselectFiles",t);for(const e of t.map((t=>t.fileid))){const t=this.checkedFiles.findIndex((t=>t.fileid===e));-1!==t&&this.checkedFiles.splice(t,1)}}else for(const t of this.files){-1===this.checkedFiles.findIndex((e=>e.fileid===t.fileid))&&this.checkedFiles.push(t)}},removeCheckedFiles(){this.$emit("update:updating",!0),s.Ay.post((0,r.Jv)(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.group_id}/remove`),{fileIds:this.checkedFiles.map((t=>t.fileid))}).then((t=>{if(t.data.success){const e=this.allFiles;this.allFiles.length-this.checkedFiles.length<=1&&((0,l.Ic)("openNextDetailGroup",this.detail),this.$store.commit("deleteDetail",this.detail),this.allFiles.length-this.checkedFiles.length==1&&(0,o.rG)(this.t("mediadc","Group successfully removed (1 file left)")));for(const i of t.data.removedFileIds){const t=e.findIndex((t=>t.fileid===i));e.splice(t,1);const n=this.checkedFiles.findIndex((t=>t.fileid===i));-1!==n&&this.checkedFiles.splice(n,1)}(0,l.Ic)("updateTaskInfo"),this.$emit("update:allFiles",e),(0,l.Ic)("updateGroupFilesPagination"),this.$emit("update:updating",!1),(0,o.Te)(this.t("mediadc","Checked files successfully removed"))}})).catch((t=>{console.debug(t),(0,o.Qg)(this.t("mediadc","A server error occurred")),this.$emit("update:updating",!1)}))},deleteCheckedFiles(){this.allFiles.length===this.checkedFiles.length?confirm(this.t("mediadc","Are you sure you want to delete all files"))&&this._deleteCheckedFiles():this._deleteCheckedFiles()},_deleteCheckedFiles(){this.$emit("update:updating",!0),s.Ay.post((0,r.Jv)(`/apps/mediadc/api/v1/tasks/${this.detail.task_id}/files/${this.detail.group_id}/delete`),{fileIds:this.checkedFiles.map((t=>t.fileid))}).then((t=>{t.data.success?(this._updateDeletedFiles(t),this.$store.commit("setTask",t.data.task)):!t.data.success&&t.data.deletedFileIds.length>0?((0,o.I9)(this.t("mediadc","Not all files deleted")),this._updateDeletedFiles(t)):(console.debug(t.data.errors),(0,o.Qg)(this.t("mediadc","A server error occurred. Files not deleted")),this.$emit("update:updating",!1))})).catch((t=>{console.debug(t),(0,o.Qg)(this.t("mediadc","A server error occurred")),this.$emit("update:updating",!1)}))},_updateDeletedFiles(t){const e=this.allFiles;this.allFiles.length-this.checkedFiles.length<=1&&t.data.deletedFileIds.length===this.checkedFiles.length&&((0,l.Ic)("openNextDetailGroup",this.detail),this.$store.commit("deleteDetail",this.detail),this.allFiles.length-this.checkedFiles.length==1&&(0,o.rG)(this.t("mediadc","Group successfully removed (1 file left)")));for(const i of t.data.deletedFileIds){const t=e.findIndex((t=>t.fileid===i));e.splice(t,1);const n=this.checkedFiles.findIndex((t=>t.fileid===i));-1!==n&&this.checkedFiles.splice(n,1)}(0,l.Ic)("updateTaskInfo"),this.$emit("update:allFiles",e),(0,l.Ic)("updateGroupFilesPagination"),this.$emit("update:updating",!1),(0,o.Te)(this.t("mediadc","Checked files successfully deleted"))},filterByFileName(){""!==this.filterFileName?(this.filesFiltered=!0,this.filteredFiles=this.files.filter((t=>t.filename.toLowerCase().includes(this.filterFileName.toLowerCase())))):(this.filesFiltered=!1,this.filteredFiles=[])},updateFileSorting(){this.$emit("update:filesAscending",!this.filesAscending)}}};var $=n(45326),R={};R.styleTagTransform=B(),R.setAttributes=D(),R.insert=F().bind(null,"head"),R.domAPI=_(),R.insertStyleElement=T();C()($.A,R);$.A&&$.A.locals&&$.A.locals;const L=(0,h.A)(E,(function(){var t=this,e=t._self._c;return t.loadingFiles?e("div",[e("span",{staticClass:"icon-loading",staticStyle:{width:"20px",height:"20px",display:"flex",margin:"20px auto"}})]):e("div",{staticClass:"details-group"},[e("div",{staticClass:"filters"},[e("div",{staticClass:"sorting"},[t._v("\n\t\t\t"+t._s(t.t("mediadc","Files size sorting"))+"\n\t\t\t"),e("NcButton",{staticStyle:{margin:"0 10px"},attrs:{type:"tertiary","aria-label":t.t("mediadc","Toggle files size sorting")},on:{click:t.updateFileSorting},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{class:t.filesAscending?"icon-triangle-s sorting-group-files-btn":"icon-triangle-n sorting-group-files-btn"})]},proxy:!0}],null,!1,1665595266)})],1),t._v(" "),e("div",{staticClass:"search"},[e("label",{attrs:{for:"filename-filter"}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","Filter by filename: "))+"\n\t\t\t\t"),e("input",{directives:[{name:"model",rawName:"v-model",value:t.filterFileName,expression:"filterFileName"}],attrs:{id:"filename-filter",type:"search",name:"filename-filter",placeholder:t.t("mediadc","Filename or part")},domProps:{value:t.filterFileName},on:{input:[function(e){e.target.composing||(t.filterFileName=e.target.value)},t.filterByFileName]}})])]),t._v(" "),t.checkedFiles.length>0?e("div",{staticClass:"batch-editing"},[t._v("\n\t\t\t"+t._s(t.n("mediadc","Batch actions for %n file","Batch actions for %n files",t.checkedFiles.length))+"\n\t\t\t"),e("NcActions",{staticStyle:{"margin-left":"5px"},attrs:{placement:"left"}},[e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Select all files in a group"),placement:"left"},expression:"{content: t('mediadc', 'Select all files in a group'), placement: 'left'}"}],attrs:{icon:"icon-checkmark"},on:{click:t.selectAllFiles}},[t._v("\n\t\t\t\t\t"+t._s(t.checkedFiles.length===t.allFiles.length?t.t("mediadc","Deselect all"):t.t("mediadc","Select all"))+"\n\t\t\t\t")]),t._v(" "),t.detail.files.length>t.groupItemsPerPage?e("NcActionButton",{attrs:{icon:"icon-checkmark"},on:{click:t.selectAllFilesOnPage}},[t._v("\n\t\t\t\t\t"+t._s(t.checkedFilesIntersect.length===t.files.length?t.t("mediadc","Deselect all on page"):t.t("mediadc","Select all on page"))+"\n\t\t\t\t")]):t._e(),t._v(" "),e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Mark as resolved without deleting"),placement:"left"},expression:"{content: t('mediadc', 'Mark as resolved without deleting'), placement: 'left'}"}],attrs:{icon:"icon-close"},on:{click:t.removeCheckedFiles}},[t._v("\n\t\t\t\t\t"+t._s(t.n("mediadc","Remove file","Remove files",t.checkedFiles.length))+"\n\t\t\t\t")]),t._v(" "),e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.n("mediadc","Delete selected file","Delete selected files",t.checkedFiles.length),placement:"left"},expression:"{content: n('mediadc', 'Delete selected file', 'Delete selected files', checkedFiles.length), placement: 'left'}"}],attrs:{icon:"icon-delete"},on:{click:t.deleteCheckedFiles}},[t._v("\n\t\t\t\t\t"+t._s(t.n("mediadc","Delete file","Delete files",t.checkedFiles.length))+"\n\t\t\t\t")])],1)],1):t._e()]),t._v(" "),t.filesFiltered?t.filteredFiles.length>0?e("div",{staticClass:"details-group-files"},t._l(t.filteredFiles,(function(i){return e("DetailsFile",{key:i.fileid,attrs:{file:i,files:t.files,"all-files":t.allFiles,"checked-files":t.checkedFiles,detail:t.detail},on:{"update:checkedFiles":function(e){t.checkedFiles=e},"update:checked-files":function(e){t.checkedFiles=e}}})})),1):e("div",{staticClass:"details-group-files"},[e("p",{staticStyle:{margin:"0 0 10px"}},[t._v("\n\t\t\t"+t._s(t.t("mediadc","No matches on this page"))+"\n\t\t")])]):e("div",{staticClass:"details-group-files"},t._l(t.files,(function(i){return e("DetailsFile",{key:i.fileid,attrs:{file:i,files:t.files,"all-files":t.allFiles,"checked-files":t.checkedFiles,detail:t.detail},on:{"update:checkedFiles":function(e){t.checkedFiles=e},"update:checked-files":function(e){t.checkedFiles=e}}})})),1)])}),[],!1,null,"3ed04696",null).exports,z={name:"DetailsListItem",components:{NcActions:c.B6,NcActionButton:c.Ko,NcButton:c.x1,NcCheckboxRadioSwitch:c.AO,DetailsGroupList:L},mixins:[k.A],props:{detail:{type:Object,required:!0},checkedDetailGroups:{type:Array,required:!0}},data:()=>({opened:!1,page:0,totalPages:0,loadingFiles:!1,files:[],allFiles:[],paginatedFiles:{},checked:!1,filesAscending:!1,updating:!1,goToPage:1}),computed:{...(0,d.L8)(["task","details","groupItemsPerPage","deleteFileConfirmation"]),groupFilesSize(){return 0===this.allFiles.length?this.detail.files.reduce(((t,e)=>t+Number(e.filesize)),0):this.allFiles.reduce(((t,e)=>t+Number(e.filesize)),0)},groupFilesTotal(){return 0===this.allFiles.length?this.detail.files.length:this.allFiles.length},pagesRange(){return Array.from({length:Math.ceil(this.detail.files.length/this.groupItemsPerPage)},((t,e)=>e))}},watch:{checked(){const t=this.checkedDetailGroups,e=t.findIndex((t=>t.group_id===this.detail.group_id));this.checked?-1===e&&t.push(this.detail):-1!==e&&t.splice(e,1),this.$emit("update:checkedDetailGroups",t)},filesAscending(){this.sortFiles(this.filesAscending)},checkedDetailGroups(){const t=this.checkedDetailGroups.findIndex((t=>t.group_id===this.detail.group_id));this.checked||-1===t||(this.checked=!0)},groupItemsPerPage(t){this.opened&&(this.page>=Math.ceil(this.detail.files.length/t)&&(this.page=Math.ceil(this.detail.files.length/t)-1),this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page],this.goToPage>=Math.ceil(this.detail.files.length/t)&&(this.goToPage=Math.ceil(this.detail.files.length/t)))},allFiles(t){this.page>=Math.ceil(t.length/this.groupItemsPerPage)&&(this.page=Math.ceil(t.length/this.groupItemsPerPage)-1,this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page])}},beforeMount(){const t=this.checkedDetailGroups.findIndex((t=>t.group_id===this.detail.group_id));this.checked=-1!==t,(0,l.B1)("updateGroupFilesPagination",this.updateFilesPagination),(0,l.B1)("deselectGroups",this.deselect),(0,l.B1)("openGroup",this.openGroup),(0,l.B1)("toggleGroup",this.toggleGroup)},beforeDestroy(){(0,l.al)("updateGroupFilesPagination",this.updateFilesPagination),(0,l.al)("deselectGroups",this.deselect),(0,l.al)("openGroup",this.openGroup),(0,l.al)("toggleGroup",this.toggleGroup)},methods:{openDetailFiles(t){if(this.opened)this.opened=!1;else if(void 0===this.files||0===this.files.length){const e=t.task_id,i=t.group_id;this.loadingFiles=!0,this.opened=!0,0===this.allFiles.length?this.loadAllFilesInfo(e,i):(this.files=this.paginatedFiles[this.page],this.loadingFiles=!1)}else this.opened=!0},openNextDetailFiles(t){this.page<Math.ceil(t.files.length/this.groupItemsPerPage)-1?(this.page+=1,this.files=this.paginatedFiles[this.page]):(0,o.I9)(this.t("mediadc","Last page reached!"))},openPrevDetailFiles(t){this.page>0?(this.page-=1,this.files=this.paginatedFiles[this.page]):(0,o.I9)(this.t("mediadc","First page reached!"))},loadAllFilesInfo(t,e){s.Ay.get((0,r.Jv)(`/apps/mediadc/api/v1/tasks/${t}/files/${e}/all`)).then((t=>{this.allFiles=t.data.files,this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page],this.loadingFiles=!1}))},paginateFiles(t){const e=[];for(let i=0;i<t.length;i++){const n=e[e.length-1];n&&n.length!==this.groupItemsPerPage?n.push(Object.freeze(t[i])):e.push([Object.freeze(t[i])])}return e},removeTaskDetail(t){if(this.deleteFileConfirmation){const e=this;OC.dialogs.confirm(this.t("mediadc","Are you sure you want to remove this group without deleting files?"),this.t("mediadc","Confirm group removal"),(function(i){i&&e._removeTaskDetail(t)}))}else this._removeTaskDetail(t)},_removeTaskDetail(t){this.updating=!0,s.Ay.delete((0,r.Jv)(`/apps/mediadc/api/v1/tasks/${t.task_id}/detail/${t.group_id}`)).then((e=>{if(e.data.success){(0,l.Ic)("openNextDetailGroup",this.detail);const e=[...this.details],i=e.findIndex((t=>t.group_id===this.detail.group_id));e.splice(i,1);const n=this.checkedDetailGroups.findIndex((e=>e.group_id===t.group_id)),s=[...this.checkedDetailGroups];this.checked&&-1!==n&&(s.splice(n,1),this.$emit("update:checkedDetailGroups",s)),(0,l.Ic)("updateTaskInfo"),this.$store.commit("setDetails",e),(0,o.Te)(this.t("mediadc","Duplicate group succesffully removed"));const a=this.checkedDetailGroups.findIndex((e=>e.group_id===t.group_id));if(-1!==a){const t=this.checkedDetailGroups;t.splice(a,1),this.$emit("update:checkedDetailGroups",t)}this.updating=!1}else(0,o.Qg)(this.t("mediadc","An error occurred while deleting duplicate group")),this.updating=!1})).catch((t=>{console.debug(t),(0,o.Qg)(this.t("mediadc","An error occurred while deleting duplicate group")),this.updating=!1}))},sortFiles(t){this.allFiles.sort(((e,i)=>t?e.filesize-i.filesize:i.filesize-e.filesize)),this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page]},updateFilesPagination(t){if(t){const e=this.allFiles.findIndex((e=>e.fileid===t.fileid));-1!==e&&this.allFiles.splice(e,1)}this.paginatedFiles=this.paginateFiles(this.allFiles),this.files=this.paginatedFiles[this.page]},deselect(t){this.checked&&t.includes(this.detail.group_id)&&(this.checked=!1)},openGroup(t){this.detail.group_id!==t.group_id||this.opened||(this.openDetailFiles(t),setTimeout((()=>{const e=document.getElementById(`detail-${t.task_id}-${t.group_id}`);e&&e.scrollIntoView({behavior:"smooth"})}),500))},toggleGroup(t){this.detail.group_id===t.group_id&&this.openDetailFiles(t)},navigateToPage(){this.goToPage>this.pagesRange.length?this.goToPage=this.pagesRange.length:this.goToPage<=0&&(this.goToPage=1),this.page=this.goToPage-1,this.files=this.paginatedFiles[this.page]}}},M=z;var O=n(61283),U={};U.styleTagTransform=B(),U.setAttributes=D(),U.insert=F().bind(null,"head"),U.domAPI=_(),U.insertStyleElement=T();C()(O.A,U);O.A&&O.A.locals&&O.A.locals;var W=n(67243),j={};j.styleTagTransform=B(),j.setAttributes=D(),j.insert=F().bind(null,"head"),j.domAPI=_(),j.insertStyleElement=T();C()(W.A,j);W.A&&W.A.locals&&W.A.locals;const Y=(0,h.A)(M,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"details-list-item",class:{"icon-loading":t.updating},attrs:{id:"detail-"+t.detail.task_id+"-"+t.detail.group_id}},[e("div",{staticClass:"details-list-item-title"},[e("NcCheckboxRadioSwitch",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Select group"),placement:"top"},expression:"{content: t('mediadc', 'Select group'), placement: 'top'}"}],staticClass:"mediadc-checkbox-only batch-checkbox",attrs:{checked:t.checked},on:{"update:checked":function(e){t.checked=e}}}),t._v(" "),e("NcButton",{staticClass:"open-details-btn",attrs:{type:"tertiary","aria-label":t.t("mediadc","Open duplicate group")},on:{click:function(e){return t.openDetailFiles(t.detail)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-projects"})]},proxy:!0},{key:"default",fn:function(){return[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","Duplicate group"))+" #"+t._s(t.detail.group_id)+" ("+t._s(t.groupFilesTotal)+"\n\t\t\t\t"+t._s(t.n("mediadc","file","files",t.groupFilesTotal))+t._s(" - "+t.formatBytes(t.groupFilesSize))+")\n\t\t\t\t"),e("span",{class:t.opened?"icon-triangle-n":"icon-triangle-s",staticStyle:{display:"inline-flex",margin:"0 0 0 5px"}})]},proxy:!0}])}),t._v(" "),e("NcActions",[e("NcActionButton",{attrs:{icon:"icon-delete delete-group-btn"},on:{click:function(e){return t.removeTaskDetail(t.detail)}}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","Remove group without deleting files"))+"\n\t\t\t")])],1)],1),t._v(" "),t.opened&&t.groupFilesTotal>t.groupItemsPerPage?e("div",{staticClass:"pagination"},[e("NcButton",{staticStyle:{"margin-right":"5px"},attrs:{type:"tertiary","aria-label":t.t("mediadc","Previous duplicate group files page")},on:{click:function(e){return t.openPrevDetailFiles(t.detail)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-view-previous"})]},proxy:!0}],null,!1,3222065630)}),t._v(" "),e("span",[t._v(t._s(t.t("mediadc","Page:"))+"")]),t._v(" "),e("span",[t._v(t._s(t.page+1)+"/"+t._s(Math.ceil(t.groupFilesTotal/t.groupItemsPerPage)))]),t._v(" "),e("NcButton",{staticStyle:{"margin-left":"5px"},attrs:{type:"tertiary","aria-label":t.t("mediadc","Next duplicate group files page")},on:{click:function(e){return t.openNextDetailFiles(t.detail)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-view-next"})]},proxy:!0}],null,!1,3593544488)}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.goToPage,expression:"goToPage"}],staticStyle:{width:"fit-content"},attrs:{id:"go_to_page",type:"number",min:1,max:t.pagesRange[t.pagesRange.length-1]+1,name:"go_to_page","aria-label":t.t("mediadc","Page to navigate to")},domProps:{value:t.goToPage},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.navigateToPage.apply(null,arguments)},input:function(e){e.target.composing||(t.goToPage=e.target.value)}}}),t._v(" "),t.detail.files.length>t.groupItemsPerPage?e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.t("mediadc","Go to page"),expression:"t('mediadc', 'Go to page')"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Navigate to duplicate list page")},on:{click:t.navigateToPage},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-confirm"})]},proxy:!0}],null,!1,3432447101)}):t._e()],1):t._e(),t._v(" "),t.opened?e("DetailsGroupList",{attrs:{detail:t.detail,files:t.files,"all-files":t.allFiles,"loading-files":t.loadingFiles,updating:t.updating,"files-ascending":t.filesAscending},on:{"update:loadingFiles":function(e){t.loadingFiles=e},"update:loading-files":function(e){t.loadingFiles=e},"update:updating":function(e){t.updating=e},"update:filesAscending":function(e){t.filesAscending=e},"update:files-ascending":function(e){t.filesAscending=e}}}):t._e()],1)}),[],!1,null,"d2859054",null).exports;const H={name:"Pagination",components:{NcButton:c.x1},props:{details:{type:Array,required:!0},prevGroupsPage:{type:Function,required:!0},nextGroupsPage:{type:Function,required:!0},page:{type:Number,required:!0}},data:()=>({goToPage:1}),computed:{...(0,d.L8)(["itemsPerPage"]),pagesRange(){return Array.from({length:Math.ceil(this.details.length/this.itemsPerPage)},((t,e)=>e))}},methods:{navigateToPage(){this.goToPage>this.pagesRange.length?this.goToPage=this.pagesRange.length:this.goToPage<=0&&(this.goToPage=1),this.$emit("update:page",this.goToPage-1)}}};var V=n(31280),q={};q.styleTagTransform=B(),q.setAttributes=D(),q.insert=F().bind(null,"head"),q.domAPI=_(),q.insertStyleElement=T();C()(V.A,q);V.A&&V.A.locals&&V.A.locals;const J=(0,h.A)(H,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"pagination"},[t.details.length>t.itemsPerPage?e("NcButton",{attrs:{type:"tertiary","aria-label":t.t("mediadc","Previous duplicate list page")},on:{click:t.prevGroupsPage},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-view-previous pagination-button"})]},proxy:!0}],null,!1,2362740169)}):t._e(),t._v(" "),t.details.length>t.itemsPerPage?e("span",{staticStyle:{"margin-left":"5px"}},[t._v(t._s(t.t("mediadc","Page:"))+"")]):t._e(),t._v(" "),t.details.length>t.itemsPerPage?e("span",{staticStyle:{"margin-right":"5px"}},[t._v(t._s(t.page+1)+"/"+t._s(Math.ceil(t.details.length/t.itemsPerPage)))]):t._e(),t._v(" "),t.details.length>t.itemsPerPage?e("NcButton",{attrs:{type:"tertiary","aria-label":t.t("mediadc","Next duplicate list page")},on:{click:t.nextGroupsPage},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-view-next pagination-button"})]},proxy:!0}],null,!1,2982378111)}):t._e(),t._v(" "),t.details.length>t.itemsPerPage?[e("input",{directives:[{name:"model",rawName:"v-model",value:t.goToPage,expression:"goToPage"}],attrs:{id:"go_to_page",type:"number",min:1,max:t.pagesRange[t.pagesRange.length-1]+1,name:"go_to_page","aria-label":t.t("mediadc","Page to navigate to")},domProps:{value:t.goToPage},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.navigateToPage.apply(null,arguments)},input:function(e){e.target.composing||(t.goToPage=e.target.value)}}}),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.t("mediadc","Go to page"),expression:"t('mediadc', 'Go to page')"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Navigate to duplicate list page")},on:{click:t.navigateToPage},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-confirm"})]},proxy:!0}],null,!1,3432447101)})]:t._e()],2)}),[],!1,null,"07add7c2",null).exports,Q={name:"DetailsList",components:{DetailsListItem:Y,NcCheckboxRadioSwitch:c.AO,NcButton:c.x1,NcActions:c.B6,NcActionButton:c.Ko,Pagination:J,MinusBoxOutline:u,CheckAll:m,CheckUnderline:A,NcLoadingIcon:c.ne},mixins:[k.A],data:()=>({page:0,filterId:null,checkedDetailGroups:[],batchActionsOpened:!1,sortGroups:!0,batchDeleting:!1}),computed:{...(0,d.L8)(["task","taskInfo","details","detailsInfo","sortedDetails","sorted","paginatedDetails","paginatedSortedDetails","paginatedDetailsFiltered","paginatedDetailsFilteredSorted","itemsPerPage","detailsFiltered","detailsFilteredSorted","autoOpenNextGroup"]),filtered(){return""!==this.filterId&&null!==this.filterId},checkedDetailGroupsIntersect(){let t=[];t=this.sortGroups?this.filtered?new Set(this.paginatedDetailsFilteredSorted[this.page].map((t=>t.group_id))):new Set(this.paginatedSortedDetails[this.page].map((t=>t.group_id))):this.filtered?new Set(this.paginatedDetailsFiltered[this.page].map((t=>t.group_id))):new Set(this.paginatedDetails[this.page].map((t=>t.group_id)));const e=new Set(this.checkedDetailGroups.map((t=>t.group_id))),i=new Set([...t].filter((t=>e.has(t))));return Array.from(i)},pagesRange(){return null===this.filterId?Array.from({length:Math.ceil(this.details.length/this.itemsPerPage)},((t,e)=>e)):Array.from({length:Math.ceil(this.detailsFiltered.length/this.itemsPerPage)},((t,e)=>e))}},watch:{itemsPerPage(t){this.page>=Math.ceil(this.details.length/t)&&(this.page=Math.ceil(this.details.length/t)-1)},details(t){this.page>=Math.ceil(t.length/this.itemsPerPage)&&(this.page=Math.ceil(t.length/this.itemsPerPage)-1)},sortGroups(){window.localStorage.setItem("mediadc_details_sort_groups",this.sortGroups),this.$store.commit("setSortGroups",this.sortGroups)}},beforeMount(){this.$emit("update:loading",!1);const t=window.localStorage.getItem("mediadc_details_sort_groups");this.sortGroups=null===t||!0===JSON.parse(t),this.$store.commit("setSortGroups",null===t||!0===JSON.parse(t)),(0,l.B1)("openNextDetailGroup",this.openNextDetailGroup)},beforeDestroy(){(0,l.al)("openNextDetailGroup",this.openNextDetailGroup)},methods:{prevGroupsPage(){this.page>0?this.page-=1:(0,o.I9)(this.t("mediadc","First page reached!"))},nextGroupsPage(){!this.filtered&&this.page<Math.ceil(this.details.length/this.itemsPerPage)-1||this.page<Math.ceil(this.detailsFiltered.length/this.itemsPerPage)-1?this.page+=1:(0,o.I9)(this.t("mediadc","Last page reached!"))},toggleSorting(){this.$store.commit("setSorted",!this.sorted)},filterByGroupId(){if(null!==this.filterId&&""!==this.filterId){const t=/^[1-9]$/s,e=/^\d+-\d+$/s;if(this.page=0,t.test(this.filterId))this.$store.commit("setDetailsFiltered",this.details.filter((t=>t.group_id.toString().includes(this.filterId))));else if(e.test(this.filterId)){const t=this.filterId.split("-")[0],e=this.filterId.split("-")[1];this.$store.commit("setDetailsFiltered",this.details.filter((i=>Number(i.group_id)>=t&&Number(i.group_id)<=e)))}}else this.$store.commit("setDetailsFiltered",[])},openBatchActionsPopup(){document.addEventListener("click",this.toggleBatchActionsPopup)},toggleBatchActionsPopup(){this.batchActionsOpened&&document.removeEventListener("click",this.toggleBatchActionsPopup),this.batchActionsOpened=!this.batchActionsOpened},removeCheckedGroups(){s.Ay.post((0,r.Jv)(`/apps/mediadc/api/v1/tasks/${this.task.id}/details/remove`),{groupIds:this.checkedDetailGroups.map((t=>t.group_id))}).then((t=>{if(t.data.success){(0,l.Ic)("openNextDetailGroup",this.checkedDetailGroups[this.checkedDetailGroups.length-1]);const e=[...this.details];for(const i of t.data.removedGroupIds){const t=this.checkedDetailGroups.findIndex((t=>Number(t.group_id)===i));-1!==t&&this.checkedDetailGroups.splice(t,1);const n=e.findIndex((t=>Number(t.group_id)===i));e.splice(n,1)}(0,l.Ic)("updateTaskInfo"),this.$store.commit("setDetails",e),(0,o.Te)(this.t("mediadc","Selected groups successfully removed"))}})).catch((t=>{(0,o.Qg)(this.t("mediadc","A server error occurred")),console.debug(t)}))},_deselectAllGroups(t){(0,l.Ic)("deselectGroups",this.checkedDetailGroups.map((t=>t.group_id)));for(const t of this.details){const e=this.checkedDetailGroups.findIndex((e=>e.group_id===t.group_id));-1!==e&&this.checkedDetailGroups.splice(e,1)}},deleteCheckedGroupsFiles(){this.batchDeleting=!0,s.Ay.post((0,r.Jv)(`/apps/mediadc/api/v1/tasks/${this.task.id}/details/delete`),{groupIds:this.checkedDetailGroups.map((t=>t.group_id))}).then((t=>{if(t.data.success){(0,l.Ic)("openNextDetailGroup",this.checkedDetailGroups[this.checkedDetailGroups.length-1]);const e=[...this.details];for(const i of t.data.removedGroupIds){const t=this.checkedDetailGroups.findIndex((t=>Number(t.group_id)===i));-1!==t&&this.checkedDetailGroups.splice(t,1);const n=e.findIndex((t=>Number(t.group_id)===i));e.splice(n,1)}(0,l.Ic)("updateTaskInfo"),this.$store.commit("setDetails",e),this.$store.commit("setTask",t.data.task),(0,o.Te)(this.t("mediadc","Selected group files successfully deleted"))}else 0!==t.data.removedGroupIds.length?(0,o.I9)(this.t("mediadc","Not all selected group files deleted")):(0,o.Qg)(this.t("mediadc","Failed to delete selected group files"));this.batchDeleting=!1})).catch((t=>{(0,o.Qg)(this.t("mediadc","A server error occurred")),console.debug(t),this.batchDeleting=!1}))},selectAllGroups(){const t=this.filtered?this.detailsFiltered:this.details;if(this.checkedDetailGroups.length===t.length)this._deselectAllGroups(t);else for(const e of t){-1===this.checkedDetailGroups.findIndex((t=>t.group_id===e.group_id))&&this.checkedDetailGroups.push(e)}},selectAllGroupsOnPage(){const t=this.filtered?this.sortGroups?this.paginatedDetailsFilteredSorted:this.paginatedDetailsFiltered:this.sortGroups?this.paginatedSortedDetails:this.paginatedDetails;if(t[this.page].length===this.checkedDetailGroupsIntersect.length){const t=this.checkedDetailGroupsIntersect;(0,l.Ic)("deselectGroups",t);for(const e of t){const t=this.checkedDetailGroups.findIndex((t=>t.group_id===e.group_id));-1!==t&&this.checkedDetailGroups.splice(t,1)}}else for(const e of t[this.page]){-1===this.checkedDetailGroups.findIndex((t=>t.group_id===e.group_id))&&this.checkedDetailGroups.push(e)}},openNextDetailGroup(t){if(this.autoOpenNextGroup){const e=this.details.findIndex((e=>e.group_id===t.group_id));-1!==e&&(e!==this.details.length-1?(0,l.Ic)("openGroup",this.details[e+1]):e===this.details.length-1&&this.details.length>=2&&(0,l.Ic)("openGroup",this.details[e-1]))}},toggleGroups(){const t=this.filtered?this.sortGroups?this.paginatedDetailsFilteredSorted[this.page]:this.paginatedDetailsFiltered[this.page]:this.sortGroups?this.paginatedSortedDetails[this.page]:this.paginatedDetails[this.page];for(const e of t)(0,l.Ic)("toggleGroup",e)}}};var K=n(11003),Z={};Z.styleTagTransform=B(),Z.setAttributes=D(),Z.insert=F().bind(null,"head"),Z.domAPI=_(),Z.insertStyleElement=T();C()(K.A,Z);K.A&&K.A.locals&&K.A.locals;const X=(0,h.A)(Q,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"task-details"},[e("div",{staticClass:"task-details-heading"},[e("h3",[t._v("\n\t\t\t"+t._s(t.t("mediadc","Duplicates list"))+"\n\t\t\t"),"finished"===t.getStatusBadge(t.task)?e("span",[t._v("\n\t\t\t\t- "+t._s(t.details.length)+" "+t._s(t.n("mediadc","group ","groups",t.details.length))+"\n\t\t\t")]):t._e(),t._v(" "),-1!==t.detailsInfo.filestotal&&-1!==t.detailsInfo.filessize?e("span",[t._v("\n\t\t\t\t("+t._s(t.detailsInfo.filestotal)+" "+t._s(t.n("mediadc","file","files",t.detailsInfo.filestotal))+" - "+t._s(t.formatBytes(t.detailsInfo.filessize))+")\n\t\t\t")]):t._e()]),t._v(" "),e("div",{staticClass:"pagination-wrapper"},[e("div",{staticClass:"pagination-sorting"},[e("NcCheckboxRadioSwitch",{staticStyle:{"margin-right":"20px"},attrs:{checked:t.sortGroups},on:{"update:checked":function(e){t.sortGroups=e}}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Sort groups"))+"\n\t\t\t\t")]),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.t("mediadc","Sorting details by files count"),expression:"t('mediadc', 'Sorting details by files count')"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Sorting details by files count")},on:{click:t.toggleSorting},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{class:t.sorted?"icon-triangle-n toggle-sorting-button":"icon-triangle-s toggle-sorting-button"})]},proxy:!0}])})],1),t._v(" "),e("Pagination",{attrs:{details:t.filtered?t.detailsFiltered:t.details,"prev-groups-page":t.prevGroupsPage,"next-groups-page":t.nextGroupsPage,page:t.page},on:{"update:page":function(e){t.page=e}}})],1)]),t._v(" "),t.details.length>0?e("div",[e("div",{staticClass:"filters"},[e("label",{attrs:{for:"group-id-filter"}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","Filter by duplicate group id: "))+"\n\t\t\t\t"),e("input",{directives:[{name:"model",rawName:"v-model",value:t.filterId,expression:"filterId"},{name:"tooltip",rawName:"v-tooltip",value:t.t("mediadc","Filter by id or range of ids (1-10)"),expression:"t('mediadc', 'Filter by id or range of ids (1-10)')"}],staticStyle:{"max-width":"33%"},attrs:{id:"group-id-filter",type:"search",name:"group-id-filter",placeholder:"#id"},domProps:{value:t.filterId},on:{input:[function(e){e.target.composing||(t.filterId=e.target.value)},t.filterByGroupId]}})]),t._v(" "),e("div",{staticClass:"batch-actions",staticStyle:{display:"flex"}},[e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.t("mediadc","Toggle duplicate groups"),expression:"t('mediadc', 'Toggle duplicate groups')"}],staticStyle:{"margin-right":"10px"},attrs:{type:"tertiary","aria-label":t.t("mediadc","Toggle duplicate groups")},on:{click:t.toggleGroups},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-category-organization"})]},proxy:!0},{key:"default",fn:function(){return[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Toggle groups"))+"\n\t\t\t\t\t")]},proxy:!0}],null,!1,4172331607)}),t._v(" "),t.checkedDetailGroups.length>0?e("div",{staticClass:"batch-editing"},[t._v("\n\t\t\t\t\t"+t._s(t.n("mediadc","Batch actions for %n group","Batch actions for %n groups",t.checkedDetailGroups.length))+"\n\t\t\t\t\t"),e("NcActions",{staticStyle:{"margin-left":"5px"},attrs:{placement:"top"}},[t.filtered?[e("NcActionButton",{on:{click:t.selectAllGroups},scopedSlots:t._u([{key:"icon",fn:function(){return[e("CheckAll",{attrs:{size:20}})]},proxy:!0}],null,!1,676844495)},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.checkedDetailGroups.length===t.detailsFiltered.length?t.t("mediadc","Deselect all"):t.t("mediadc","Select all"))+"\n\t\t\t\t\t\t\t")]),t._v(" "),t.detailsFiltered.length>t.itemsPerPage?e("NcActionButton",{on:{click:t.selectAllGroupsOnPage},scopedSlots:t._u([{key:"icon",fn:function(){return[e("CheckUnderline",{attrs:{size:20}})]},proxy:!0}],null,!1,3724893960)},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.checkedDetailGroupsIntersect.length===t.paginatedDetailsFiltered[t.page].length?t.t("mediadc","Deselect all on page"):t.t("mediadc","Select all on page"))+"\n\t\t\t\t\t\t\t")]):t._e()]:[e("NcActionButton",{on:{click:t.selectAllGroups},scopedSlots:t._u([{key:"icon",fn:function(){return[e("CheckAll",{attrs:{size:20}})]},proxy:!0}],null,!1,676844495)},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.checkedDetailGroups.length===t.details.length?t.t("mediadc","Deselect all"):t.t("mediadc","Select all"))+"\n\t\t\t\t\t\t\t")]),t._v(" "),t.details.length>t.itemsPerPage?e("NcActionButton",{on:{click:t.selectAllGroupsOnPage},scopedSlots:t._u([{key:"icon",fn:function(){return[e("CheckUnderline",{attrs:{size:20}})]},proxy:!0}],null,!1,3724893960)},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.checkedDetailGroupsIntersect.length===t.paginatedDetails[t.page].length||t.checkedDetailGroupsIntersect.length===t.paginatedSortedDetails[t.page].length?t.t("mediadc","Deselect all on page"):t.t("mediadc","Select all on page"))+"\n\t\t\t\t\t\t\t")]):t._e()],t._v(" "),t.checkedDetailGroups.length>0?e("NcActionButton",{on:{click:function(e){t._deselectAllGroups(t.filtered?t.detailsFiltered:t.details)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("MinusBoxOutline",{attrs:{size:20}})]},proxy:!0}],null,!1,2524064593)},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Uncheck selected"))+"\n\t\t\t\t\t\t")]):t._e(),t._v(" "),e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Mark all files in group as resolved"),placement:"left"},expression:"{content: t('mediadc', 'Mark all files in group as resolved'), placement: 'left'}"}],attrs:{icon:"icon-close"},on:{click:t.removeCheckedGroups}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.n("mediadc","Remove group","Remove groups",t.checkedDetailGroups.length))+"\n\t\t\t\t\t\t")]),t._v(" "),e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Delete all files except the largest one"),placement:"left"},expression:"{content: t('mediadc', 'Delete all files except the largest one'), placement: 'left'}"}],attrs:{icon:"icon-delete",disabled:t.batchDeleting},on:{click:t.deleteCheckedGroupsFiles},scopedSlots:t._u([t.batchDeleting?{key:"icon",fn:function(){return[e("NcLoadingIcon",{attrs:{size:20}})]},proxy:!0}:{key:"icon",fn:function(){return[e("span",{staticClass:"icon-delete material-design-icon"})]},proxy:!0}],null,!0)},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Delete files"))+"\n\t\t\t\t\t\t")])],2)],1):t._e()],1)]),t._v(" "),t.filtered?t.detailsFiltered.length>0&&t.filtered?e("div",[t.sortGroups?t._l(t.paginatedDetailsFilteredSorted[t.page],(function(i){return e("div",{directives:[{name:"show",rawName:"v-show",value:i.files.length>1,expression:"detail.files.length > 1"}],key:i.group_id,staticClass:"task-details-row"},[e("DetailsListItem",{attrs:{detail:i,"checked-detail-groups":t.checkedDetailGroups},on:{"update:checkedDetailGroups":function(e){t.checkedDetailGroups=e},"update:checked-detail-groups":function(e){t.checkedDetailGroups=e}}})],1)})):t._l(t.paginatedDetailsFiltered[t.page],(function(i){return e("div",{directives:[{name:"show",rawName:"v-show",value:i.files.length>1,expression:"detail.files.length > 1"}],key:i.group_id,staticClass:"task-details-row"},[e("DetailsListItem",{attrs:{detail:i,"checked-detail-groups":t.checkedDetailGroups},on:{"update:checkedDetailGroups":function(e){t.checkedDetailGroups=e},"update:checked-detail-groups":function(e){t.checkedDetailGroups=e}}})],1)}))],2):e("div",[e("p",{staticStyle:{"text-align":"center","font-weight":"bold"}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","No matchings found"))+"\n\t\t\t")])]):e("div",[t.sortGroups?t._l(t.paginatedSortedDetails[t.page],(function(i){return e("div",{directives:[{name:"show",rawName:"v-show",value:i.files.length>1,expression:"detail.files.length > 1"}],key:i.group_id,staticClass:"task-details-row"},[e("DetailsListItem",{attrs:{detail:i,"checked-detail-groups":t.checkedDetailGroups},on:{"update:checkedDetailGroups":function(e){t.checkedDetailGroups=e},"update:checked-detail-groups":function(e){t.checkedDetailGroups=e}}})],1)})):t._l(t.paginatedDetails[t.page],(function(i){return e("div",{directives:[{name:"show",rawName:"v-show",value:i.files.length>1,expression:"detail.files.length > 1"}],key:i.group_id,staticClass:"task-details-row"},[e("DetailsListItem",{attrs:{detail:i,"checked-detail-groups":t.checkedDetailGroups},on:{"update:checkedDetailGroups":function(e){t.checkedDetailGroups=e},"update:checked-detail-groups":function(e){t.checkedDetailGroups=e}}})],1)}))],2)]):e("div",{staticStyle:{"margin-top":"10px"}},[e("strong",[t._v(t._s(t.t("mediadc","No duplicates found.")))])])])}),[],!1,null,"14ad58d6",null).exports;var tt=n(60017),et=n(60508);const it={name:"TasksEdit",components:{NcButton:c.x1,NcCheckboxRadioSwitch:c.AO,PlusThick:tt.A},data:()=>({targetDirectoriesPaths:{},targetDirectoriesIds:[],excludeDirectoriesPaths:[],excludeFileIds:{},targetMimeType:0,similarity_threshold:90,customExcludeList:[],customExcludeMask:"",addingCustomMask:!1,runningTask:!1,finishNotification:!0,taskName:""}),computed:{...(0,d.L8)(["settings","settingByName","tasks","task","taskInfo"])},beforeMount(){this.similarity_threshold=void 0!==this.settingByName("similarity_threshold")?this.settingByName("similarity_threshold").value:90,this.targetMimeType=JSON.parse(this.task.collector_settings).target_mtype,this.similarity_threshold=JSON.parse(this.task.collector_settings).similarity_threshold,this.finishNotification=JSON.parse(this.task.collector_settings).finish_notification,this.taskName=this.task.name,this.parseTaskSettings()},methods:{parseTaskSettings(){null!==this.taskInfo&&"target_directories"in this.taskInfo&&this.taskInfo.target_directories.forEach((t=>{this.targetDirectoriesIds.push(t.fileid.toString()),this.targetDirectoriesPaths[t.fileid.toString()]=""!==t.filepath.replace(`/${(0,a.HW)().uid}/files`,"")?t.filepath.replace(`/${(0,a.HW)().uid}/files`,""):"/"})),null!==this.taskInfo&&"exclude_directories"in this.taskInfo&&(this.taskInfo.exclude_directories.forEach((t=>{this.excludeDirectoriesPaths.push(t.filepath.replace()),this.excludeFileIds[t.fileid.toString()]=t.filepath.replace(`/${(0,a.HW)().uid}/files`,"")})),this.customExcludeList=JSON.parse(this.task.exclude_list).user.mask)},getDirectoriesPicker:t=>(0,o.a1)(t).setMultiSelect(!1).addMimeTypeFilter("httpd/unix-directory").setType(1).allowDirectories(!0).build(),openDirectoriesExplorer(){this.getDirectoriesPicker(this.t("mediadc","Choose target directory")).pick().then((t=>{t.startsWith("/")?(0,et.EF)(t).then((e=>{const i=(0,et.CK)(e.data);-1!==i&&(i in this.targetDirectoriesPaths?(0,o.I9)(this.t("mediadc","This directory already selected")):(this.targetDirectoriesIds.push(i),this.targetDirectoriesPaths[i.toString()]=t))})):(0,et.EF)("/").then((t=>{const e=(0,et.CK)(t.data);-1!==e&&(e in this.targetDirectoriesPaths?(0,o.I9)(this.t("mediadc","This directory already selected")):(this.targetDirectoriesIds.push(e),this.targetDirectoriesPaths[e.toString()]="/"))}))}))},openExcludeExplorer(){this.getDirectoriesPicker(this.t("mediadc","Choose directory to exclude")).pick().then((t=>{-1===Object.values(this.excludeFileIds).findIndex((e=>e===t))?t.startsWith("/")?(0,et.EF)(t).then((e=>{const i=(0,et.CK)(e.data);-1!==i&&(this.excludeDirectoriesPaths.push(t),this.excludeFileIds[i.toString()]=t)})):(0,et.EF)("/").then((e=>{const i=(0,et.CK)(e.data);-1!==i&&(this.excludeDirectoriesPaths.push(t),this.excludeFileIds[i.toString()]="/")})):(0,o.I9)(this.t("mediadc","This directory already excluded"))}))},restartTask(){this.runningTask=!0,this.$store.dispatch("getSettings").then((()=>{s.Ay.post((0,r.Jv)("/apps/mediadc/api/v1/tasks/restart"),{taskId:this.task.id,targetDirectoryIds:JSON.stringify(this.targetDirectoriesIds),excludeList:{user:{mask:this.customExcludeList,fileid:Object.keys(this.excludeFileIds).map((t=>Number(t)))},admin:JSON.parse(this.settingByName("exclude_list").value)||{mask:[],fileid:[]}},collectorSettings:{hashing_algorithm:JSON.parse(this.settingByName("hashing_algorithm").value)||"dhash",similarity_threshold:Number(this.similarity_threshold),hash_size:Number(this.settingByName("hash_size").value)||16,target_mtype:this.targetMimeType,finish_notification:this.finishNotification},name:this.taskName}).then((e=>{this.runningTask=!1,e.data.success?(this.runningTask=!1,this.closeEditTaskDialog(),(0,l.Ic)("restartTask"),(0,o.Te)(this.t("mediadc","Task successfully restarted!"))):e.data.limit?(0,o.I9)(this.t("mediadc","Running tasks limit exceeded. Try again later.")):e.data.empty?(0,o.I9)(this.n("mediadc","Target folder has no files or all of them excluded","Target folders have no files or all of them excluded",this.targetDirectoriesIds.length)):e.data.php_exec_not_enabled?(0,o.Qg)(t("mediadc","Task run error: PHP `exec` function is not enabled")):(0,o.I9)(t("medaidc","Some error occurred while running Collector Task. Try again."))}))}))},removeTargetDirectory(t){delete this.targetDirectoriesPaths[t];const e=this.targetDirectoriesIds.findIndex((e=>e===t));this.targetDirectoriesIds.splice(e,1)},removeExcludeDirectory(t){if(t in this.excludeFileIds){const e=this.excludeDirectoriesPaths.findIndex((e=>e===this.excludeFileIds[t]));this.excludeDirectoriesPaths.splice(e,1),delete this.excludeFileIds[t]}},addNewMask(){this.addingCustomMask=!0,setTimeout((()=>{this.$refs.customExcludeMask.focus()}),100)},addCustomMask(){this.customExcludeMask.length>0?-1===this.customExcludeList.findIndex((t=>t===this.customExcludeMask))?(this.customExcludeList.push(this.customExcludeMask),this.customExcludeMask="",this.addingCustomMask=!1):(0,o.I9)(this.t("mediadc","This mask already exists!")):(0,o.I9)(this.t("mediadc","Enter custom mask!"))},cancelAddingCustomMask(){this.customExcludeMask="",this.addingCustomMask=!1},deleteCustomMask(t){const e=this.customExcludeList.findIndex((e=>e===t));this.customExcludeList.splice(e,1)},resetForm(){this.targetDirectoriesPaths={},this.targetDirectoriesIds=[],this.excludeDirectoriesNames=[],this.excludeFileIds={},this.targetMimeType=0,this.similarity_threshold=void 0!==this.settingByName("similarity_threshold")?this.settingByName("similarity_threshold").value:90,this.customExcludeList=[],this.runningTask=!1,this.finishNotification=!0},closeEditTaskDialog(){this.$emit("update:opened",!1)}}};var nt=n(81150),st={};st.styleTagTransform=B(),st.setAttributes=D(),st.insert=F().bind(null,"head"),st.domAPI=_(),st.insertStyleElement=T();C()(nt.A,st);nt.A&&nt.A.locals&&nt.A.locals;const at=(0,h.A)(it,(function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade"}},[e("div",{staticClass:"block-wrapper"},[e("div",{staticClass:"edit-task-block"},[e("div",{staticClass:"edit-task-close",on:{click:function(e){return t.closeEditTaskDialog()}}}),t._v(" "),e("h2",[t._v(t._s(t.t("mediadc","Edit task")))]),t._v(" "),e("div",{staticClass:"selection-container"},[e("div",{staticClass:"block target-directories-block"},[e("h3",[t._v(t._s(t.t("mediadc","Target directories")))]),t._v(" "),t.targetDirectoriesIds.length>0?e("div",t._l(t.targetDirectoriesIds,(function(i){return e("div",{key:i,staticClass:"selected-target-directories-list"},[e("div",{staticClass:"target-directory"},[e("span",{staticStyle:{"overflow-y":"scroll","white-space":"nowrap"}},[t._v(t._s(t.targetDirectoriesPaths[i]))]),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Remove"),placement:"left"},expression:"{ content: t('mediadc', 'Remove'), placement: 'left'}"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Remove selected target directory")},on:{click:function(e){return t.removeTargetDirectory(i)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-delete"})]},proxy:!0}],null,!0)})],1)])})),0):e("div",[e("span",[t._v(t._s(t.t("mediadc","Not selected")))])]),t._v(" "),e("br"),t._v(" "),e("NcButton",{attrs:{"aria-label":t.t("mediadc","Select target directory")},on:{click:t.openDirectoriesExplorer},scopedSlots:t._u([{key:"icon",fn:function(){return[e("PlusThick",{attrs:{size:16}})]},proxy:!0}])},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Select"))+"\n\t\t\t\t\t")])],1),t._v(" "),e("div",{staticClass:"block"},[e("h3",[t._v(t._s(t.t("mediadc","Exclude directories")))]),t._v(" "),t.excludeDirectoriesPaths.length>0?e("div",t._l(Object.keys(t.excludeFileIds),(function(i){return e("div",{key:i,staticClass:"selected-excluded-directories-list"},[e("div",{staticClass:"target-directory"},[e("span",{staticStyle:{"overflow-y":"scroll","white-space":"nowrap"}},[t._v(t._s(t.excludeFileIds[i]))]),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Remove"),placement:"left"},expression:"{ content: t('mediadc', 'Remove'), placement: 'left'}"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Remove selected exclude directory")},on:{click:function(e){return t.removeExcludeDirectory(i)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-delete"})]},proxy:!0}],null,!0)})],1)])})),0):e("div",[e("span",[t._v(t._s(t.t("mediadc","Not selected")))])]),t._v(" "),e("br"),t._v(" "),e("NcButton",{attrs:{"aria-label":t.t("mediadc","Select exclude directory")},on:{click:t.openExcludeExplorer},scopedSlots:t._u([{key:"icon",fn:function(){return[e("PlusThick",{attrs:{size:16}})]},proxy:!0}])},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Select"))+"\n\t\t\t\t\t")])],1)]),t._v(" "),e("div",{staticClass:"selection-container"},[e("div",{staticClass:"block"},[e("h3",[t._v(t._s(t.t("mediadc","Custom exclude mask")))]),t._v(" "),t.customExcludeList.length>0?e("div",{staticClass:"custom-masks-list"},t._l(t.customExcludeList,(function(i,n){return e("div",{key:n,staticClass:"custom-mask"},[e("span",[t._v(t._s(i))]),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Remove"),placement:"left"},expression:"{ content: t('mediadc', 'Remove'), placement: 'left'}"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Remove selected custom exclude mask")},on:{click:function(e){return t.deleteCustomMask(i)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-delete"})]},proxy:!0}],null,!0)})],1)})),0):e("div",[e("span",[t._v(t._s(t.t("mediadc","Not added")))])]),t._v(" "),t.addingCustomMask?e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.customExcludeMask,expression:"customExcludeMask"}],ref:"customExcludeMask",attrs:{id:"custom-exclude-mask",type:"text"},domProps:{value:t.customExcludeMask},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addCustomMask.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancelAddingCustomMask.apply(null,arguments)}],input:function(e){e.target.composing||(t.customExcludeMask=e.target.value)}}}),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.t("mediadc","Confirm"),expression:"t('mediadc', 'Confirm')"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Confirm adding of the custom exclude mask")},on:{click:t.addCustomMask},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-checkmark"})]},proxy:!0}],null,!1,3443818620)}),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.t("mediadc","Decline"),expression:"t('mediadc', 'Decline')"}],attrs:{type:"tertiary","aria-label":t.t("mediadc","Cancel adding of the custom exclude mask")},on:{click:t.cancelAddingCustomMask},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{staticClass:"icon-close"})]},proxy:!0}],null,!1,1218614841)})],1):t._e(),t._v(" "),e("div",{staticStyle:{display:"flex","align-items":"center",margin:"20px 0"}},[e("NcButton",{attrs:{"aria-label":t.t("mediadc","Add custom exclude mask")},on:{click:t.addNewMask},scopedSlots:t._u([{key:"icon",fn:function(){return[e("PlusThick",{attrs:{size:16}})]},proxy:!0},{key:"default",fn:function(){return[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Add mask"))+"\n\t\t\t\t\t\t\t")]},proxy:!0}])})],1)]),t._v(" "),e("div",{staticClass:"block"},[e("h3",{staticStyle:{margin:"5px 0"}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Target Mime Type"))+"\n\t\t\t\t\t")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.targetMimeType,expression:"targetMimeType"}],attrs:{id:"target_mtype",name:"target_mtype"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.targetMimeType=e.target.multiple?i:i[0]}}},[e("option",{domProps:{value:0}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Photos"))+"\n\t\t\t\t\t\t")]),t._v(" "),e("option",{domProps:{value:1}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Videos"))+"\n\t\t\t\t\t\t")]),t._v(" "),e("option",{domProps:{value:2}},[t._v("\n\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Photos and Videos"))+"\n\t\t\t\t\t\t")])]),t._v(" "),e("h3",{staticStyle:{margin:"5px 0"}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Similarity threshold"))+"\n\t\t\t\t\t")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.similarity_threshold,expression:"similarity_threshold"}],staticStyle:{margin:"0 0 10px"},attrs:{type:"number",min:"50",max:"100"},domProps:{value:t.similarity_threshold},on:{input:function(e){e.target.composing||(t.similarity_threshold=e.target.value)}}})])]),t._v(" "),e("div",{staticClass:"create-task-actions"},[e("NcButton",{attrs:{"aria-label":t.t("mediadc","Restart Task with changed parameters"),disabled:t.runningTask||0===Object.keys(t.targetDirectoriesPaths).length},on:{click:t.restartTask},scopedSlots:t._u([{key:"default",fn:function(){return[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Restart task"))+"\n\t\t\t\t\t")]},proxy:!0},t.runningTask?{key:"icon",fn:function(){return[e("span",{staticClass:"icon-loading-small"})]},proxy:!0}:null],null,!0)}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.taskName,expression:"taskName"}],attrs:{type:"text",placeholder:t.t("mediadc","Task name")},domProps:{value:t.taskName},on:{input:function(e){e.target.composing||(t.taskName=e.target.value)}}}),t._v(" "),e("NcCheckboxRadioSwitch",{attrs:{checked:t.finishNotification},on:{"update:checked":function(e){t.finishNotification=e}}},[t._v("\n\t\t\t\t\t"+t._s(t.t("mediadc","Finish notification"))+"\n\t\t\t\t")])],1)])])])}),[],!1,null,"d11ce3a6",null).exports;const lt={name:"DetailsExport",components:{NcButton:c.x1},props:{task:{type:Object,required:!0}},data:()=>({exportFormatOptions:["xml","json"],exportFileFormat:"xml"}),computed:{downloadExportUrl(){return(0,r.Jv)(`/apps/mediadc/api/v1/tasks/${this.task.id}/export/${this.exportFileFormat}`)}},methods:{closeExportResultsDialog(){this.$emit("update:opened",!1)}}};var ot=n(73352),rt={};rt.styleTagTransform=B(),rt.setAttributes=D(),rt.insert=F().bind(null,"head"),rt.domAPI=_(),rt.insertStyleElement=T();C()(ot.A,rt);ot.A&&ot.A.locals&&ot.A.locals;const dt=(0,h.A)(lt,(function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"fade"}},[e("div",{staticClass:"details-export-wrapper"},[e("div",{staticClass:"details-export"},[e("div",{staticClass:"details-export-close",on:{click:function(e){return t.closeExportResultsDialog()}}}),t._v(" "),e("h2",[t._v(t._s(t.t("mediadc","Export task results")))]),t._v(" "),e("div",{staticClass:"selection-container"},[e("label",{attrs:{for:"export-file-format"}},[t._v(t._s(t.t("mediadc","Select export file format")))]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.exportFileFormat,expression:"exportFileFormat"}],attrs:{id:"export-file-format"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.exportFileFormat=e.target.multiple?i:i[0]}}},t._l(t.exportFormatOptions,(function(i){return e("option",{key:i,domProps:{value:i}},[t._v("\n\t\t\t\t\t\t"+t._s(i)+"\n\t\t\t\t\t")])})),0)]),t._v(" "),e("NcButton",{attrs:{href:t.downloadExportUrl}},[t._v("\n\t\t\t\t"+t._s(t.t("mediadc","Export"))+"\n\t\t\t")])],1)])])}),[],!1,null,"59143620",null).exports;var ct=n(10780),pt=n(57505),ht=n(98319),ut=n(74095),gt=n(670);const mt={name:"FileExportOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};const ft=(0,h.A)(mt,(function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon file-export-outline-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2M18 20H6V4H13V9H18V20M16 11V18.1L13.9 16L11.1 18.8L8.3 16L11.1 13.2L8.9 11H16Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])}),[],!1,null,null,null).exports,At={name:"CollectorDetails",components:{DetailsList:X,TasksEdit:at,DetailsExport:dt,NcActions:ct.N,NcActionButton:pt.A,NcProgressBar:ht.N,NcButton:ut.A,ContentCopy:gt.A,FileExportOutline:ft},mixins:[k.A],props:{rootTitle:{type:String,required:!0},loading:{type:Boolean,required:!0}},data:()=>({tasksUpdater:null,collapsedStatus:!1,editingTask:!1,exporting:!1}),computed:{...(0,d.L8)(["task","taskInfo","details","settingByName"]),isValidUser(){return(0,a.HW)().uid===this.task?.owner},currentUser:()=>(0,a.HW)().uid,hasErrors(){return this.task?.errors?.length>0}},beforeMount(){this.$emit("update:loading",!0),this.tasksUpdater=setInterval(this._getTaskDetails,3e3),this.getTaskDetails().then((t=>{"finished"!==this.getStatusBadge(t.data.collectorTask)&&"duplicated"!==this.getStatusBadge(t.data.collectorTask)||clearInterval(this.tasksUpdater),this.$emit("update:loading",!1)})),this.getTaskInfo(),(0,l.B1)("restartTask",this.onRestartTaskEvent),(0,l.B1)("updateTaskInfo",this.getDetailFilesTotalSize)},beforeDestroy(){clearInterval(this.tasksUpdater),(0,l.al)("updateTaskInfo",this.getDetailFilesTotalSize),(0,l.al)("restartTask",this.onRestartTaskEvent),this.$store.commit("setTask",{}),this.$store.commit("setTaskInfo",{exclude_directories:[],target_directories:[]}),this.$store.commit("setDetails",[]),this.$store.commit("setDetailsInfo",{filestotal:0,filessize:0})},methods:{...(0,d.i0)(["getTaskDetails","getTaskInfo","getDetailFilesTotalSize","terminateTask","getSettings"]),_terminateTask(t){this.isValidUser?this.terminateTask(t).then((()=>{(0,o.Te)(this.t("mediadc","Task terminated"))})):(0,o.I9)(this.t("mediadc","You are not allowed to terminate this task"))},_getTaskDetails(){this.getTaskDetails().then((t=>{"finished"!==this.getStatusBadge(t.data.collectorTask)&&"terminated"!==this.getStatusBadge(t.data.collectorTask)&&"error"!==this.getStatusBadge(t.data.collectorTask)||clearInterval(this.tasksUpdater)}))},restartTask(e){this.isValidUser?(clearInterval(this.tasksUpdater),this.getSettings().then((()=>{s.Ay.post((0,r.Jv)("/apps/mediadc/api/v1/tasks/restart"),{taskId:e.id,targetDirectoryIds:e.target_directory_ids,excludeList:{user:JSON.parse(e.exclude_list).user,admin:JSON.parse(this.settingByName("exclude_list").value)},collectorSettings:{hashing_algorithm:JSON.parse(this.settingByName("hashing_algorithm").value)||"dhash",similarity_threshold:Number(JSON.parse(this.task.collector_settings).similarity_threshold),hash_size:Number(this.settingByName("hash_size").value)||16,target_mtype:Number(JSON.parse(this.task.collector_settings).target_mtype),finish_notification:JSON.parse(this.task.collector_settings).finish_notification,exif_transpose:!this.settingByName("ignore_orientation").value||!0}}).then((i=>{i.data.success?(this.getTaskDetails(),this.$store.commit("setDetailsInfo",{filestotal:0,filessize:0}),this.tasksUpdater=setInterval(this._getTaskDetails,3e3),(0,o.Te)(this.t("mediadc","Task successfully restarted with previous settings!"))):i.data.limit?(0,o.I9)(this.t("mediadc","Running tasks limit exceed. Try again later.")):i.data.empty?(0,o.I9)(this.n("mediadc","Target folder has no files or all of them excluded","Target folders have no files or all of them excluded",e.target_directory_ids.length)):i.data.php_exec_not_enabled?(0,o.Qg)(t("mediadc","Task run error: PHP `exec` function is not enabled")):(0,o.I9)(this.t("medaidc","Some error occurred while running Collector Task. Try again."))})).catch((t=>{console.debug(t),(0,o.Qg)("Some error occurred while running Collector Task. Try again.")}))}))):(0,o.I9)(this.t("mediadc","You are not allowed to restart this task"))},deleteTask(t){if(this.isValidUser){const e=this;OC.dialogs.confirm(this.t("mediadc","Are sure you want to delete this task?"),this.t("mediadc","Confirm task deletion"),(function(i){i&&e.$store.dispatch("deleteTask",t).then((()=>{e.$router.push({name:"collector"}),(0,o.Te)(e.t("mediadc","Task successfully deleted"))}))}))}else(0,o.I9)(this.t("mediadc","You are not allowed to delete this task"))},collapseTaskStatus(){this.collapsedStatus=!this.collapsedStatus},openEditTaskDialog(){this.editingTask=!0},openExportResultsDialog(t){"finished"===this.getStatusBadge(t)&&this.details.length>0?this.exporting=!0:(0,o.rG)(this.t("mediadc","No results to export"))},filesDirLink(t){if(t){const e=""!==t.filepath.replace(`/${t.fileowner}/files`,"").replace(`/${this.currentUser}/files`,"")?t.filepath.replace(`/${t.fileowner}/files`,"").replace(`/${this.currentUser}/files`,""):"/";return(0,r.Jv)(`/apps/files?dir=${e}`)}return"#"},onRestartTaskEvent(){this.getTaskInfo(),this.getTaskDetails(),this.$store.commit("setDetailsInfo",{filestotal:0,filessize:0}),clearInterval(this.tasksUpdater),this.tasksUpdater=setInterval(this._getTaskDetails,3e3)},getDirOwnerToolip(t){return`${this.t("mediadc","Owner:")} ${t.fileowner}`},copyErrorsToClipboard(){navigator.clipboard.writeText(JSON.stringify(Object.assign(this.task.errors.split("\\n")),null,2)),(0,o.Te)(this.t("mediadc","Copied to clipboard"))}}};var kt=n(2586),vt={};vt.styleTagTransform=B(),vt.setAttributes=D(),vt.insert=F().bind(null,"head"),vt.domAPI=_(),vt.insertStyleElement=T();C()(kt.A,vt);kt.A&&kt.A.locals&&kt.A.locals;const xt=(0,h.A)(At,(function(){var t=this,e=t._self._c;return t.loading?t._e():e("div",{staticClass:"container"},[t.editingTask?e("TasksEdit",{attrs:{opened:t.editingTask},on:{"update:opened":function(e){t.editingTask=e}}}):t._e(),t._v(" "),t.exporting?e("DetailsExport",{attrs:{opened:t.exporting,task:t.task},on:{"update:opened":function(e){t.exporting=e}}}):t._e(),t._v(" "),e("div",{staticClass:"task-details"},[e("div",{staticClass:"task-details-heading"},[e("h2",[t._v("\n\t\t\t\t"+t._s(t.rootTitle)+"\n\t\t\t\t"),t.isValidUser?e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.collapsedStatus?t.t("mediadc","Show task status"):t.t("mediadc","Collapse task status"),placement:"bottom-end"},expression:"{content: !collapsedStatus\n\t\t\t\t\t\t? t('mediadc', 'Collapse task status')\n\t\t\t\t\t\t: t('mediadc', 'Show task status'), placement: 'bottom-end'}"}],staticStyle:{margin:"0 10px"},attrs:{type:"tertiary","aria-label":t.t("mediadc","Collapse task status")},on:{click:t.collapseTaskStatus},scopedSlots:t._u([{key:"icon",fn:function(){return[e("span",{class:t.collapsedStatus?"icon-triangle-s":"icon-triangle-n"})]},proxy:!0}],null,!1,3134159091)}):t._e()],1),t._v(" "),e("Transition",{attrs:{name:"fade",appear:""}},[t.isValidUser?e("div",{directives:[{name:"show",rawName:"v-show",value:!t.collapsedStatus,expression:"!collapsedStatus"}],staticClass:"task-details-description"},[e("p",[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Here you can view task details, manage task (stop or restart), delete found duplicated photos and videos."))+"\n\t\t\t\t\t")]),t._v(" "),e("p",[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mediadc","Deleted files are placed in the trashbin, so that they can be restored in case of need."))+"\n\t\t\t\t\t")])]):t._e()])],1),t._v(" "),e("Transition",{attrs:{name:"fade",appear:""}},[t.isValidUser?e("div",{directives:[{name:"show",rawName:"v-show",value:!t.collapsedStatus,expression:"!collapsedStatus"}],staticClass:"task-status-row"},[e("div",{staticClass:"task-status-wrapper",staticStyle:{display:"flex","flex-direction":"column",margin:"20px"}},[e("div",{staticClass:"task-status"},[e("span",{class:"badge "+t.getStatusBadge(t.task)},[t._v(t._s(t.getStatusBadge(t.task)))]),t._v(" "),e("div",{staticStyle:{display:"flex","flex-direction":"column"}},[null!==t.task.name&&""!==t.task.name?e("span",[e("b",[t._v(t._s(t.task.name))]),e("br")]):t._e(),t._v(" "),e("span",[e("b",[t._v(t._s(t.parseTargetMtype(t.task)))]),t._v(" "+t._s(t.task.files_scanned!==t.task.files_total?`${t.task.files_scanned}/`:"")+t._s(t.task.files_total)+" "+t._s(t.n("mediadc","file","files",t.task.files_total))+"\n\t\t\t\t\t\t\t\t("+t._s(t.formatBytes(Number(t.task.files_total_size)))+")\n\t\t\t\t\t\t\t\t("+t._s(null!==t.task&&"collector_settings"in t.task?t.t("mediadc","precision: ")+JSON.parse(t.task.collector_settings).similarity_threshold+"%":"")+")\n\t\t\t\t\t\t\t\t"),e("br"),t._v(" "),e("b",[t._v(t._s(t.t("mediadc","Deleted: "))+" ")]),t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.task.deleted_files_count)+" "+t._s(t.n("mediadc","file","files",t.task.deleted_files_count))+"\n\t\t\t\t\t\t\t\t("+t._s(t.formatBytes(Number(t.task.deleted_files_size)))+")\n\t\t\t\t\t\t\t")]),t._v(" "),e("span",[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.parseUnixTimestamp(t.task.created_time))+"\n\t\t\t\t\t\t\t\t"+t._s(Number(t.task.finished_time)>0?" - "+t.parseUnixTimestamp(t.task.finished_time):"")+"\n\t\t\t\t\t\t\t")])]),t._v(" "),e("NcActions",{staticStyle:{margin:"0 0 0 10px"}},[e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Restart task with current params"),placement:"left"},expression:"{content: t('mediadc', 'Restart task with current params'), placement: 'left'}"}],attrs:{icon:"icon-history","close-after-click":!0},on:{click:function(e){return t.restartTask(t.task)}}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s("duplicated"===t.getStatusBadge(t.task)?t.t("mediadc","Start"):t.t("mediadc","Restart"))+"\n\t\t\t\t\t\t\t")]),t._v(" "),e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Edit task params"),placement:"left"},expression:"{content: t('mediadc', 'Edit task params'), placement: 'left'}"}],attrs:{icon:"icon-rename","close-after-click":!0},on:{click:function(e){return t.openEditTaskDialog(t.task)}}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Edit"))+"\n\t\t\t\t\t\t\t")]),t._v(" "),e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Terminate task execution"),placement:"left"},expression:"{content: t('mediadc', 'Terminate task execution'), placement: 'left'}"}],attrs:{icon:"icon-pause","close-after-click":!0},on:{click:function(e){return t._terminateTask(t.task)}}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Stop"))+"\n\t\t\t\t\t\t\t")]),t._v(" "),"finished"===t.getStatusBadge(t.task)?e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Export task results"),placement:"left"},expression:"{ content: t('mediadc', 'Export task results'), placement: 'left' }"}],attrs:{"close-after-click":!0},on:{click:function(e){return t.openExportResultsDialog(t.task)}},scopedSlots:t._u([{key:"default",fn:function(){return[t._v("\n\t\t\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Export"))+"\n\t\t\t\t\t\t\t\t")]},proxy:!0},{key:"icon",fn:function(){return[e("FileExportOutline",{attrs:{size:18}})]},proxy:!0}],null,!1,4146270981)}):t._e(),t._v(" "),e("NcActionButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.t("mediadc","Delete task"),placement:"left"},expression:"{content: t('mediadc', 'Delete task'), placement: 'left'}"}],attrs:{icon:"icon-delete","close-after-click":!0},on:{click:function(e){return t.deleteTask(t.task)}}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.t("mediadc","Delete task"))+"\n\t\t\t\t\t\t\t")])],1)],1),t._v(" "),e("NcProgressBar",{attrs:{value:Math.round(t.task.files_scanned/t.task.files_total*100),size:"small",error:"error"===t.getStatusBadge(t.task)}})],1),t._v(" "),e("div",{staticClass:"task-info"},[e("h3",[t._v(t._s(t.t("mediadc","Target directories")))]),t._v(" "),e("div",{staticClass:"target-directories-list"},t._l(t.taskInfo.target_directories,(function(i){return e("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.getDirOwnerToolip(i),placement:"bottom"},expression:"{content: getDirOwnerToolip(dir), placement: 'bottom'}"}],key:i.fileid,staticClass:"target-directory-row"},[e("a",{attrs:{href:t.filesDirLink(i),target:"_blank"}},[e("b",[t._v("\n\t\t\t\t\t\t\t\t\t"+t._s(""!==i.filepath.replace(`/${i.fileowner}/files`,"").replace(`/${t.currentUser}/files`,"")?i.filepath.replace(`/${i.fileowner}/files`,"").replace(`/${t.currentUser}/files`,""):"/")+"\n\t\t\t\t\t\t\t\t")]),t._v("\n\t\t\t\t\t\t\t\t("+t._s(i.hasignoreflag?t.t("mediadc","Ignored"):t.formatBytes(i.filesize))+")\n\t\t\t\t\t\t\t")])])})),0)])]):t._e()]),t._v(" "),e("Transition",{attrs:{name:"fade",appear:""}},[t.isValidUser?e("div",{staticClass:"details-row"},["finished"===t.getStatusBadge(t.task)?e("DetailsList"):t._e()],1):e("div",[e("p",{staticStyle:{"text-align":"center"}},[e("b",[t._v(t._s(t.t("mediadc","You are not allowed to manage other user's tasks.")))])])])]),t._v(" "),t.hasErrors?e("div",{staticClass:"errors"},[e("div",{staticClass:"errors-heading",staticStyle:{display:"flex","align-items":"center"}},[e("h3",[t._v(t._s(t.t("mediadc","Task errors")))]),t._v(" "),e("NcButton",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.t("mediadc","Copy to clipboard"),expression:"t('mediadc', 'Copy to clipboard')"}],staticStyle:{margin:"0 10px"},attrs:{type:"tertiary-no-background","aria-label":t.t("mediadc","Copy to clipboard")},on:{click:t.copyErrorsToClipboard},scopedSlots:t._u([{key:"icon",fn:function(){return[e("ContentCopy",{attrs:{size:20}})]},proxy:!0}],null,!1,1478045380)})],1),t._v(" "),t._l(t.task.errors.split("\\n"),(function(i){return e("div",{key:i,staticClass:"error-row"},[t._v("\n\t\t\t\t"+t._s(i)+"\n\t\t\t")])}))],2):t._e()],1)],1)}),[],!1,null,"a195a68e",null).exports},6584:(t,e,i)=>{i.d(e,{A:()=>n});const n=i(55219).A},45519:(t,e,i)=>{i.d(e,{A:()=>n});const n=i(84440).A},53357:(t,e,i)=>{i.d(e,{X:()=>n,Y:()=>s});var n=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon content-copy-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},s=[]},81745:(t,e,i)=>{i.d(e,{X:()=>n,Y:()=>s});var n=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon plus-thick-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M20 14H14V20H10V14H4V10H10V4H14V10H20V14Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},s=[]}}]);
//# sourceMappingURL=mediadc-src_views_CollectorDetails_vue.js.map?v=151c87f56775dc27a27c